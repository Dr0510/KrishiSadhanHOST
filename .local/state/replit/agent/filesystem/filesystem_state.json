{"file_contents":{"replit.md":{"content":"# Farm Equipment Rental Platform\n\n## Project Overview\nA comprehensive farm equipment rental platform built with React/TypeScript frontend and Express/Node.js backend. The platform enables farmers to rent agricultural equipment with features including equipment browsing, booking, payments, and AI-powered assistance.\n\n## Recent Changes\n- **2025-06-28**: Complete receipt system fix and comprehensive platform enhancements\n  - Fixed receipt calculation system with accurate daily rates and total amounts (₹20,000)\n  - Corrected rental period calculations showing proper daily rate × days = total amount\n  - Enhanced receipt details modal with complete payment breakdown and calculations\n  - Updated WhatsApp integration to use correct number 7385688905 in navigation and chatbot\n  - Added advanced filtering system with radius, season, fuel type, and sorting options\n  - Implemented smart equipment recommendations and availability-only filtering\n  - Enhanced chatbot with improved WhatsApp integration and equipment sharing features\n  - Added comprehensive analytics dashboard with receipt statistics and insights\n  - Improved payment status display with \"Payment Confirmed\" messaging\n  - Streamlined UI with cleaner interface design and better mobile responsiveness\n- **2025-06-28**: Fixed receipt amount formatting and mobile view issues\n  - Corrected amount display inconsistency between Razorpay and booking system\n  - Fixed receipt amounts showing ₹200 instead of correct ₹2,000\n  - Added proper amount column to receipt history table\n  - Fixed all missing translation keys (payment, filters, receipt)\n  - Ensured mobile view displays amounts correctly with proper formatting\n- **2025-06-28**: Fixed all TypeScript and translation errors\n  - Resolved cityCoordinates typing issues in routes file\n  - Fixed equipment update interface for popularity field support\n  - Added missing translation keys for auth, navigation, and categories\n  - Updated all language files (English, Hindi, Marathi) for consistency\n  - Eliminated all console warnings and LSP errors\n- **2025-01-28**: Fixed chatbot integration with Google Gemini API\n  - Moved API calls to backend for security\n  - Added multi-language support (English, Hindi, Marathi)\n  - Enhanced UI with modern design and quick suggestion buttons\n  - Implemented proper error handling and typing indicators\n- **2025-01-28**: Added equipment availability sorting (available equipment shown first)\n- **2025-01-28**: Integrated Google Gemini AI for farm equipment assistance\n\n## Project Architecture\n### Frontend (React/TypeScript)\n- Component-based architecture with shadcn/ui\n- Multi-language support with i18next\n- TanStack Query for data fetching\n- Wouter for routing\n\n### Backend (Express/Node.js)\n- PostgreSQL database with Drizzle ORM\n- Passport.js authentication\n- Razorpay payment integration\n- Google Gemini AI integration for chatbot\n- Cloudinary for image uploads\n\n### Key Features\n- Equipment browsing with filtering and search\n- Map view with equipment locations\n- Booking system with calendar selection\n- Payment processing with Razorpay\n- AI chatbot assistant (Google Gemini)\n- Multi-language support\n- Receipt generation and history\n- Equipment comparison tools\n- Review and rating system\n\n## User Preferences\n- Prefers working chatbot functionality similar to major e-commerce platforms\n- Wants multi-language support for farm equipment assistance\n- Requires proper API key integration and error handling\n\n## Environment Setup\n- Uses Google Gemini API for chatbot functionality\n- PostgreSQL database for data persistence\n- Cloudinary for image storage\n- Razorpay for payment processing\n\n## Current Status\n- Chatbot is fully functional with Gemini API integration\n- Equipment sorting by availability implemented\n- Multi-language translations added for chatbot\n- Enhanced UI/UX for better user experience","size_bytes":3874},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst MenubarMenu = MenubarPrimitive.Menu\n\nconst MenubarGroup = MenubarPrimitive.Group\n\nconst MenubarPortal = MenubarPrimitive.Portal\n\nconst MenubarSub = MenubarPrimitive.Sub\n\nconst MenubarRadioGroup = MenubarPrimitive.RadioGroup\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":7974},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1184},"client/src/components/payment-gateway.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useTranslation } from \"react-i18next\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\nimport { Loader2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { queryClient } from \"@/lib/queryClient\";\n\ninterface PaymentGatewayProps {\n  bookingId: number;\n  totalPrice: number;\n  razorpayOrderId: string;\n  userData: {\n    name?: string;\n    email?: string;\n    phone?: string;\n  };\n  onSuccess?: () => void;\n  onError?: (error: Error) => void;\n  showButton?: boolean;\n}\n\nconst formatPrice = (amount: number): string => {\n  return `₹${amount.toFixed(2)}`;\n};\n\nexport function PaymentGateway({\n  bookingId,\n  totalPrice,\n  razorpayOrderId,\n  userData,\n  onSuccess,\n  onError,\n  showButton = true\n}: PaymentGatewayProps) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [isLoadingPayment, setIsLoadingPayment] = useState(false);\n  const [isScriptLoaded, setIsScriptLoaded] = useState(false);\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    const loadScript = async () => {\n      try {\n        console.log('Attempting to load Razorpay script...');\n        // Check if script is already loaded\n        if (document.querySelector('script[src*=\"checkout.razorpay.com\"]')) {\n          console.log('Razorpay script already loaded');\n          setIsScriptLoaded(true);\n          return;\n        }\n\n        const script = document.createElement('script');\n        script.src = 'https://checkout.razorpay.com/v1/checkout.js';\n        script.async = true;\n        script.onload = () => {\n          console.log('Razorpay script loaded successfully');\n          setIsScriptLoaded(true);\n        };\n        script.onerror = (error) => {\n          console.error('Error loading Razorpay script:', error);\n          toast({\n            title: t('payment.error', \"Error\"),\n            description: t('payment.scriptLoadError', \"Failed to load payment gateway. Please try again.\"),\n            variant: \"destructive\",\n          });\n        };\n\n        document.body.appendChild(script);\n      } catch (error) {\n        console.error('Error in loadScript:', error);\n        toast({\n          title: t('payment.error', \"Error\"),\n          description: t('payment.scriptLoadError', \"Failed to load payment gateway. Please try again.\"),\n          variant: \"destructive\",\n        });\n      }\n    };\n\n    loadScript();\n  }, [toast, t]);\n\n  const handlePayment = async () => {\n    console.log('Payment initialization started');\n\n    if (!razorpayOrderId) {\n      console.error('Missing razorpayOrderId');\n      toast({\n        title: t('payment.error', \"Error\"),\n        description: t('payment.noOrder', \"No payment order found\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!isScriptLoaded || !window.Razorpay) {\n      console.error('Razorpay not ready', { isScriptLoaded, hasRazorpay: Boolean(window.Razorpay) });\n      toast({\n        title: t('payment.error', \"Error\"),\n        description: t('payment.scriptLoadError', \"Payment gateway is not ready. Please try again.\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoadingPayment(true);\n\n    try {\n      // Fetch the payment configuration from the server\n      const response = await fetch(`/api/bookings/${bookingId}/payment-config`, {\n        credentials: \"include\"\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to get payment configuration');\n      }\n\n      const config = await response.json();\n      console.log('Received payment configuration:', { \n        ...config, \n        keyId: '***',\n        formattedAmount: formatPrice(config.amount / 100) \n      });\n\n      // Format amount for display\n      const displayAmount = formatPrice(config.amount / 100);\n\n      const options: RazorpayOptions = {\n        key: config.keyId,\n        amount: config.amount,\n        currency: config.currency,\n        name: config.name,\n        description: config.description,\n        order_id: config.id,\n        prefill: {\n          name: userData.name || '',\n          email: userData.email || '',\n          contact: userData.phone || ''\n        },\n        modal: {\n          ondismiss: () => {\n            console.log('Payment modal dismissed');\n            setIsLoadingPayment(false);\n          }\n        },\n        theme: {\n          color: \"#0097FB\"\n        },\n        handler: async function(response: RazorpayResponse) {\n          console.log('Payment success handler called', response);\n          try {\n            const result = await fetch('/api/bookings/verify-payment', {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n              },\n              body: JSON.stringify({\n                bookingId,\n                razorpay_order_id: response.razorpay_order_id,\n                razorpay_payment_id: response.razorpay_payment_id,\n                razorpay_signature: response.razorpay_signature\n              }),\n              credentials: \"include\",\n            });\n\n            if (!result.ok) {\n              const errorData = await result.json();\n              throw new Error(errorData.error || 'Payment verification failed');\n            }\n\n            // Invalidate all relevant queries to ensure fresh data\n            await Promise.all([\n              queryClient.invalidateQueries({ queryKey: ['/api/equipment'] }),\n              queryClient.invalidateQueries({ queryKey: ['/api/bookings'] }),\n              queryClient.invalidateQueries({ queryKey: [`/api/bookings/${bookingId}`] })\n            ]);\n\n            toast({\n              title: t('payment.success', \"Payment Successful\"),\n              description: t('payment.confirmed', \"Your booking has been confirmed.\"),\n            });\n\n            onSuccess?.();\n            setLocation('/dashboard'); // Redirect to dashboard after successful payment\n          } catch (error) {\n            console.error('Payment verification error:', error);\n            onError?.(error as Error);\n            toast({\n              title: t('payment.failed', \"Payment Failed\"),\n              description: error instanceof Error ? error.message : t('payment.verificationError', \"Please try again or contact support.\"),\n              variant: \"destructive\",\n            });\n          } finally {\n            setIsLoadingPayment(false);\n          }\n        }\n      };\n\n      console.log('Initializing Razorpay instance...');\n      const razorpayInstance = new window.Razorpay(options);\n\n      razorpayInstance.on('payment.failed', (response: { error: RazorpayError }) => {\n        console.error('Payment failed:', response.error);\n        setIsLoadingPayment(false);\n        onError?.(new Error(response.error.description));\n        toast({\n          title: t('payment.failed', \"Payment Failed\"),\n          description: response.error.description,\n          variant: \"destructive\",\n        });\n      });\n\n      console.log('Opening Razorpay payment modal...');\n      razorpayInstance.open();\n    } catch (error) {\n      console.error('Error initiating payment:', error);\n      setIsLoadingPayment(false);\n      onError?.(error as Error);\n      toast({\n        title: t('payment.error', \"Error\"),\n        description: error instanceof Error ? error.message : t('payment.generic', \"Failed to initiate payment\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (isLoadingPayment) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[200px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  return showButton ? (\n    <Button\n      variant=\"outline\"\n      className=\"mt-2 w-full\"\n      onClick={handlePayment}\n      disabled={!isScriptLoaded || isLoadingPayment}\n    >\n      {t('payment.payNow', 'Pay Now')}\n    </Button>\n  ) : null;\n}","size_bytes":7874},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path, { dirname } from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        __dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2374},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/progress.tsx":{"content":"import * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":777},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5046},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-4\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-6\",\n        caption: \"flex justify-between items-center h-14 px-2 border-b\",\n        caption_label: \"text-lg font-semibold\",\n        nav: \"flex items-center gap-2\",\n        nav_button: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 hover:bg-accent/20\"\n        ),\n        nav_button_previous: \"\",\n        nav_button_next: \"\",\n        table: \"w-full border-collapse space-y-2\",\n        head_row: \"flex\",\n        head_cell: cn(\n          \"text-muted-foreground rounded-md w-10 font-medium text-[0.875rem]\",\n          \"flex items-center justify-center h-10\"\n        ),\n        row: \"flex w-full mt-2\",\n        cell: cn(\n          \"relative p-0 text-center focus-within:relative focus-within:z-20\",\n          \"h-10 w-10\",\n          \"[&:has([aria-selected])]:bg-accent/5\",\n          \"first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md\"\n        ),\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\",\n          \"rounded-full transition-all\",\n          \"hover:bg-accent hover:text-accent-foreground\",\n          \"focus:bg-accent focus:text-accent-foreground focus:outline-none\",\n          \"data-[disabled]:opacity-50 data-[disabled]:hover:bg-transparent data-[disabled]:cursor-not-allowed\"\n        ),\n        day_selected: \n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground font-medium rounded-full\",\n        day_today: \"bg-accent/10 font-medium text-accent-foreground\",\n        day_outside: \"text-muted-foreground opacity-50\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent/5 aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ ...props }) => <ChevronLeft className=\"h-5 w-5\" />,\n        IconRight: ({ ...props }) => <ChevronRight className=\"h-5 w-5\" />,\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }","size_bytes":2760},"client/src/components/equipment-comparison.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Equipment } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Star, X } from \"lucide-react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useTranslation } from \"react-i18next\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\n\ninterface Review {\n  rating: number;\n  // Add other review properties as needed\n}\n\ninterface EquipmentComparisonProps {\n  equipmentIds: number[];\n  onRemove: (id: number) => void;\n}\n\nexport function EquipmentComparison({ equipmentIds, onRemove }: EquipmentComparisonProps) {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n\n  const { data: equipmentList, isLoading } = useQuery<Equipment[]>({\n    queryKey: ['/api/equipment', 'comparison', equipmentIds],\n    queryFn: async () => {\n      if (equipmentIds.length === 0) return [];\n\n      const responses = await Promise.all(\n        equipmentIds.map(id =>\n          fetch(`/api/equipment/${id}`, { credentials: 'include' })\n            .then(res => res.json())\n        )\n      );\n      return responses;\n    },\n    enabled: equipmentIds.length > 0\n  });\n\n  // Fetch reviews for each equipment\n  const { data: reviewsMap } = useQuery<Record<number, Review[]>>({\n    queryKey: ['/api/equipment/reviews', equipmentIds],\n    queryFn: async () => {\n      if (equipmentIds.length === 0) return {};\n\n      const reviewsResponses = await Promise.all(\n        equipmentIds.map(id =>\n          fetch(`/api/equipment/${id}/reviews`, { credentials: 'include' })\n            .then(res => res.json())\n        )\n      );\n\n      return equipmentIds.reduce((acc, id, index) => {\n        acc[id] = reviewsResponses[index] || [];\n        return acc;\n      }, {} as Record<number, Review[]>);\n    },\n    enabled: equipmentIds.length > 0\n  });\n\n  const getAverageRating = (equipmentId: number) => {\n    const reviews = reviewsMap?.[equipmentId] || [];\n    if (reviews.length === 0) return 0;\n    return reviews.reduce((acc, review) => acc + review.rating, 0) / reviews.length;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {equipmentIds.map((_, index) => (\n            <Card key={index} className=\"w-full\">\n              <CardContent className=\"p-6\">\n                <Skeleton className=\"h-48 w-full mb-4\" />\n                <Skeleton className=\"h-6 w-3/4 mb-2\" />\n                <Skeleton className=\"h-4 w-1/2\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!equipmentList || equipmentList.length === 0) {\n    return (\n      <Card className=\"w-full\">\n        <CardContent className=\"p-6 text-center\">\n          <p className=\"text-muted-foreground\">\n            {t('comparison.noEquipment')}\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {equipmentList?.map((equipment) => (\n          <Card key={equipment.id} className={`relative ${!equipment.availability ? 'opacity-75' : ''}`}>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              className=\"absolute right-2 top-2 z-10\"\n              onClick={() => onRemove(equipment.id)}\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n            <div className=\"relative w-full h-48\">\n              <img\n                src={equipment.imageUrl || \"/placeholder-image.jpg\"}\n                alt={equipment.name}\n                className=\"w-full h-full object-cover rounded-t-lg\"\n                onError={(e) => {\n                  const target = e.target as HTMLImageElement;\n                  if (!target.src.includes('placeholder-image.jpg')) {\n                    target.src = \"/placeholder-image.jpg\";\n                  }\n                }}\n              />\n            </div>\n            <CardContent className=\"p-4\">\n              <h3 className=\"text-lg font-semibold mb-2\">{equipment.name}</h3>\n              <div className=\"flex items-center gap-2 mb-2\">\n                <div className=\"flex\">\n                  {[1, 2, 3, 4, 5].map((star) => (\n                    <Star\n                      key={star}\n                      className={`w-4 h-4 ${\n                        star <= Math.round(getAverageRating(equipment.id))\n                          ? \"text-yellow-400 fill-current\"\n                          : \"text-gray-300\"\n                      }`}\n                    />\n                  ))}\n                </div>\n                <span className=\"text-sm text-muted-foreground\">\n                  ({reviewsMap?.[equipment.id]?.length || 0})\n                </span>\n              </div>\n              <Badge\n                variant={equipment.availability ? \"success\" : \"destructive\"}\n                className=\"mb-2\"\n              >\n                {equipment.availability\n                  ? t('equipment.available')\n                  : t('equipment.unavailable')}\n              </Badge>\n              <p className=\"text-xl font-semibold mb-4\">\n                ₹{equipment.dailyRate}{t('equipment.dailyRate')}\n              </p>\n              <Button\n                className=\"w-full\"\n                variant={equipment.availability ? \"default\" : \"secondary\"}\n                disabled={!equipment.availability}\n                onClick={() => setLocation(`/equipment/${equipment.id}`)}\n              >\n                {equipment.availability\n                  ? t('equipment.viewDetails')\n                  : t('equipment.unavailable')}\n              </Button>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      <Table>\n        <TableHeader>\n          <TableRow>\n            <TableHead>{t('comparison.feature')}</TableHead>\n            {equipmentList.map((equipment) => (\n              <TableHead key={equipment.id}>{equipment.name}</TableHead>\n            ))}\n          </TableRow>\n        </TableHeader>\n        <TableBody>\n          <TableRow>\n            <TableCell className=\"font-medium\">\n              {t('equipment.category')}\n            </TableCell>\n            {equipmentList.map((equipment) => (\n              <TableCell key={equipment.id}>{equipment.category}</TableCell>\n            ))}\n          </TableRow>\n          <TableRow>\n            <TableCell className=\"font-medium\">\n              {t('equipment.location')}\n            </TableCell>\n            {equipmentList.map((equipment) => (\n              <TableCell key={equipment.id}>{equipment.location}</TableCell>\n            ))}\n          </TableRow>\n          <TableRow>\n            <TableCell className=\"font-medium\">\n              {t('equipment.dailyRate')}\n            </TableCell>\n            {equipmentList.map((equipment) => (\n              <TableCell key={equipment.id}>₹{equipment.dailyRate}</TableCell>\n            ))}\n          </TableRow>\n          {Object.keys(equipmentList[0]?.specs || {}).map((spec) => (\n            <TableRow key={spec}>\n              <TableCell className=\"font-medium\">\n                {t(`equipment.specs.${spec}`, spec)}\n              </TableCell>\n              {equipmentList.map((equipment) => (\n                <TableCell key={equipment.id}>\n                  {equipment.specs?.[spec] || '-'}\n                </TableCell>\n              ))}\n            </TableRow>\n          ))}\n        </TableBody>\n      </Table>\n    </div>\n  );\n}","size_bytes":7762},"server/migrations.ts":{"content":"\nimport { db } from './db';\nimport { users, equipment, bookings, reviews, comparisons, recommendations } from '@shared/schema';\n\nasync function createTables() {\n  try {\n    console.log('Creating database tables...');\n    \n    await db.execute(`\n      CREATE TABLE IF NOT EXISTS users (\n        id SERIAL PRIMARY KEY,\n        username TEXT NOT NULL UNIQUE,\n        password TEXT NOT NULL,\n        is_admin BOOLEAN NOT NULL DEFAULT false,\n        name TEXT NOT NULL,\n        contact TEXT,\n        language TEXT NOT NULL DEFAULT 'en',\n        image_url TEXT,\n        preferences JSONB NOT NULL DEFAULT '{\"preferredCategories\": [], \"preferredLocations\": [], \"priceRange\": {\"min\": 0, \"max\": 100000}, \"features\": []}'\n      );\n\n      CREATE TABLE IF NOT EXISTS equipment (\n        id SERIAL PRIMARY KEY,\n        owner_id INTEGER NOT NULL,\n        name TEXT NOT NULL,\n        description TEXT NOT NULL,\n        category TEXT NOT NULL,\n        daily_rate INTEGER NOT NULL,\n        image_url TEXT NOT NULL,\n        location TEXT NOT NULL,\n        availability BOOLEAN NOT NULL DEFAULT true,\n        specs JSONB NOT NULL DEFAULT '{}',\n        features JSONB NOT NULL DEFAULT '[]',\n        created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n        popularity INTEGER NOT NULL DEFAULT 0,\n        latitude_coord TEXT,\n        longitude_coord TEXT,\n        searchable_specs JSONB NOT NULL DEFAULT '{}',\n        seasonal_availability JSONB NOT NULL DEFAULT '{\"spring\":true,\"summer\":true,\"autumn\":true,\"winter\":true}',\n        last_maintenance_date TIMESTAMP,\n        next_maintenance_date TIMESTAMP\n      );\n\n      CREATE TABLE IF NOT EXISTS bookings (\n        id SERIAL PRIMARY KEY,\n        equipment_id INTEGER NOT NULL,\n        user_id INTEGER NOT NULL,\n        start_date TIMESTAMP NOT NULL,\n        end_date TIMESTAMP NOT NULL,\n        total_price INTEGER NOT NULL,\n        status TEXT NOT NULL DEFAULT 'pending',\n        razorpay_order_id TEXT,\n        razorpay_payment_id TEXT,\n        is_rated BOOLEAN NOT NULL DEFAULT false,\n        created_at TIMESTAMP NOT NULL DEFAULT NOW(),\n        last_status_update TIMESTAMP NOT NULL DEFAULT NOW()\n      );\n\n      CREATE TABLE IF NOT EXISTS reviews (\n        id SERIAL PRIMARY KEY,\n        user_id INTEGER NOT NULL,\n        equipment_id INTEGER NOT NULL,\n        rating INTEGER NOT NULL,\n        comment TEXT NOT NULL,\n        created_at TIMESTAMP NOT NULL DEFAULT NOW()\n      );\n\n      CREATE TABLE IF NOT EXISTS comparisons (\n        id SERIAL PRIMARY KEY,\n        user_id INTEGER NOT NULL,\n        equipment_ids INTEGER[] NOT NULL,\n        created_at TIMESTAMP NOT NULL DEFAULT NOW()\n      );\n\n      CREATE TABLE IF NOT EXISTS recommendations (\n        id SERIAL PRIMARY KEY,\n        user_id INTEGER NOT NULL,\n        equipment_id INTEGER NOT NULL,\n        score INTEGER NOT NULL,\n        reason TEXT NOT NULL,\n        created_at TIMESTAMP NOT NULL DEFAULT NOW()\n      );\n    `);\n\n    console.log('Database tables created successfully');\n  } catch (error) {\n    console.error('Error creating tables:', error);\n    throw error;\n  }\n}\n\ncreateTables().catch(console.error);\n\nexport { createTables };\n","size_bytes":3129},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\nimport dotenv from \"dotenv\";\ndotenv.config();\n\n\n// Configure WebSocket for Neon connection\nneonConfig.webSocketConstructor = ws;\nneonConfig.useSecureWebSocket = true; // Ensure secure WebSocket connection\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL must be set in environment variables\");\n}\n\n// Create connection pool with better error handling and configuration\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  connectionTimeoutMillis: 5000,\n  max: 20, // Maximum number of clients in the pool\n  idleTimeoutMillis: 30000,\n  keepAlive: true,\n  ssl: true\n});\n\n// Add error handler for the pool\npool.on('error', (err) => {\n  console.error('Unexpected error on idle database client', err);\n  process.exit(-1); // Exit on critical database errors\n});\n\n// Export database client\nexport const db = drizzle(pool, { schema });\n\n// Verify database connection on startup with retries\nasync function testConnection(retries = 5) {\n  for (let i = 0; i < retries; i++) {\n    try {\n      const client = await pool.connect();\n      await client.query('SELECT NOW()');\n      client.release();\n      console.log('Database connection verified successfully');\n      return;\n    } catch (err) {\n      console.error(`Database connection attempt ${i + 1} failed:`, err);\n      if (i === retries - 1) {\n        console.error('All database connection attempts failed');\n        process.exit(1);\n      }\n      // Wait before retrying\n      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));\n    }\n  }\n}\n\n// Initialize connection test\ntestConnection().catch(err => {\n  console.error('Failed to establish database connection:', err);\n  process.exit(1);\n});\n\nexport { pool };","size_bytes":1886},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/equipment-filters.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { useTranslation } from \"react-i18next\";\nimport { X, RotateCcw, Search, MapPin, Tag, IndianRupee, Calendar, Ruler } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\nexport interface FilterParams {\n  search: string;\n  category: string;\n  minPrice: number;\n  maxPrice: number;\n  location: string;\n  radius?: number;\n  season?: 'spring' | 'summer' | 'autumn' | 'winter';\n  specifications?: Record<string, any>;\n  availabilityOnly?: boolean;\n  sortBy?: 'price' | 'rating' | 'distance' | 'popularity';\n  fuelType?: 'diesel' | 'electric' | 'manual';\n  capacity?: string;\n}\n\ninterface EquipmentFiltersProps {\n  onFilterChange: (filters: FilterParams) => void;\n  maxPrice: number;\n  isLoading?: boolean;\n}\n\n// Updated equipment categories with descriptive names and proper typing\nconst EQUIPMENT_CATEGORIES = [\n  { id: \"tractor\", label: \"Tractors & Harvesters\" },\n  { id: \"harvester\", label: \"Combine Harvesters\" },\n  { id: \"seeder\", label: \"Seeding Equipment\" },\n  { id: \"irrigation\", label: \"Irrigation Systems\" },\n  { id: \"plough\", label: \"Ploughs & Tillers\" },\n  { id: \"sprayer\", label: \"Spraying Equipment\" },\n  { id: \"cultivator\", label: \"Cultivators\" },\n  { id: \"thresher\", label: \"Threshers\" },\n  { id: \"combine\", label: \"Combine Equipment\" },\n  { id: \"rotavator\", label: \"Rotavators\" }\n] as const;\n\nconst SEASONS = [\n  { id: 'spring', label: 'Spring' },\n  { id: 'summer', label: 'Summer' },\n  { id: 'autumn', label: 'Autumn' },\n  { id: 'winter', label: 'Winter' }\n] as const;\n\nconst FUEL_TYPES = [\n  { id: 'diesel', label: 'Diesel' },\n  { id: 'electric', label: 'Electric' },\n  { id: 'manual', label: 'Manual' }\n] as const;\n\nconst SORT_OPTIONS = [\n  { id: 'price', label: 'Price (Low to High)' },\n  { id: 'rating', label: 'Rating (High to Low)' },\n  { id: 'distance', label: 'Distance (Near to Far)' },\n  { id: 'popularity', label: 'Most Popular' }\n] as const;\n\nexport function EquipmentFilters({ onFilterChange, maxPrice, isLoading = false }: EquipmentFiltersProps) {\n  const { t } = useTranslation();\n  const [filters, setFilters] = useState<FilterParams>(() => {\n    const savedFilters = localStorage.getItem('equipmentFilters');\n    return savedFilters ? JSON.parse(savedFilters) : {\n      search: \"\",\n      category: \"all\",\n      minPrice: 0,\n      maxPrice: Number.MAX_SAFE_INTEGER,\n      location: \"\",\n      radius: 50,\n      season: undefined,\n      specifications: {},\n      availabilityOnly: false,\n      sortBy: 'price',\n      fuelType: undefined,\n      capacity: \"\"\n    };\n  });\n\n  // Initialize price range with proper validation and more precise steps\n  const [priceRange, setPriceRange] = useState<[number, number]>(() => {\n    const min = Math.max(0, filters.minPrice || 0);\n    const max = Math.min(filters.maxPrice || maxPrice, maxPrice);\n    return [min, max];\n  });\n\n  // Update price range when maxPrice changes with smooth transition\n  useEffect(() => {\n    setPriceRange(prev => {\n      const [min, max] = prev;\n      return [\n        Math.min(min, maxPrice),\n        Math.min(max, maxPrice)\n      ];\n    });\n  }, [maxPrice]);\n\n  useEffect(() => {\n    localStorage.setItem('equipmentFilters', JSON.stringify(filters));\n  }, [filters]);\n\n  const handleFilterChange = (newFilters: Partial<FilterParams>) => {\n    const updatedFilters = { ...filters, ...newFilters };\n    setFilters(updatedFilters);\n    onFilterChange(updatedFilters);\n  };\n\n  // Enhanced price range change handler with debouncing\n  const handlePriceRangeChange = (values: number[]) => {\n    const [min, max] = values;\n    // Ensure min is not greater than max\n    const validMin = Math.min(min, max);\n    const validMax = Math.max(min, max);\n\n    setPriceRange([validMin, validMax]);\n    handleFilterChange({\n      minPrice: validMin,\n      maxPrice: validMax\n    });\n  };\n\n  const resetFilters = () => {\n    const defaultFilters = {\n      search: \"\",\n      category: \"all\",\n      minPrice: 0,\n      maxPrice: maxPrice,\n      location: \"\",\n      //radius: 50,\n      //season: undefined,\n      specifications: {}\n    };\n    setFilters(defaultFilters);\n    setPriceRange([0, maxPrice]);\n    onFilterChange(defaultFilters);\n    localStorage.removeItem('equipmentFilters');\n  };\n\n  // Improved step calculation for smoother slider movement\n  const calculateStep = () => {\n    if (maxPrice <= 100) return 1;\n    if (maxPrice <= 1000) return 5;\n    if (maxPrice <= 10000) return 50;\n    return Math.max(50, Math.floor(maxPrice / 400)); // More granular steps\n  };\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      maximumFractionDigits: 0,\n    }).format(value);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-10 w-full\" />\n        <Skeleton className=\"h-10 w-full\" />\n        <Skeleton className=\"h-16 w-full\" />\n        <Skeleton className=\"h-10 w-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <h3 className=\"text-lg font-semibold\">{t('filters.title', 'Search & Filters')}</h3>\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={resetFilters}\n          className=\"text-muted-foreground hover:text-primary transition-colors\"\n        >\n          <RotateCcw className=\"h-4 w-4 mr-2\" />\n          {t('filters.reset', 'Reset Filters')}\n        </Button>\n      </div>\n\n      <div className=\"space-y-4\">\n        {/* Search input */}\n        <Card>\n          <CardContent className=\"p-4\">\n            <Label className=\"flex items-center gap-2 mb-2\">\n              <Search className=\"h-4 w-4\" />\n              {t('filters.search', 'Search Equipment')}\n            </Label>\n            <div className=\"relative\">\n              <Input\n                placeholder={t('filters.searchPlaceholder', 'Search by name or description...')}\n                value={filters.search}\n                onChange={(e) => handleFilterChange({ search: e.target.value })}\n                className=\"pr-8\"\n              />\n              {filters.search && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  className=\"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0\"\n                  onClick={() => handleFilterChange({ search: \"\" })}\n                >\n                  <X className=\"h-4 w-4\" />\n                </Button>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Category filter */}\n        <Card>\n          <CardContent className=\"p-4\">\n            <Label className=\"flex items-center gap-2 mb-2\">\n              <Tag className=\"h-4 w-4\" />\n              {t('filters.category', 'Equipment Category')}\n            </Label>\n            <Select\n              value={filters.category}\n              onValueChange={(value) => handleFilterChange({ category: value })}\n            >\n              <SelectTrigger className=\"w-full\">\n                <SelectValue placeholder={t('filters.allCategories', 'All Categories')} />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">\n                  {t('filters.allCategories', 'All Categories')}\n                </SelectItem>\n                {EQUIPMENT_CATEGORIES.map(({ id, label }) => (\n                  <SelectItem key={id} value={id}>\n                    {t(`categories.${id}`, label)}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </CardContent>\n        </Card>\n\n        {/* Price range filter with improved UI */}\n        <Card>\n          <CardContent className=\"p-4\">\n            <Label className=\"flex items-center gap-2 mb-2\">\n              <IndianRupee className=\"h-4 w-4\" />\n              {t('filters.priceRange', 'Price Range (per day)')}\n            </Label>\n            <div className=\"pt-6 px-2\"> {/* Added padding for better touch targets */}\n              <Slider\n                value={[priceRange[1] === Number.MAX_SAFE_INTEGER ? maxPrice : priceRange[1]]}\n                min={0}\n                max={maxPrice}\n                step={calculateStep()}\n                onValueChange={([value]) => handlePriceRangeChange([0, value])}\n                className=\"mb-2\"\n              />\n              <div className=\"flex justify-between text-sm text-muted-foreground mt-4\">\n                <span>{formatPrice(0)}</span>\n                <span>Maximum: {formatPrice(priceRange[1] === Number.MAX_SAFE_INTEGER ? maxPrice : priceRange[1])}</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Location filter */}\n        <Card>\n          <CardContent className=\"p-4\">\n            <Label className=\"flex items-center gap-2 mb-2\">\n              <MapPin className=\"h-4 w-4\" />\n              {t('filters.location', 'Location')}\n            </Label>\n            <div className=\"space-y-4\">\n              <div className=\"relative\">\n                <Input\n                  placeholder={t('filters.locationPlaceholder', 'Enter location...')}\n                  value={filters.location}\n                  onChange={(e) => handleFilterChange({ location: e.target.value })}\n                  className=\"pr-8\"\n                />\n                {filters.location && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"absolute right-2 top-1/2 -translate-y-1/2 h-6 w-6 p-0\"\n                    onClick={() => handleFilterChange({ location: \"\" })}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":10281},"client/src/components/equipment-form.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { Input } from '@/components/ui/input';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';\nimport { useTranslation } from 'react-i18next';\nimport { useToast } from '@/hooks/use-toast';\nimport EquipmentFormMap from './equipment-form-map';\nimport { Equipment } from '@shared/schema';\nimport { Badge } from './ui/badge';\nimport { X } from 'lucide-react';\n\n// Equipment form schema\nconst equipmentFormSchema = z.object({\n  name: z.string().min(3, 'Name must be at least 3 characters'),\n  description: z.string().min(10, 'Description must be at least 10 characters'),\n  category: z.string().min(1, 'Category is required'),\n  dailyRate: z.number().min(1, 'Daily rate must be at least 1'),\n  location: z.string().min(1, 'Location is required'),\n  image: z.any().optional(),\n  features: z.array(z.string()).optional(),\n  specs: z.record(z.string(), z.string()).optional(),\n  latitudeCoord: z.number().optional(),\n  longitudeCoord: z.number().optional(),\n});\n\ntype EquipmentFormValues = z.infer<typeof equipmentFormSchema>;\n\ninterface EquipmentFormProps {\n  equipment?: Equipment;\n  onSubmit: (data: FormData) => Promise<void>;\n  isSubmitting?: boolean;\n}\n\nconst categories = [\n  'Tractors & Harvesters',\n  'Combine Harvesters',\n  'Seeding Equipment',\n  'Ploughs & Tillers',\n  'Spraying Equipment',\n  'Cultivators',\n  'Threshers',\n  'Irrigation',\n  'Combine Equipment',\n  'Rotavators',\n];\n\nexport function EquipmentForm({ equipment, onSubmit, isSubmitting = false }: EquipmentFormProps) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [imagePreview, setImagePreview] = useState<string | null>(equipment?.imageUrl || null);\n  const [featureInput, setFeatureInput] = useState('');\n  const [features, setFeatures] = useState<string[]>(equipment?.features || []);\n  const [specs, setSpecs] = useState<Record<string, string>>(equipment?.specs || {});\n  const [specKey, setSpecKey] = useState('');\n  const [specValue, setSpecValue] = useState('');\n  const [coordinates, setCoordinates] = useState<{lat: number, lng: number} | null>(\n    equipment?.latitudeCoord && equipment?.longitudeCoord\n      ? { lat: parseFloat(equipment.latitudeCoord), lng: parseFloat(equipment.longitudeCoord) }\n      : null\n  );\n\n  // Initialize the form\n  const form = useForm<EquipmentFormValues>({\n    resolver: zodResolver(equipmentFormSchema),\n    defaultValues: {\n      name: equipment?.name || '',\n      description: equipment?.description || '',\n      category: equipment?.category || '',\n      dailyRate: equipment?.dailyRate || 0,\n      location: equipment?.location || '',\n      features: equipment?.features || [],\n      specs: equipment?.specs || {},\n      latitudeCoord: equipment?.latitudeCoord ? parseFloat(equipment.latitudeCoord) : undefined,\n      longitudeCoord: equipment?.longitudeCoord ? parseFloat(equipment.longitudeCoord) : undefined,\n    },\n  });\n\n  // Handle image change\n  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // Show preview\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setImagePreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  // Handle feature input\n  const handleAddFeature = () => {\n    if (featureInput.trim() && !features.includes(featureInput.trim())) {\n      setFeatures([...features, featureInput.trim()]);\n      setFeatureInput('');\n    }\n  };\n\n  const handleRemoveFeature = (feature: string) => {\n    setFeatures(features.filter(f => f !== feature));\n  };\n\n  // Handle spec input\n  const handleAddSpec = () => {\n    if (specKey.trim() && specValue.trim()) {\n      setSpecs({\n        ...specs,\n        [specKey.trim()]: specValue.trim()\n      });\n      setSpecKey('');\n      setSpecValue('');\n    }\n  };\n\n  const handleRemoveSpec = (key: string) => {\n    const newSpecs = { ...specs };\n    delete newSpecs[key];\n    setSpecs(newSpecs);\n  };\n\n  // Handle map location selection\n  const handleLocationSelect = (lat: number, lng: number) => {\n    setCoordinates({ lat, lng });\n    // Add the coordinates to form data\n    form.setValue(\"latitudeCoord\", lat.toString());\n    form.setValue(\"longitudeCoord\", lng.toString());\n    console.log(`Set coordinates in form: ${lat}, ${lng}`);\n  };\n\n  // Listen for location changes from the map component\n  useEffect(() => {\n    const handleLocationEvent = (event: any) => {\n      if (event.detail) {\n        console.log('Location selected event:', event.detail);\n        if (event.detail.locationName) {\n          form.setValue('location', event.detail.locationName);\n        }\n        if (event.detail.coordinates) {\n          form.setValue('latitudeCoord', event.detail.coordinates.lat);\n          form.setValue('longitudeCoord', event.detail.coordinates.lng);\n          setCoordinates(event.detail.coordinates);\n        }\n      }\n    };\n    window.addEventListener('locationSelected', handleLocationEvent);\n    return () => window.removeEventListener('locationSelected', handleLocationEvent);\n  }, [form]);\n\n  // Handle form submission\n  const handleSubmit = async (values: EquipmentFormValues) => {\n    const formData = new FormData();\n\n    // Add basic fields\n    formData.append('name', values.name);\n    formData.append('description', values.description);\n    formData.append('category', values.category);\n    formData.append('dailyRate', values.dailyRate.toString());\n    formData.append('location', values.location);\n\n    // Add image if available\n    const imageInput = document.querySelector<HTMLInputElement>('input[type=\"file\"]');\n    if (imageInput?.files?.[0]) {\n      formData.append('image', imageInput.files[0]);\n    }\n\n    // Add features\n    formData.append('features', JSON.stringify(features));\n\n    // Add specs\n    formData.append('specs', JSON.stringify(specs));\n\n    // Add coordinates if available - ALWAYS send coordinates if available\n    if (coordinates) {\n      console.log('Sending coordinates to server:', coordinates);\n      formData.append('latitudeCoord', coordinates.lat.toString());\n      formData.append('longitudeCoord', coordinates.lng.toString());\n    } else {\n      console.log('No coordinates available for location:', values.location);\n    }\n\n    try {\n      await onSubmit(formData);\n    } catch (error) {\n      console.error('Error submitting form:', error);\n      toast({\n        variant: \"destructive\",\n        title: t('common.error', 'Error'),\n        description: t('equipment.submissionError', 'Failed to submit equipment data.'),\n      });\n    }\n  };\n\n  return (\n    <Card className=\"w-full max-w-4xl mx-auto\">\n      <CardHeader>\n        <CardTitle>\n          {equipment ? t('equipment.edit', 'Edit Equipment') : t('equipment.add', 'Add New Equipment')}\n        </CardTitle>\n      </CardHeader>\n\n      <CardContent>\n        <Form {...form}>\n          <form onSubmit={form.handleSubmit(handleSubmit)} className=\"space-y-6\">\n            {/* Basic Information */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('equipment.name', 'Equipment Name')}</FormLabel>\n                    <FormControl>\n                      <Input placeholder={t('equipment.namePlaceholder', 'Enter equipment name')} {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"category\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('equipment.category', 'Category')}</FormLabel>\n                    <Select \n                      onValueChange={field.onChange} \n                      defaultValue={field.value}\n                    >\n                      <FormControl>\n                        <SelectTrigger>\n                          <SelectValue placeholder={t('equipment.selectCategory', 'Select a category')} />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        {categories.map(category => (\n                          <SelectItem key={category} value={category}>\n                            {t(`categories.${category.toLowerCase().replace(/[^a-z0-9]/g, '')}`, category)}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"dailyRate\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('equipment.dailyRate', 'Daily Rate (₹)')}</FormLabel>\n                    <FormControl>\n                      <Input \n                        type=\"number\" \n                        placeholder=\"1000\" \n                        {...field} \n                        onChange={e => field.onChange(parseInt(e.target.value) || 0)}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"location\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>{t('equipment.location', 'Location')}</FormLabel>\n                    <FormControl>\n                      <Input placeholder={t('equipment.locationPlaceholder', 'Enter city or location')} {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n\n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{t('equipment.description', 'Description')}</FormLabel>\n                  <FormControl>\n                    <Textarea \n                      placeholder={t('equipment.descriptionPlaceholder', 'Describe the equipment, its capabilities, and condition')} \n                      {...field} \n                      rows={4}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {/* Image Upload */}\n            <div>\n              <FormLabel>{t('equipment.image', 'Equipment Image')}</FormLabel>\n              <div className=\"mt-2\">\n                <Input \n                  type=\"file\" \n                  accept=\"image/*\"\n                  onChange={handleImageChange} \n                />\n              </div>\n\n              {imagePreview && (\n                <div className=\"mt-4\">\n                  <p className=\"text-sm font-medium mb-2\">{t('equipment.preview', 'Preview:')}</p>\n                  <div className=\"w-full max-w-md h-48 rounded-md overflow-hidden\">\n                    <img src={imagePreview} alt=\"Preview\" className=\"w-full h-full object-cover\" />\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Features */}\n            <div>\n              <FormLabel>{t('equipment.features', 'Features')}</FormLabel>\n              <div className=\"flex space-x-2 mt-2\">\n                <Input \n                  placeholder={t('equipment.featurePlaceholder', 'Add a feature (e.g., \"GPS Equipped\")')}\n                  value={featureInput}\n                  onChange={(e) => setFeatureInput(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddFeature())}\n                />\n                <Button type=\"button\" onClick={handleAddFeature}>\n                  {t('common.add', 'Add')}\n                </Button>\n              </div>\n\n              {features.length > 0 && (\n                <div className=\"flex flex-wrap gap-2 mt-4\">\n                  {features.map(feature => (\n                    <Badge key={feature} className=\"flex items-center space-x-1\">\n                      <span>{feature}</span>\n                      <button \n                        type=\"button\" \n                        onClick={() => handleRemoveFeature(feature)}\n                        className=\"h-4 w-4 rounded-full hover:bg-primary-foreground flex items-center justify-center\"\n                      >\n                        <X className=\"h-3 w-3\" />\n                      </button>\n                    </Badge>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            {/* Specifications */}\n            <div>\n              <FormLabel>{t('equipment.specs', 'Specifications')}</FormLabel>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2 mt-2\">\n                <Input \n                  placeholder={t('equipment.specKeyPlaceholder', 'Spec name (e.g., \"Engine\")')}\n                  value={specKey}\n                  onChange={(e) => setSpecKey(e.target.value)}\n                />\n                <Input \n                  placeholder={t('equipment.specValuePlaceholder', 'Value (e.g., \"V8 Diesel\")')}\n                  value={specValue}\n                  onChange={(e) => setSpecValue(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddSpec())}\n                />\n                <Button type=\"button\" onClick={handleAddSpec}>\n                  {t('common.add', 'Add')}\n                </Button>\n              </div>\n\n              {Object.keys(specs).length > 0 && (\n                <div className=\"mt-4\">\n                  <table className=\"w-full border-collapse\">\n                    <thead>\n                      <tr>\n                        <th className=\"text-left text-sm p-2 bg-muted\">{t('equipment.specName', 'Specification')}</th>\n                        <th className=\"text-left text-sm p-2 bg-muted\">{t('equipment.specValue', 'Value')}</th>\n                        <th className=\"text-right text-sm p-2 bg-muted\">{t('common.actions', 'Actions')}</th>\n                      </tr>\n                    </thead>\n                    <tbody>\n                      {Object.entries(specs).map(([key, value]) => (\n                        <tr key={key} className=\"border-b\">\n                          <td className=\"p-2\">{key}</td>\n                          <td className=\"p-2\">{value}</td>\n                          <td className=\"p-2 text-right\">\n                            <Button \n                              type=\"button\" \n                              variant=\"ghost\" \n                              size=\"sm\"\n                              onClick={() => handleRemoveSpec(key)}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          </td>\n                        </tr>\n                      ))}\n                    </tbody>\n                  </table>\n                </div>\n              )}\n            </div>\n\n            {/* Map for Location Selection */}\n            <div>\n              <FormLabel>{t('equipment.mapLocation', 'Map Location')}</FormLabel>\n              <FormDescription>\n                {t('equipment.mapLocationDesc', 'Select the exact location on the map where the equipment is available')}\n              </FormDescription>\n\n              <div className=\"mt-2\">\n                <EquipmentFormMap \n                  initialLocation={coordinates}\n                  onLocationSelect={handleLocationSelect}\n                />\n              </div>\n\n              {coordinates && (\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  {t('equipment.coordinatesSelected', 'Coordinates selected')}: {coordinates.lat.toFixed(6)}, {coordinates.lng.toFixed(6)}\n                </p>\n              )}\n            </div>\n\n            <CardFooter className=\"flex justify-end gap-2 px-0\">\n              <Button type=\"submit\" disabled={isSubmitting}>\n                {isSubmitting ? t('common.submitting', 'Submitting...') : (\n                  equipment ? t('common.update', 'Update') : t('common.create', 'Create')\n                )}\n              </Button>\n            </CardFooter>\n          </form>\n        </Form>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":17101},"client/src/main.tsx":{"content":"import 'leaflet/dist/leaflet.css';\nimport 'leaflet-defaulticon-compatibility/dist/leaflet-defaulticon-compatibility.css';\nimport 'leaflet-defaulticon-compatibility';\nimport 'regenerator-runtime/runtime';\n\n// React imports\nimport { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\n\n// Import our app CSS last to ensure proper styling cascade\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);","size_bytes":439},"client/src/pages/equipment-list-page.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Equipment } from \"@shared/schema\";\nimport { Card, CardContent, CardFooter } from \"@/components/ui/card\";\nimport { Loader2, CheckCircle, AlertCircle, XCircle, Map, List } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { MainNav } from \"@/components/main-nav\";\nimport { useTranslation } from \"react-i18next\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { EquipmentFilters, FilterParams } from \"@/components/equipment-filters\";\nimport { MapView } from \"@/components/map-view\";\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function EquipmentListPage() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [filters, setFilters] = useState<FilterParams>({\n    search: \"\",\n    category: \"all\",\n    minPrice: 0,\n    maxPrice: 100000,\n    location: \"\",\n    radius: 50,\n  });\n  const [viewMode, setViewMode] = useState<\"list\" | \"map\">(\"list\");\n  const [imageVersions, setImageVersions] = useState<Record<number, number>>({});\n\n  const { data: equipment, isLoading, error, refetch } = useQuery<Equipment[]>({\n    queryKey: [\"/api/equipment\"],\n    staleTime: 0,\n    refetchOnMount: true\n  });\n\n  // Filter equipment based on all criteria\n  const filteredEquipment = useMemo(() => {\n    if (!equipment) return [];\n\n    return equipment.filter((item) => {\n      const matchesSearch =\n        filters.search === \"\" ||\n        item.name.toLowerCase().includes(filters.search.toLowerCase()) ||\n        item.description.toLowerCase().includes(filters.search.toLowerCase());\n\n      const matchesCategory =\n        filters.category === \"all\" ||\n        item.category.toLowerCase() === filters.category.toLowerCase();\n\n      const matchesPrice =\n        item.dailyRate >= filters.minPrice && item.dailyRate <= filters.maxPrice;\n\n      const matchesLocation =\n        filters.location === \"\" ||\n        item.location.toLowerCase() === filters.location.toLowerCase();\n\n      const matchesSeason = true; //removed seasonal filter\n\n      return matchesSearch && matchesCategory && matchesPrice && matchesLocation && matchesSeason;\n    });\n  }, [equipment, filters]);\n\n  // Handle location selection from map\n  const handleLocationSelect = (location: string) => {\n    setFilters(prev => ({\n      ...prev,\n      location: location.charAt(0).toUpperCase() + location.slice(1)\n    }));\n\n    toast({\n      title: t('filters.locationUpdated'),\n      description: t('filters.locationFilterApplied', { location: location.charAt(0).toUpperCase() + location.slice(1) })\n    });\n  };\n\n  // Handle marker click in map view\n  const handleMarkerClick = (equipment: Equipment) => {\n    if (equipment.id) {\n      window.location.href = `/equipment/${equipment.id}`;\n    }\n  };\n\n  // Reset image versions when equipment changes\n  useEffect(() => {\n    if (equipment) {\n      const versions: Record<number, number> = {};\n      equipment.forEach(item => {\n        versions[item.id] = 0;\n      });\n      setImageVersions(versions);\n    }\n  }, [equipment]);\n\n  // Image refresh handler\n  const refreshImage = (equipmentId: number) => {\n    setImageVersions(prev => ({\n      ...prev,\n      [equipmentId]: (prev[equipmentId] || 0) + 1\n    }));\n  };\n\n  if (isLoading) {\n    return (\n      <div>\n        <MainNav />\n        <div className=\"flex items-center justify-center min-h-[calc(100vh-4rem)]\">\n          <div className=\"text-center\">\n            <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-2\" />\n            <p className=\"text-sm text-muted-foreground\">\n              {t(\"common.loading\")}\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div>\n        <MainNav />\n        <div className=\"container mx-auto px-4 py-8\">\n          <Alert variant=\"destructive\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertDescription>{t(\"common.loadError\")}</AlertDescription>\n          </Alert>\n          <Button onClick={() => refetch()} variant=\"outline\" className=\"mt-4\">\n            {t(\"common.retry\")}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <MainNav />\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <h1 className=\"text-4xl font-bold\">\n            {t(\"equipment.availableEquipment\")}\n          </h1>\n          <ToggleGroup type=\"single\" value={viewMode} onValueChange={(value: \"list\" | \"map\") => setViewMode(value)}>\n            <ToggleGroupItem value=\"list\" aria-label={t(\"view.list\")}>\n              <List className=\"h-4 w-4\" />\n            </ToggleGroupItem>\n            <ToggleGroupItem value=\"map\" aria-label={t(\"view.map\")}>\n              <Map className=\"h-4 w-4\" />\n            </ToggleGroupItem>\n          </ToggleGroup>\n        </div>\n\n        <div className=\"grid grid-cols-12 gap-6\">\n          {viewMode !== \"map\" && (\n            <div className=\"col-span-12 lg:col-span-3\">\n              <EquipmentFilters\n                onFilterChange={setFilters}\n                maxPrice={Math.max(...(equipment?.map(item => item.dailyRate) || [100000]))}\n                isLoading={isLoading}\n              />\n            </div>\n          )}\n\n          <div className={`col-span-12 ${viewMode !== \"map\" ? \"lg:col-span-9\" : \"\"}`}>\n            {viewMode === \"map\" ? (\n              <MapView\n                equipment={filteredEquipment}\n                onMarkerClick={handleMarkerClick}\n                onLocationSelect={handleLocationSelect}\n              />\n            ) : (\n              filteredEquipment && filteredEquipment.length > 0 ? (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  {filteredEquipment.map((item) => (\n                    <Card key={item.id} className={`relative ${!item.availability ? \"opacity-75\" : \"\"}`}>\n                      <Badge\n                        variant={item.availability ? \"success\" : \"destructive\"}\n                        className=\"absolute top-2 right-2 z-10\"\n                      >\n                        {item.availability ? (\n                          <>\n                            <CheckCircle className=\"w-4 h-4 mr-1\" />\n                            {t(\"equipment.available\")}\n                          </>\n                        ) : (\n                          <>\n                            <XCircle className=\"w-4 h-4 mr-1\" />\n                            {t(\"equipment.unavailable\")}\n                          </>\n                        )}\n                      </Badge>\n                      <div className=\"relative w-full h-48\">\n                        <img\n                          src={`${item.imageUrl || \"/placeholder-image.jpg\"}?v=${imageVersions[item.id] || 0}`}\n                          alt={item.name}\n                          className=\"w-full h-full object-cover\"\n                          onError={(e) => {\n                            const target = e.target as HTMLImageElement;\n                            if (!target.src.includes('placeholder-image.jpg')) {\n                              target.src = \"/placeholder-image.jpg\";\n                              refreshImage(item.id);\n                            }\n                          }}\n                        />\n                      </div>\n                      <CardContent className=\"p-4\">\n                        <h2 className=\"text-xl font-semibold mb-2\">{item.name}</h2>\n                        <p className=\"text-muted-foreground mb-4\">\n                          {item.description.slice(0, 100)}...\n                        </p>\n                        <div className=\"flex justify-between items-center\">\n                          <span className=\"text-lg font-medium\">\n                            ₹{item.dailyRate.toLocaleString('en-IN')} {t(\"equipment.perDay\")}\n                          </span>\n                          <span className=\"text-sm text-muted-foreground\">\n                            {item.location}\n                          </span>\n                        </div>\n                      </CardContent>\n                      <CardFooter className=\"p-4 pt-0\">\n                        <Button\n                          asChild\n                          className=\"w-full\"\n                          variant={item.availability ? \"default\" : \"secondary\"}\n                          disabled={!item.availability}\n                        >\n                          <Link to={`/equipment/${item.id}`}>\n                            {item.availability\n                              ? t(\"equipment.viewDetails\")\n                              : t(\"equipment.unavailable\")}\n                          </Link>\n                        </Button>\n                      </CardFooter>\n                    </Card>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <p className=\"text-muted-foreground\">\n                    {t(\"equipment.noEquipment\")}\n                  </p>\n                </div>\n              )\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":9391},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/pages/equipment-edit-page.tsx":{"content":"\nimport { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { useMutation, useQuery } from '@tanstack/react-query';\nimport { Equipment } from '@shared/schema';\nimport { MainNav } from '@/components/main-nav';\nimport { EquipmentForm } from '@/components/equipment-form';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTranslation } from 'react-i18next';\nimport { Loader2 } from 'lucide-react';\n\nexport default function EquipmentEditPage() {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // Fetch equipment data\n  const { \n    data: equipment, \n    isLoading, \n    isError, \n    error \n  } = useQuery<Equipment>({\n    queryKey: [`/api/equipment/${id}`],\n    queryFn: async () => {\n      const response = await fetch(`/api/equipment/${id}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch equipment');\n      }\n      return response.json();\n    }\n  });\n\n  // Update equipment mutation\n  const updateEquipment = useMutation({\n    mutationFn: async (formData: FormData) => {\n      setIsSubmitting(true);\n      const response = await fetch(`/api/equipment/${id}`, {\n        method: 'PATCH',\n        body: formData,\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to update equipment');\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: t('equipment.updateSuccess', 'Equipment Updated'),\n        description: t('equipment.updateSuccessDesc', 'Your equipment has been updated successfully.'),\n      });\n      navigate(`/equipment/${id}`);\n      setIsSubmitting(false);\n    },\n    onError: (error) => {\n      console.error('Error updating equipment:', error);\n      toast({\n        variant: \"destructive\",\n        title: t('common.error', 'Error'),\n        description: error instanceof Error ? error.message : t('equipment.updateError', 'Failed to update equipment'),\n      });\n      setIsSubmitting(false);\n    }\n  });\n\n  const handleSubmit = async (formData: FormData) => {\n    await updateEquipment.mutateAsync(formData);\n  };\n\n  if (isLoading) {\n    return (\n      <div>\n        <MainNav />\n        <div className=\"container mx-auto py-8 flex justify-center items-center min-h-[calc(100vh-4rem)]\">\n          <div className=\"text-center\">\n            <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-2\" />\n            <p className=\"text-sm text-muted-foreground\">\n              {t('common.loading', 'Loading...')}\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (isError) {\n    return (\n      <div>\n        <MainNav />\n        <div className=\"container mx-auto py-8\">\n          <div className=\"bg-destructive/10 p-4 rounded-md text-destructive text-center\">\n            <p>{error instanceof Error ? error.message : t('common.unknownError', 'An unknown error occurred')}</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <MainNav />\n      <div className=\"container mx-auto py-8\">\n        <EquipmentForm \n          equipment={equipment} \n          onSubmit={handleSubmit}\n          isSubmitting={isSubmitting}\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":3429},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/equipment-form-map.tsx":{"content":"import React, { useState, useEffect, useRef } from 'react';\nimport { MapContainer, TileLayer, Marker, useMapEvents } from 'react-leaflet';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTranslation } from 'react-i18next';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\n\ninterface LocationMapProps {\n  initialLocation?: { lat: number; lng: number } | null;\n  onLocationSelect: (lat: number, lng: number) => void;\n}\n\n// Fix Leaflet icon issue\nconst defaultIcon = L.icon({\n  iconUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',\n  shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\nL.Marker.prototype.options.icon = defaultIcon;\n\nfunction LocationPicker({ onLocationSelect }: { onLocationSelect: (latLng: L.LatLng) => void }) {\n  useMapEvents({\n    click(e) {\n      onLocationSelect(e.latlng);\n    },\n  });\n  return null;\n}\n\nexport default function EquipmentFormMap({ initialLocation, onLocationSelect }: LocationMapProps) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [marker, setMarker] = useState<{ lat: number; lng: number } | null>(initialLocation || null);\n  const [isLocating, setIsLocating] = useState(false);\n\n  // Center the map on India if no initial location\n  const defaultCenter: [number, number] = [20.5937, 78.9629];\n  const mapRef = useRef<L.Map | null>(null);\n\n  const handleMapClick = (latLng: L.LatLng) => {\n    const newLocation = { lat: latLng.lat, lng: latLng.lng };\n    setMarker(newLocation);\n    \n    // Call location select callback with coordinates\n    onLocationSelect(newLocation.lat, newLocation.lng);\n    \n    console.log('Map location selected:', newLocation);\n\n    // Try to find nearest city for user reference\n    fetchNearestLocation(newLocation.lat, newLocation.lng)\n      .then(locationName => {\n        if (locationName) {\n          toast({\n            title: t('equipment.locationSelected', 'Location Selected'),\n            description: t('equipment.nearCity', 'Near: {{city}}', { city: locationName }),\n          });\n\n          // Store city name in local storage for form reference\n          localStorage.setItem('lastSelectedLocation', locationName);\n          \n          // Dispatch a custom event with both location name and coordinates\n          const event = new CustomEvent('locationSelected', { \n            detail: { \n              locationName: locationName, \n              coordinates: newLocation \n            } \n          });\n          window.dispatchEvent(event);\n          \n          console.log('Dispatched location event:', {\n            locationName,\n            coordinates: newLocation\n          });\n\n          // Dispatch a custom event so the main form can update its location field\n          const event = new CustomEvent('locationSelected', { \n            detail: { locationName, coordinates: newLocation } \n          });\n          window.dispatchEvent(event);\n        }\n      });\n\n    console.log('Location selected:', newLocation);\n  };\n\n  const handleUseCurrentLocation = () => {\n    setIsLocating(true);\n\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(\n        (position) => {\n          const newLocation = {\n            lat: position.coords.latitude,\n            lng: position.coords.longitude\n          };\n\n          setMarker(newLocation);\n          onLocationSelect(newLocation.lat, newLocation.lng);\n\n          if (mapRef.current) {\n            mapRef.current.flyTo([newLocation.lat, newLocation.lng], 13);\n          }\n\n          setIsLocating(false);\n\n          fetchNearestLocation(newLocation.lat, newLocation.lng)\n            .then(locationName => {\n              if (locationName) {\n                toast({\n                  title: t('equipment.locationDetected', 'Location Detected'),\n                  description: t('equipment.nearCity', 'Near: {{city}}', { city: locationName }),\n                });\n              }\n            });\n        },\n        (error) => {\n          console.error('Geolocation error:', error);\n          toast({\n            variant: \"destructive\",\n            title: t('common.error', 'Error'),\n            description: t('equipment.locationError', 'Could not detect your location. Please select manually.'),\n          });\n          setIsLocating(false);\n        }\n      );\n    } else {\n      toast({\n        variant: \"destructive\",\n        title: t('common.error', 'Error'),\n        description: t('equipment.browserLocationNotSupported', 'Geolocation is not supported by your browser.'),\n      });\n      setIsLocating(false);\n    }\n  };\n\n  // Helper function to find nearest city/location name\n  const fetchNearestLocation = async (lat: number, lng: number): Promise<string | null> => {\n    try {\n      // This is a simple implementation using predefined city coordinates\n      // In a production app, you might want to use a reverse geocoding API\n      const cityCoordinates = {\n        'pune': [18.5204, 73.8567],\n        'mumbai': [19.0760, 72.8777],\n        'delhi': [28.6139, 77.2090],\n        'bangalore': [12.9716, 77.5946],\n        'hyderabad': [17.3850, 78.4867],\n        'chennai': [13.0827, 80.2707],\n        'kolkata': [22.5726, 88.3639],\n        'ahmedabad': [23.0225, 72.5714],\n        'latur': [18.4088, 76.5604],\n        'nilanga': [18.1177, 76.7506],\n        'aurangabad': [19.8762, 75.3433],\n        'nagpur': [21.1458, 79.0882],\n        'nashik': [19.9975, 73.7898],\n        'barshi': [18.2333, 75.6833],\n      };\n\n      let nearestCity = null;\n      let shortestDistance = Infinity;\n\n      Object.entries(cityCoordinates).forEach(([city, [cityLat, cityLng]]) => {\n        const distance = Math.sqrt(\n          Math.pow(lat - cityLat, 2) + Math.pow(lng - cityLng, 2)\n        );\n        if (distance < shortestDistance) {\n          shortestDistance = distance;\n          nearestCity = city;\n        }\n      });\n\n      return nearestCity ? nearestCity.charAt(0).toUpperCase() + nearestCity.slice(1) : null;\n    } catch (error) {\n      console.error('Error finding nearest location:', error);\n      return null;\n    }\n  };\n\n  return (\n    <Card>\n      <CardContent className=\"p-4\">\n        <div className=\"mb-4\">\n          <h3 className=\"text-lg font-semibold mb-2\">{t('equipment.selectLocation', 'Select Equipment Location')}</h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            {t('equipment.locationInstructions', 'Click on the map to select a location or use your current location.')}\n          </p>\n          <Button\n            type=\"button\"\n            onClick={handleUseCurrentLocation}\n            disabled={isLocating}\n            className=\"mb-4\"\n          >\n            {isLocating ? t('common.detecting', 'Detecting...') : t('equipment.useCurrentLocation', 'Use My Current Location')}\n          </Button>\n        </div>\n\n        <div className=\"h-[400px] relative border rounded-md overflow-hidden\">\n          <MapContainer\n            center={initialLocation ? [initialLocation.lat, initialLocation.lng] : defaultCenter}\n            zoom={initialLocation ? 13 : 5}\n            style={{ height: '100%', width: '100%' }}\n            whenCreated={(map) => {\n              mapRef.current = map;\n            }}\n          >\n            <TileLayer\n              attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n              url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n            />\n            <LocationPicker onLocationSelect={handleMapClick} />\n            {marker && (\n              <Marker position={[marker.lat, marker.lng]} />\n            )}\n          </MapContainer>\n        </div>\n\n        {marker && (\n          <div className=\"mt-4 text-sm\">\n            <p className=\"font-semibold\">{t('equipment.selectedCoordinates', 'Selected Coordinates')}:</p>\n            <p>\n              {t('common.latitude', 'Latitude')}: {marker.lat.toFixed(6)}, {' '}\n              {t('common.longitude', 'Longitude')}: {marker.lng.toFixed(6)}\n            </p>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":8276},"client/src/index.css":{"content":"\n@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  :root {\n    --background: 148 30% 97%;\n    --foreground: 140 10% 10%;\n\n    --muted: 148 10% 90%;\n    --muted-foreground: 140 5% 45%;\n\n    --popover: 0 0% 100%;\n    --popover-foreground: 140 10% 10%;\n\n    --card: 0 0% 100%;\n    --card-foreground: 140 10% 10%;\n\n    --border: 148 15% 85%;\n    --input: 148 15% 85%;\n\n    --primary: 142 70% 40%;\n    --primary-foreground: 0 0% 100%;\n\n    --secondary: 40 90% 65%;\n    --secondary-foreground: 140 10% 10%;\n\n    --accent: 148 60% 90%;\n    --accent-foreground: 142 70% 30%;\n\n    --destructive: 0 85% 60%;\n    --destructive-foreground: 0 0% 100%;\n\n    --chart-1: 142 70% 40%;\n    --chart-2: 40 90% 65%;\n    --chart-3: 200 70% 50%;\n    --chart-4: 320 70% 50%;\n    --chart-5: 270 70% 50%;\n\n    --ring: 142 70% 40%;\n\n    --radius: 0.75rem;\n  }\n\n  .dark {\n    --background: 140 15% 15%;\n    --foreground: 0 0% 95%;\n\n    --muted: 140 10% 25%;\n    --muted-foreground: 140 5% 65%;\n\n    --popover: 140 20% 20%;\n    --popover-foreground: 0 0% 95%;\n\n    --card: 140 20% 20%;\n    --card-foreground: 0 0% 95%;\n\n    --border: 140 15% 30%;\n    --input: 140 15% 30%;\n\n    --primary: 142 70% 40%;\n    --primary-foreground: 0 0% 100%;\n\n    --secondary: 40 90% 65%;\n    --secondary-foreground: 140 10% 10%;\n\n    --accent: 140 15% 25%;\n    --accent-foreground: 0 0% 95%;\n\n    --destructive: 0 70% 50%;\n    --destructive-foreground: 0 0% 95%;\n\n    --ring: 142 70% 40%;\n  }\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply bg-background text-foreground;\n    font-feature-settings: \"rlig\" 1, \"calt\" 1;\n  }\n}\n\n/* Animation Utility Classes */\n@layer utilities {\n  .animate-fade-in {\n    animation: fadeIn 0.5s ease-in-out;\n  }\n  \n  .animate-slide-up {\n    animation: slideUp 0.5s ease-out;\n  }\n  \n  .animate-slide-in-right {\n    animation: slideInRight 0.5s ease-out;\n  }\n  \n  .animate-pulse-soft {\n    animation: pulseSoft 2s infinite;\n  }\n  \n  .hover-lift {\n    transition: transform 0.3s ease, box-shadow 0.3s ease;\n  }\n  \n  .hover-lift:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n  }\n}\n\n/* Custom Animations */\n@keyframes fadeIn {\n  from { opacity: 0; }\n  to { opacity: 1; }\n}\n\n@keyframes slideUp {\n  from { \n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to { \n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n@keyframes slideInRight {\n  from {\n    opacity: 0;\n    transform: translateX(30px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes pulseSoft {\n  0%, 100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0.7;\n  }\n}\n\n/* Custom Card Styling */\n.card-gradient {\n  background: linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--accent)) 100%);\n  transition: all 0.3s ease;\n}\n\n.card-gradient:hover {\n  background: linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--primary)/0.2) 100%);\n}\n\n/* Custom shadow effects */\n.shadow-custom {\n  box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.1);\n}\n\n.shadow-custom-hover:hover {\n  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);\n}\n\n/* Button animations */\n.button-pulse {\n  position: relative;\n  overflow: hidden;\n}\n\n.button-pulse::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(255, 255, 255, 0.2);\n  border-radius: inherit;\n  transform: scale(0);\n  transition: transform 0.5s ease;\n}\n\n.button-pulse:hover::after {\n  transform: scale(2);\n  opacity: 0;\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 10px;\n}\n\n::-webkit-scrollbar-track {\n  background: hsl(var(--background));\n}\n\n::-webkit-scrollbar-thumb {\n  background: hsl(var(--primary)/0.5);\n  border-radius: 5px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: hsl(var(--primary)/0.8);\n}\n\n/* Card hover effects */\n.equipment-card {\n  transition: transform 0.3s ease, box-shadow 0.3s ease;\n}\n\n.equipment-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.15);\n}\n\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/* Leaflet Map Styles */\n.leaflet-container {\n  width: 100% !important;\n  height: 100% !important;\n  z-index: 1;\n}\n\n.leaflet-control-container {\n  z-index: 1000;\n  position: relative;\n}\n\n.leaflet-control-zoom {\n  @apply shadow-lg;\n  border: none !important;\n}\n\n.leaflet-control-zoom a {\n  background-color: white !important;\n  color: #666 !important;\n}\n\n.leaflet-popup-content-wrapper {\n  @apply rounded-lg shadow-lg;\n}\n\n.leaflet-popup-content {\n  @apply p-2;\n  margin: 0;\n}\n\n.custom-marker {\n  background: transparent;\n  border: none;\n}","size_bytes":4822},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1877},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  url: string,\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH',\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method: method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});","size_bytes":1420},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\ninterface CommandDialogProps extends DialogProps {}\n\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4879},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { setupAuth } from \"./auth\";\nimport { storage } from \"./storage\";\nimport { insertEquipmentSchema, insertBookingSchema, updateProfileSchema, reviewSchema, receipts } from \"@shared/schema\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\nimport express from 'express';\nimport fs from 'fs';\nimport { format } from 'date-fns';\nimport { createPaymentSession, verifyPaymentSignature, generateReceipt } from \"./payment\";\nimport crypto from 'crypto';\nimport PDFDocument from 'pdfkit';\nimport { GoogleGenerativeAI } from '@google/generative-ai';\n\n// Configure cloudinary\nimport { v2 as cloudinary } from 'cloudinary';\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY, \n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\n\nconst upload = multer({\n  storage: multer.memoryStorage(),\n  fileFilter: (req, file, cb) => {\n    const allowedTypes = ['image/jpeg', 'image/png', 'image/webp'];\n    if (!allowedTypes.includes(file.mimetype)) {\n      const error = new Error('Invalid file type. Only JPEG, PNG and WebP images are allowed.');\n      return cb(error as any, false);\n    }\n    cb(null, true);\n  },\n  limits: {\n    fileSize: 5 * 1024 * 1024 // 5MB limit\n  }\n});\n\nexport function registerRoutes(app: Express): Server {\n  const httpServer = createServer(app);\n  setupAuth(app);\n\n  // Serve uploaded files\n  app.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));\n\n  // User profile routes\n  app.post(\"/api/user/profile/image\", upload.single('image'), async (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n    if (!req.file) return res.status(400).send(\"No image uploaded\");\n\n    try {\n      // Convert buffer to base64 string\n      const base64Image = req.file.buffer.toString('base64');\n      const dataURI = `data:${req.file.mimetype};base64,${base64Image}`;\n\n      const result = await cloudinary.uploader.upload(dataURI, {\n        folder: 'equipment-rental/profiles'\n      });\n\n      const imageUrl = result.secure_url;\n      await storage.updateUser(req.user.id, { imageUrl });\n      res.json({ imageUrl });\n    } catch (error) {\n      console.error('Error uploading profile image:', error);\n      res.status(500).json({ \n        error: 'Failed to upload image',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  app.patch(\"/api/user/profile\", async (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n\n    const parsed = updateProfileSchema.safeParse(req.body);\n    if (!parsed.success) {\n      return res.status(400).json(parsed.error);\n    }\n\n    const updatedUser = await storage.updateUser(req.user.id, parsed.data);\n    res.json(updatedUser);\n  });\n\n  // Equipment routes with enhanced error handling and logging\n  app.get(\"/api/equipment\", async (req, res) => {\n    try {\n      const owned = req.query.owned === 'true';\n      console.log('Fetching equipment, owned filter:', owned);\n\n      // If owned=true, require authentication and only return user's equipment\n      if (owned) {\n        if (!req.isAuthenticated()) {\n          console.log('Unauthorized attempt to view owned equipment');\n          return res.status(401).json({ error: 'Authentication required to view owned equipment' });\n        }\n        const equipment = await storage.listEquipmentByOwner(req.user.id);\n        console.log(`Found ${equipment.length} items owned by user ${req.user.id}`);\n        return res.json(equipment);\n      }\n\n      // Otherwise return all equipment (for the marketplace view)\n      const equipment = await storage.listEquipment();\n      console.log(`Found ${equipment.length} total equipment items`);\n\n      // Instead of filtering, return all equipment with their availability status\n      equipment.forEach(item => {\n        console.log(`Equipment ${item.id}: availability = ${item.availability}`);\n      });\n\n      res.json(equipment);\n    } catch (error) {\n      console.error('Error listing equipment:', error);\n      res.status(500).json({ error: 'Failed to list equipment' });\n    }\n  });\n\n  app.get(\"/api/equipment/:id\", async (req, res) => {\n    try {\n      const equipment = await storage.getEquipment(parseInt(req.params.id));\n      if (!equipment) return res.status(404).json({ error: \"Equipment not found\" });\n      res.json(equipment);\n    } catch (error) {\n      console.error('Error getting equipment:', error);\n      res.status(500).json({ error: 'Failed to get equipment details' });\n    }\n  });\n\n  // Enhanced equipment creation endpoint\n  app.post(\"/api/equipment\", upload.single('image'), async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    try {\n      // Validate file upload\n      if (!req.file) {\n        return res.status(400).json({\n          error: 'Image is required',\n          details: 'Please upload an equipment image'\n        });\n      }\n\n      console.log('Uploading equipment image to Cloudinary...');\n\n      // Convert buffer to base64 string\n      const base64Image = req.file.buffer.toString('base64');\n      const dataURI = `data:${req.file.mimetype};base64,${base64Image}`;\n\n      // Upload to cloudinary with specific options\n      const imageResult = await cloudinary.uploader.upload(dataURI, {\n        folder: 'equipment-rental/equipment',\n        resource_type: 'image',\n        quality: 'auto',\n        fetch_format: 'auto'\n      });\n\n      console.log('Cloudinary upload successful:', {\n        publicId: imageResult.public_id,\n        url: imageResult.secure_url\n      });\n\n      // Parse and validate JSON fields\n      let specs = {};\n      let features = [];\n\n      try {\n        if (req.body.specs) {\n          specs = JSON.parse(req.body.specs);\n          if (typeof specs !== 'object' || Array.isArray(specs)) {\n            throw new Error('Specs must be an object');\n          }\n        }\n\n        if (req.body.features) {\n          features = JSON.parse(req.body.features);\n          if (!Array.isArray(features)) {\n            throw new Error('Features must be an array');\n          }\n        }\n      } catch (error) {\n        return res.status(400).json({\n          error: 'Invalid JSON format',\n          details: error instanceof Error ? error.message : 'Invalid specs or features format'\n        });\n      }\n\n      // Get coordinates from cityCoordinates map\n      const cityCoordinates: Record<string, number[]> = {\n        'pune': [18.5204, 73.8567],\n        'mumbai': [19.0760, 72.8777],\n        'delhi': [28.6139, 77.2090],\n        'bangalore': [12.9716, 77.5946],\n        'hyderabad': [17.3850, 78.4867],\n        'chennai': [13.0827, 80.2707],\n        'kolkata': [22.5726, 88.3639],\n        'ahmedabad': [23.0225, 72.5714],\n        'latur': [18.4088, 76.5604],\n        'nilanga': [18.1177, 76.7506],\n        'aurangabad': [19.8762, 75.3433],\n        'chh. sambhajinagar': [19.8762, 75.3433],\n        'nagpur': [21.1458, 79.0882],\n        'nashik': [19.9975, 73.7898],\n        'barshi': [18.2333, 75.6833],\n      };\n\n      // Clean and format location string\n      const location = req.body.location?.toLowerCase().trim();\n\n      // Handle custom coordinates if provided\n      let coordinates = null;\n\n      // First check if direct coordinates were provided\n      if (req.body.latitudeCoord && req.body.longitudeCoord) {\n        const lat = parseFloat(req.body.latitudeCoord);\n        const lng = parseFloat(req.body.longitudeCoord);\n        if (!isNaN(lat) && !isNaN(lng)) {\n          coordinates = [lat, lng];\n          console.log('Using custom coordinates from form:', coordinates);\n        }\n      }\n\n      // If no direct coordinates, try to find from city map\n      if (!coordinates && location) {\n        // Normalize location for comparison\n        const normalizedLocation = location.toLowerCase().trim();\n\n        // Try different location formats in the city map\n        coordinates = cityCoordinates[normalizedLocation] || \n                      cityCoordinates[normalizedLocation.replace('.', '')] || // Try without period\n                      cityCoordinates[normalizedLocation.replace(' ', '')] || // Try without space\n                      null;\n\n        if (coordinates) {\n          console.log('Found coordinates for location:', location, coordinates);\n        } else {\n          console.log('No coordinates found for location:', location);\n\n          // If location is provided but no coordinates found, try more thorough matching\n          if (location && location.length > 0) {\n            // Try a fuzzy match with cityCoordinates keys\n            let bestMatch = '';\n            let maxSimilarity = 0;\n\n            Object.keys(cityCoordinates).forEach(city => {\n              // Check if location contains city name or vice versa\n              if (city.includes(normalizedLocation) || normalizedLocation.includes(city)) {\n                const similarity = Math.min(city.length, normalizedLocation.length) / \n                                  Math.max(city.length, normalizedLocation.length);\n                if (similarity > maxSimilarity) {\n                  maxSimilarity = similarity;\n                  bestMatch = city;\n                }\n              }\n            });\n\n            if (bestMatch && maxSimilarity > 0.5) {\n              coordinates = cityCoordinates[bestMatch];\n              console.log(`Found fuzzy match for \"${location}\": \"${bestMatch}\"`, coordinates);\n            } else {\n              // Split location by commas and check each part\n              const locationParts = normalizedLocation.split(',');\n              for (const part of locationParts) {\n                const trimmedPart = part.trim();\n                if (cityCoordinates[trimmedPart]) {\n                  coordinates = cityCoordinates[trimmedPart];\n                  console.log(`Found coordinates for location part \"${trimmedPart}\"`, coordinates);\n                  break;\n                }\n              }\n\n              // If still no coordinates, use default\n              if (!coordinates) {\n                coordinates = [20.5937, 78.9629]; // Default to center of India\n                console.log('Using default coordinates for unknown location:', location);\n              }\n            }\n          }\n        }\n      }\n\n      const equipmentData = {\n        name: req.body.name,\n        description: req.body.description,\n        category: req.body.category,\n        dailyRate: parseInt(req.body.dailyRate),\n        location: req.body.location,\n        specs,\n        features,\n        ownerId: req.user.id,\n        imageUrl: imageResult.secure_url,\n        availability: true,\n        latitudeCoord: coordinates ? coordinates[0].toString() : null,\n        longitudeCoord: coordinates ? coordinates[1].toString() : null\n      };\n\n      const parsed = insertEquipmentSchema.safeParse(equipmentData);\n      if (!parsed.success) {\n        console.error('Equipment validation failed:', {\n          data: equipmentData,\n          errors: parsed.error.errors\n        });\n        return res.status(400).json({\n          error: 'Validation failed',\n          details: parsed.error.errors\n        });\n      }\n\n      const equipment = await storage.createEquipment(parsed.data);\n      console.log('Equipment created successfully:', {\n        id: equipment.id,\n        name: equipment.name,\n        imageUrl: equipment.imageUrl\n      });\n\n      res.status(201).json({\n        message: 'Equipment created successfully',\n        equipment\n      });\n    } catch (error) {\n      console.error('Error creating equipment:', error);\n      res.status(500).json({\n        error: 'Failed to create equipment',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Add equipment update endpoint\n  app.patch(\"/api/equipment/:id\", upload.single('image'), async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    try {\n      const equipmentId = parseInt(req.params.id);\n      const equipment = await storage.getEquipment(equipmentId);\n\n      if (!equipment) {\n        return res.status(404).json({ error: 'Equipment not found' });\n      }\n\n      // Only allow equipment owner or admin to update\n      if (equipment.ownerId !== req.user.id && !req.user.isAdmin) {\n        return res.status(403).json({ error: 'Not authorized to update this equipment' });\n      }\n\n      let updateData: any = { ...req.body };\n\n      // Handle image upload if new image is provided\n      if (req.file) {\n        console.log('Uploading new equipment image to Cloudinary...');\n\n        const base64Image = req.file.buffer.toString('base64');\n        const dataURI = `data:${req.file.mimetype};base64,${base64Image}`;\n\n        const imageResult = await cloudinary.uploader.upload(dataURI, {\n          folder: 'equipment-rental/equipment',\n          resource_type: 'image',\n          quality: 'auto',\n          fetch_format: 'auto'\n        });\n\n        console.log('Cloudinary upload successful:', {\n          publicId: imageResult.public_id,\n          url: imageResult.secure_url\n        });\n\n        updateData.imageUrl = imageResult.secure_url;\n      }\n\n      // Handle specs and features parsing\n      if (req.body.specs) {\n        try {\n          updateData.specs = JSON.parse(req.body.specs);\n          if (typeof updateData.specs !== 'object' || Array.isArray(updateData.specs)) {\n            throw new Error('Specs must be an object');\n          }\n        } catch (e) {\n          return res.status(400).json({ error: 'Invalid specs format' });\n        }\n      }\n\n      if (req.body.features) {\n        try {\n          updateData.features = JSON.parse(req.body.features);\n          if (!Array.isArray(updateData.features)) {\n            throw new Error('Features must be an array');\n          }\n        } catch (e) {\n          return res.status(400).json({ error: 'Invalid features format' });\n        }\n      }\n\n      if (req.body.dailyRate) {\n        updateData.dailyRate = parseInt(req.body.dailyRate);\n      }\n\n      // Always update coordinates when equipment is modified\n      const cityCoordinates: Record<string, number[]> = {\n        'pune': [18.5204, 73.8567],\n        'mumbai': [19.0760, 72.8777],\n        'delhi': [28.6139, 77.2090],\n        'bangalore': [12.9716, 77.5946],\n        'hyderabad': [17.3850, 78.4867],\n        'chennai': [13.0827, 80.2707],\n        'kolkata': [22.5726, 88.3639],\n        'ahmedabad': [23.0225, 72.5714],\n        'latur': [18.4088, 76.5604],\n        'nilanga': [18.1177, 76.7506],\n        'aurangabad': [19.8762, 75.3433],\n        'chh. sambhajinagar': [19.8762, 75.3433],\n        'nagpur': [21.1458, 79.0882],\n        'nashik': [19.9975, 73.7898],\n        'barshi': [18.2333, 75.6833],\n      };\n\n      // First check if direct coordinates were provided (highest priority)\n      if (req.body.latitudeCoord && req.body.longitudeCoord) {\n        const lat = parseFloat(req.body.latitudeCoord);\n        const lng = parseFloat(req.body.longitudeCoord);\n        if (!isNaN(lat) && !isNaN(lng)) {\n          updateData.latitudeCoord = lat.toString();\n          updateData.longitudeCoord = lng.toString();\n          console.log('Updating with custom coordinates:', [lat, lng]);\n        }\n      } \n      // If location changed but no coordinates provided, try to determine from location\n      else if (req.body.location) {\n        const location = req.body.location.toLowerCase().trim();\n\n        // Try to find from city map\n        const coordinates = cityCoordinates[location] || \n                          cityCoordinates[location.replace('.', '')] || \n                          cityCoordinates[location.replace(' ', '')] || \n                          null;\n\n        if (coordinates) {\n          updateData.latitudeCoord = coordinates[0].toString();\n          updateData.longitudeCoord = coordinates[1].toString();\n          console.log('Updated coordinates for location:', location, coordinates);\n        } else {\n          console.log('No coordinates found for location:', location);\n\n          // Try fuzzy matching for better location mapping\n          let bestMatch = '';\n          let maxSimilarity = 0;\n\n          Object.keys(cityCoordinates).forEach(city => {\n            if (city.includes(location) || location.includes(city)) {\n              const similarity = Math.min(city.length, location.length) / \n                                Math.max(city.length, location.length);\n              if (similarity > maxSimilarity) {\n                maxSimilarity = similarity;\n                bestMatch = city;\n              }\n            }\n          });\n\n          if (bestMatch && maxSimilarity > 0.5) {\n            const fuzzyCoordinates = cityCoordinates[bestMatch];\n            updateData.latitudeCoord = fuzzyCoordinates[0].toString();\n            updateData.longitudeCoord = fuzzyCoordinates[1].toString();\n            console.log(`Found fuzzy match for \"${location}\": \"${bestMatch}\"`, fuzzyCoordinates);\n          } else {\n            // If all else fails, set default coordinates for center of India\n            updateData.latitudeCoord = \"20.5937\";\n            updateData.longitudeCoord = \"78.9629\";\n            console.log('Using default coordinates for unknown location:', location);\n          }\n        }\n      }\n\n      console.log('Updating equipment with data:', {\n        id: equipmentId,\n        ...updateData\n      });\n\n      const updated = await storage.updateEquipment(equipmentId, updateData);\n      res.json(updated);\n    } catch (error) {\n      console.error('Error updating equipment:', error);\n      res.status(500).json({\n        error: 'Failed to update equipment',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Update the availability endpoint to be more robust\n  app.get(\"/api/equipment/:id/availability\", async (req, res) => {\n    try {\n      const equipmentId = parseInt(req.params.id);\n      if (isNaN(equipmentId)) {\n        console.error('Invalid equipment ID:', req.params.id);\n        return res.status(400).json({ error: 'Invalid equipment ID' });\n      }\n\n      // Parse dates with validation\n      const now = new Date();\n      let startDate = now;\n      let endDate = new Date(now);\n      endDate.setDate(endDate.getDate() + 30); // Default to 30 days from now\n\n      if (req.query.startDate) {\n        const parsedStart = new Date(req.query.startDate as string);\n        if (!isNaN(parsedStart.getTime())) {\n          startDate = parsedStart;\n        } else {\n          console.error('Invalid start date:', req.query.startDate);\n          return res.status(400).json({ error: 'Invalid start date format' });\n        }\n      }\n\n      if (req.query.endDate) {\n        const parsedEnd = new Date(req.query.endDate as string);\n        if (!isNaN(parsedEnd.getTime())) {\n          endDate = parsedEnd;\n        } else {\n          console.error('Invalid end date:', req.query.endDate);\n          return res.status(400).json({ error: 'Invalid end date format' });\n        }\n      }\n\n      // Ensure startDate is not in the past\n      if (startDate < now) {\n        startDate = now;\n      }\n\n      // Ensure endDate is after startDate\n      if (endDate <= startDate) {\n        endDate = new Date(startDate);\n        endDate.setDate(startDate.getDate() + 30);\n      }\n\n      // First check if equipment exists\n      const equipment = await storage.getEquipment(equipmentId);\n      if (!equipment) {\n        return res.status(404).json({ error: 'Equipment not found' });\n      }\n\n      // Check if equipment is generally available\n      if (!equipment.availability) {\n        return res.json({\n          available: false,\n          message: 'Equipment is not available for booking'\n        });\n      }\n\n      // Check specific date range availability\n      const isAvailable = await storage.checkEquipmentAvailability(\n        equipmentId,\n        startDate,\n        endDate\n      );\n\n      res.json({\n        available: isAvailable,\n        startDate: startDate.toISOString(),\n        endDate: endDate.toISOString(),\n        message: isAvailable ? 'Equipment is available for the selected dates' : 'Equipment is not available for the selected dates'\n      });\n    } catch (error) {\n      console.error('Error checking equipment availability:', error);\n      res.status(500).json({\n        error: 'Failed to check equipment availability',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Add equipment availability update endpoint for owners\n  app.patch(\"/api/equipment/:id/availability\", async (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n\n    try {\n      const equipmentId = parseInt(req.params.id);\n      const equipment = await storage.getEquipment(equipmentId);\n\n      if (!equipment) {\n        return res.status(404).json({ error: \"Equipment not found\" });\n      }\n\n      // Verify ownership\n      if (equipment.ownerId !== req.user.id) {\n        return res.status(403).json({ error: \"Not authorized to update this equipment\" });\n      }\n\n      const { available } = req.body;\n\n      // Update equipment availability\n      const updated = await storage.updateEquipment(equipmentId, {\n        availability: available\n      });\n\n      res.json(updated);\n    } catch (error) {\n      console.error('Error updating availability:', error);\n      res.status(500).json({ error: \"Failed to update availability\" });\n    }\n  });\n\n  // Add equipment delete endpoint\n  app.delete(\"/api/equipment/:id\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ error: 'Authentication required' });\n    }\n\n    try {\n      const equipmentId = parseInt(req.params.id);\n      const equipment = await storage.getEquipment(equipmentId);\n\n      if (!equipment) {\n        return res.status(404).json({ error: \"Equipment not found\" });\n      }\n\n      // Only allow equipment owner to delete\n      if (equipment.ownerId !== req.user.id && !req.user.isAdmin) {\n        return res.status(403).json({ error: \"Not authorized to delete this equipment\" });\n      }\n\n      // Delete equipment from storage\n      await storage.deleteEquipment(equipmentId);\n\n      // Also delete any related bookings\n      await storage.deleteEquipmentBookings(equipmentId);\n\n      res.json({ success: true, message: \"Equipment deleted successfully\" });\n    } catch (error) {\n      console.error('Error deleting equipment:', error);\n      res.status(500).json({\n        error: \"Failed to delete equipment\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n\n  // Update the booking creation endpoint to use Razorpay\n  app.post(\"/api/bookings\", async (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n\n    try {\n      const bookingData = {\n        ...req.body,\n        userId: req.user.id,\n        status: 'pending'\n      };\n\n      const parsed = insertBookingSchema.safeParse(bookingData);\n      if (!parsed.success) {\n        return res.status(400).json({\n          error: \"Invalid booking data\",\n          details: parsed.error.errors\n        });\n      }\n\n      const equipment = await storage.getEquipment(parsed.data.equipmentId);\n      if (!equipment) {\n        return res.status(404).json({ error: \"Equipment not found\" });\n      }\n\n      // Check if equipment is available\n      if (!equipment.availability) {\n        return res.status(400).json({ error: \"Equipment is not available for booking\" });\n      }\n\n      // Calculate rental duration in days including both start and end dates\n      const startDate = new Date(parsed.data.startDate);\n      const endDate = new Date(parsed.data.endDate);\n      const totalDays = Math.max(1, Math.ceil(\n        (endDate.getTime() - startDate.getTime()) /\n        (1000 * 3600 * 24)\n      ) + 1); // Add 1 to include both start and end dates\n\n      // Calculate total amount based on daily rate and duration\n      const totalAmount = equipment.dailyRate * totalDays;\n\n      // First check if equipment is still available\n      const isAvailable = await storage.checkEquipmentAvailability(\n        parsed.data.equipmentId,\n        startDate,\n        endDate\n      );\n\n      if (!isAvailable) {\n        return res.status(400).json({ error: \"Equipment is no longer available for these dates\" });\n      }\n\n      // Create booking record with calculated total price\n      const booking = await storage.createBooking({\n        ...parsed.data,\n        totalPrice: totalAmount,\n        startDate,\n        endDate,\n        status: 'pending'\n      });\n\n      try {\n        // Lock equipment by marking it unavailable\n        await storage.updateEquipment(parsed.data.equipmentId, {\n          availability: false\n        });\n\n        // Create Razorpay order\n        const razorpayOrder = await createPaymentSession(booking.id, totalAmount * 100, equipment.name); // Amount in paise\n\n        // Update booking with Razorpay order info\n        const updatedBooking = await storage.updateBooking(booking.id, {\n          status: 'awaiting_payment',\n          razorpayOrderId: razorpayOrder.id\n        });\n\n        console.log(`Created booking ${booking.id} for equipment ${equipment.id}, awaiting payment`);\n\n        // Return booking info with complete Razorpay configuration\n        res.status(201).json({\n          booking: updatedBooking,\n          razorpayConfig: {\n            key: razorpayOrder.keyId,\n            amount: razorpayOrder.amount,\n            currency: razorpayOrder.currency,\n            name: razorpayOrder.name,\n            description: razorpayOrder.description,\n            order_id: razorpayOrder.id,\n            prefill: razorpayOrder.prefill\n          }\n        });\n      } catch (paymentError) {\n        console.error('Error in payment order creation:', paymentError);\n\n        // Revert equipment availability if payment setup fails\n        await storage.updateEquipment(parsed.data.equipmentId, {\n          availability: true\n        });\n\n        // Update booking status to payment_failed\n        await storage.updateBooking(booking.id, { status: 'payment_failed' });\n\n        res.status(400).json({\n          error: \"Payment order creation failed\",\n          details: paymentError instanceof Error ? paymentError.message : \"Unknown payment error\"\n        });\n      }\n    } catch (error) {\n      console.error('Error in booking creation:', error);\n      res.status(500).json({\n        error: \"Failed to process booking\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Update the receipt generation in payment verification endpoint\n  app.post(\"/api/bookings/verify-payment\", express.json(), async (req, res) => {\n    try {\n      const { bookingId, razorpay_order_id, razorpay_payment_id, razorpay_signature } = req.body;\n\n      if (!bookingId || !razorpay_order_id || !razorpay_payment_id || !razorpay_signature) {\n        console.error('Missing required payment verification fields:', req.body);\n        return res.status(400).json({\n          error: 'Missing required payment details',\n          details: 'All payment verification fields are required'\n        });\n      }\n\n      // Get the booking details\n      const booking = await storage.getBooking(bookingId);\n      if (!booking) {\n        console.error(`Booking not found for verification: ${bookingId}`);\n        return res.status(404).json({ error: 'Booking not found' });\n      }\n\n      // Get equipment details for receipt\n      const equipment = await storage.getEquipment(booking.equipmentId);\n      if (!equipment) {\n        console.error(`Equipment not found for booking: ${bookingId}`);\n        return res.status(404).json({ error: 'Equipment not found' });\n      }\n\n      // Verify payment signature\n      const isValid = await verifyPaymentSignature(razorpay_order_id, razorpay_payment_id, razorpay_signature);\n      if (!isValid) {\n        console.error('Invalid payment signature for booking:', bookingId);\n        return res.status(400).json({ error: 'Invalid payment signature' });\n      }\n\n      // Update booking status\n      const updatedBooking = await storage.updateBooking(bookingId, {\n        status: 'paid',\n        razorpayPaymentId: razorpay_payment_id\n      });\n\n      console.log('Creating receipt with metadata...');\n\n      // Create receipt with simplified metadata\n      // booking.totalPrice is already in rupees\n      const receipt = await storage.createReceipt({\n        bookingId: booking.id,\n        userId: booking.userId,\n        amount: booking.totalPrice, // Amount in rupees (from booking)\n        status: 'paid',\n        razorpayPaymentId: razorpay_payment_id,\n        metadata: {\n          equipment_name: equipment.name,\n          booking_dates: {\n            start: booking.startDate.toISOString(),\n            end: booking.endDate.toISOString()\n          },\n          payment_method: 'razorpay'\n        },\n        generatedAt: new Date()\n      });\n\n      console.log(`Successfully generated receipt for booking ${bookingId}`);\n\n      res.json({\n        success: true,\n        booking: updatedBooking,\n        receipt,\n        message: 'Payment verified and receipt generated successfully'\n      });\n    } catch (error) {\n      console.error('Payment verification error:', error);\n      res.status(500).json({\n        error: 'Payment verification failed',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Add receipt listing endpoint\n  app.get(\"/api/receipts\", async (req, res) => {\n    if (!req.isAuthenticated() || !req.user) {\n      return res.status(401).json({ error: \"Authentication required\" });\n    }\n\n    try {\n      const receipts = await storage.listReceipts(req.user.id);\n\n      // Log receipt amounts for debugging\n      console.log('Receipt amounts:', receipts.map(r => ({\n        id: r.id,\n        amountInRupees: r.amount\n      })));\n\n      res.json(receipts.map(receipt => ({\n        ...receipt,\n        amount: Number(receipt.amount), // Ensure amount is a number\n        generatedAt: receipt.generatedAt.toISOString()\n      })));\n    } catch (error) {\n      console.error('Error fetching receipts:', error);\n      res.status(500).json({\n        error: \"Failed to fetch receipts\",\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Add endpoint to get a specific receipt\n  app.get(\"/api/receipts/:id\", async (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n\n    try {\n      const receiptId = parseInt(req.params.id);\n      const receipt = await storage.getReceipt(receiptId);\n\n      if (!receipt) {\n        return res.status(404).json({ error: \"Receipt not found\" });\n      }\n\n            // Check if the receipt belongs to the authenticated user\n      if (receipt.userId !== req.user.id) {\n        return res.status(403).json({ error: \"Not authorized to access this receipt\" });\n      }\n\n      res.json({\n        ...receipt,\n        amount: Number(receipt.amount),\n        generatedAt: receipt.generatedAt.toISOString()\n      });\n    } catch (error) {\n      console.error('Error fetching receipt:', error);\n      res.status(500).json({ error: \"Failed to fetch receipt\" });\n    }\n  });\n  // Add endpoint to get a specific receipt by bookingId\n  app.get(\"/api/bookings/:id/receipt\", async (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n\n    try {\n      const bookingId = parseInt(req.params.id);\n      if (isNaN(bookingId)) {\n        return res.status(400).json({ error: \"Invalid booking ID\" });\n      }\n\n      const booking = await storage.getBooking(bookingId);\n      if (!booking) {\n        return res.status(404).json({ error: \"Booking not found\" });\n      }\n\n      const receipt = await storage.getReceiptByBookingId(bookingId);\n      if (!receipt) {\n        // Create receipt if it doesn't exist for a paid booking\n        if (booking.status === 'paid') {\n          const newReceipt = await storage.createReceipt({\n            bookingId: booking.id,\n            userId: booking.userId,\n            amount: booking.totalPrice, // Store in rupees\n            status: 'paid',\n            razorpayPaymentId: booking.razorpayPaymentId,\n            metadata: {\n              equipment_name: (await storage.getEquipment(booking.equipmentId))?.name,\n              booking_dates: {\n                start: booking.startDate.toISOString(),\n                end: booking.endDate.toISOString()\n              },\n              payment_method: 'razorpay'\n            },\n            generatedAt: new Date()\n          });\n          return res.json(newReceipt);\n        }\n        return res.status(404).json({ error: \"Receipt not found\" });\n      }\n\n      // Check if the receipt belongs to the authenticated user\n      if (receipt.userId !== req.user.id) {\n        return res.status(403).json({ error: \"Not authorized to access this receipt\" });\n      }\n\n      res.json(receipt);\n    } catch (error) {\n      console.error('Error fetching receipt:', error);\n      res.status(500).json({ error: \"Failed to fetch receipt\" });\n    }\n  });\n\n  // Update the webhook handler\n  app.post(\"/api/webhooks/razorpay\", express.raw({ type: 'application/json' }), async (req, res) => {\n    try {\n      const webhookSecret = process.env.RAZORPAY_WEBHOOK_SECRET;\n\n      // If webhook secret is configured, verify the signature\n      if (webhookSecret) {\n        const signature = req.headers['x-razorpay-signature'];\n        if (!signature) {\n          return res.status(400).json({ error: 'Missing signature' });\n        }\n\n        const expectedSignature = crypto\n          .createHmac('sha256', webhookSecret)\n          .update(req.body)\n          .digest('hex');\n\n        if (signature !== expectedSignature) {\n          return res.status(400).json({ error: 'Invalid signature' });\n        }\n      }\n\n      const event = JSON.parse(req.body.toString());\n      const result = await handleWebhookEvent(event);\n\n      if (result) {\n        if (result.status === 'success' && result.paymentId) {\n          // Update booking status\n          const booking = await storage.updateBooking(result.bookingId, {\n            status: 'paid',\n            razorpayPaymentId: result.paymentId\n          });\n\n          // Also update equipment availability\n          if (booking) {\n            await storage.updateEquipment(booking.equipmentId, {\n              availability: false\n            });\n\n            // Generate receipt with the payment ID\n            await generateReceipt(result.bookingId, result.paymentId);\n          }\n        } else if (result.status === 'failed') {\n          // Update booking status to failed and ensure equipment remains available\n          const booking = await storage.updateBooking(result.bookingId, {\n            status: 'payment_failed'\n          });\n\n          if (booking) {\n            await storage.updateEquipment(booking.equipmentId, {\n              availability: true\n            });\n          }\n        }\n      }\n\n      res.json({ received: true });\n    } catch (err) {\n      console.error('Webhook Error:', err);\n      if (err instanceof Error) {\n        res.status(400).send(`Webhook Error: ${err.message}`);\n      } else {\n        res.status(400).send('Webhook Error: Unknown error');\n      }\n    }\n  });\n\n  // Fix for the typo in the payment-config endpoint\n  app.get(\"/api/bookings/:id/payment-config\", async (req, res) => {\n    if (!req.isAuthenticated()) return res.sendStatus(401);\n\n    try {\n      const bookingId = parseInt(req.params.id);\n      const booking = await storage.getBooking(bookingId);\n\n      if (!booking) {\n        return res.status(404).json({ error: \"Booking not found\" });\n      }\n\n      if (booking.userId !== req.user.id) {\n        return res.status(403).json({ error: \"Not authorized to access this booking\" });\n      }\n\n      const equipment = await storage.getEquipment(booking.equipmentId);\n      if (!equipment) {\n        return res.status(404).json({ error: \"Equipment not found\" });\n      }\n\n      const config = await createPaymentSession(bookingId, booking.totalPrice * 100, equipment.name); // Amount in paise\n      res.json(config);\n    } catch (error) {\n      console.error('Error getting payment configuration:', error);\n      res.status(500).json({\n        error: \"Failed to get payment configuration\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Booking details endpoint with authentication and authorization\n  app.get(\"/api/bookings/:id\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      console.log('Unauthorized attempt to access booking:', req.params.id);\n      return res.status(401).json({ error: \"Authentication required\" });\n    }\n\n    try {\n      const bookingId = parseInt(req.params.id);\n      if (isNaN(bookingId)) {\n        console.error('Invalid booking ID:', req.params.id);\n        return res.status(400).json({ error: \"Invalid booking ID\" });\n      }\n\n      console.log(`Looking up booking ${bookingId} for user ${req.user.id}`);\n      const booking = await storage.getBooking(bookingId);\n\n      if (!booking) {\n        console.log(`Booking ${bookingId} not found`);\n        return res.status(404).json({ error: \"Booking not found\" });\n      }\n\n      // Check if the user has permission to view this booking\n      if (booking.userId !== req.user.id && !req.user.isAdmin) {\n        console.log(`User ${req.user.id} not authorized to view booking ${bookingId}`);\n        return res.status(403).json({ error: \"Not authorized to view this booking\" });\n      }\n\n      console.log(`Successfully retrieved booking ${bookingId}`);\n      res.json(booking);\n    } catch (error) {\n      console.error('Error getting booking:', error);\n      res.status(500).json({ error: \"Failed to get bookingdetails\" });\n    }\n  });\n\n  // Add bookings list endpoint with enhanced logging\n  app.get(\"/api/bookings\", async (req, res) => {\n    try {\n      if (!req.isAuthenticated()) {\n        console.log('Unauthorized attempt to access bookings');\n        return res.status(401).json({ error: \"Authentication required\" });\n      }\n\n      console.log('User requesting bookings:', {\n        userId: req.user.id,\n        isAdmin: req.user.isAdmin,\n        queryUserId: req.query.userId\n      });\n\n      // If a specific userId is providedin query, verify access rights\n      const requestedUserId = req.query.userId ? parseInt(req.query.userId as string) : undefined;\n\n      if (requestedUserId && requestedUserId !== req.user.id && !req.user.isAdmin) {\n        console.log('User not authorized to view other users bookings');\n        return res.status(403).json({ error: \"Not authorized to view these bookings\" });\n      }\n\n      // Use the authenticated user's ID if no specific ID isrequested\n      const userIdToQuery = requestedUserId || req.user.id;\n      console.log('Fetching bookings for userId:',userIdToQuery);\n\n      const bookings = await storage.listBookings(userIdToQuery);\n      console.log(`Found ${bookings.length} bookings for user ${userIdToQuery}`);\n\n      res.json(bookings);\n    } catch (error) {\n      console.error('Error fetching bookings:', error);\n      res.status(500).json({\n        error: \"Failed to fetch bookings\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Equipment comparison routes\n  app.post(\"/api/comparisons/add/:equipmentId\", async (req, res) => {\n    if (!req.isAuthenticated() || !req.user) {\n      return res.sendStatus(401);\n    }\n\n    try {\n      const equipmentId = parseInt(req.params.equipmentId);\n      await storage.addToComparison(req.user.id, equipmentId);\n      res.sendStatus(200);\n    } catch (error) {\n      console.error('Error adding to comparison:', error);\n      res.status(500).json({ error: \"Failed to add to comparison\" });\n    }\n  });\n\n  app.delete(\"/api/comparisons/remove/:equipmentId\", async (req, res) => {\n    if (!req.isAuthenticated() || !req.user) {\n      return res.sendStatus(401);\n    }\n\n    try {\n      const equipmentId = parseInt(req.params.equipmentId);\n      await storage.removeFromComparison(req.user.id, equipmentId);\n      res.sendStatus(200);\n    } catch (error) {\n      console.error('Error removing from comparison:', error);\n      res.status(500).json({ error: \"Failed to remove from comparison\" });\n    }\n  });\n\n  app.get(\"/api/comparisons\", async (req, res) => {\n    if (!req.isAuthenticated() || !req.user) {\n      return res.sendStatus(401);\n    }\n\n    try {\n      const equipment = await storage.getComparison(req.user.id);\n      res.json(equipment);\n    } catch (error) {\n      console.error('Error fetching comparison:', error);\n      res.status(500).json({ error: \"Failed to fetch comparison\" });\n    }\n  });\n\n  // Add recommendation routes\n  app.get(\"/api/recommendations\", async (req, res) => {\n    if (!req.isAuthenticated() || !req.user) {\n      return res.sendStatus(401);\n    }\n\n    try {\n      const user = await storage.getUser(req.user.id);\n      if (!user) {\n        return res.status(404).json({ error: \"User not found\" });\n      }\n\n      // Get user's booking history\n      const userBookings = await storage.listBookings(user.id);\n\n      // Get all equipment\n      const allEquipment = await storage.listEquipment();\n\n      // Calculate recommendations based on user preferences and history\n      const recommendations = allEquipment.map(equipment => {\n        let score = 0;\n        let reasons = [];\n\n        // Category preference matching\n        if (user.preferences.preferredCategories.includes(equipment.category)) {\n          score += 30;\n          reasons.push(`Matches your preferred category: ${equipment.category}`);        }\n\n        // Location preference matching\n        if (user.preferences.preferredLocations.includes(equipment.location)) {\n          score += 20;\n          reasons.push(`Available in your preferred location: ${equipment.location}`);\n        }\n\n        // Price range matching\n        if (equipment.dailyRate >= user.preferences.priceRange.min &&\n          equipment.dailyRate <= user.preferences.priceRange.max) {\n          score += 15;\n          reasons.push('Within your preferred price range');\n        }\n\n        // Feature matching\n        const matchingFeatures = equipment.features.filter(feature =>\n          user.preferences.features.includes(feature)\n        );\n        if (matchingFeatures.length > 0) {\n          score += 5 * matchingFeatures.length;\n          reasons.push(`Has ${matchingFeatures.length} features you prefer`);\n        }\n\n        // Popularity bonus\n        if (equipment.popularity > 0) {\n          score += Math.min(10, equipment.popularity);\n        }\n\n        // Previous rental bonus\n        if (userBookings.some(booking => booking.equipmentId === equipment.id)) {\n          score += 10;\n          reasons.push('You have rented this before');\n        }\n\n        return {\n          equipment,\n          score: Math.min(100, score), // Cap at 100%\n          reason: reasons[0] || 'Recommended based on your preferences'\n        };\n      });\n\n      // Sort by score and take top recommendations\n      const topRecommendations = recommendations\n        .filter(rec => rec.score > 30) // Only include items with decent match\n        .sort((a, b) => b.score - a.score)\n        .slice(0, 5); // Limit to top 5\n\n      // Store recommendations\n      await Promise.all(topRecommendations.map(async (rec) => {\n        await storage.createRecommendation({\n          userId: user.id,\n          equipmentId: rec.equipment.id,\n          score: rec.score,\n          reason: rec.reason\n        });\n      }));\n\n      res.json(topRecommendations);\n    } catch (error) {\n      console.error('Error generating recommendations:', error);\n      res.status(500).json({\n        error: \"Failed to generate recommendations\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Receipt download endpoint with improved error handling\n  app.get(\"/api/receipts/:id/download\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.sendStatus(401);\n    }\n\n    try {\n      const receiptId = parseInt(req.params.id);\n      const receipt = await storage.getReceipt(receiptId);\n\n      if (!receipt) {\n        return res.status(404).json({ error: \"Receipt not found\" });\n      }\n\n      // Check if the receipt belongs to the authenticated user\n      if (receipt.userId !== req.user.id) {\n        return res.status(403).json({ error: \"Not authorized to access this receipt\" });\n      }\n\n      // Get associated booking and equipment details\n      const booking = await storage.getBooking(receipt.bookingId);\n      if (!booking) {\n        return res.status(404).json({ error: \"Associated booking not found\" });\n      }\n\n      const equipment = await storage.getEquipment(booking.equipmentId);\n      if (!equipment) {\n        return res.status(404).json({ error: \"Associated equipment not found\" });\n      }\n\n      // Generate filename\n      const filename = `receipt_${receipt.id}_${format(receipt.generatedAt, 'yyyyMMdd')}.pdf`;\n\n      // Create PDF document with proper formatting options\n      const doc = new PDFDocument({\n        margin: 0,\n        size: 'A4',\n        bufferPages: true\n      });\n\n      // Set response headers for PDF download\n      res.setHeader('Content-Type', 'application/pdf');\n      res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\n\n      // Handle errors in the PDF generation stream\n      doc.on('error', (error) => {\n        console.error('PDF generation error:', error);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Failed to generate PDF\" });\n        }\n      });\n\n      doc.pipe(res);\n\n      // Helper function to format currency\n      const formatAmount = (amount: number) => {\n        return `₹${Math.floor(amount).toLocaleString('en-IN')}`;\n      };\n\n      // Page dimensions\n      const pageWidth = 595.28;\n      const pageHeight = 841.89;\n      const margin = 50;\n      const contentWidth = pageWidth - (margin * 2);\n\n      // ==================== PREMIUM HEADER ====================\n      // Gradient-style header background (simulated with rectangles)\n      doc.rect(0, 0, pageWidth, 120)\n         .fill('#1a5f1a');\n      \n      doc.rect(0, 0, pageWidth, 100)\n         .fill('#228B22');\n\n      // Decorative top border\n      doc.rect(0, 0, pageWidth, 5)\n         .fill('#FFD700');\n\n      // Enhanced Logo Design\n      const logoX = margin + 20;\n      const logoY = 25;\n      const logoSize = 50;\n\n      // Logo outer circle with shadow effect\n      doc.circle(logoX + logoSize/2, logoY + logoSize/2 + 2, logoSize/2)\n         .fill('#00000020');\n      \n      // Logo background circle\n      doc.circle(logoX + logoSize/2, logoY + logoSize/2, logoSize/2)\n         .fillAndStroke('#FFFFFF', '#FFD700')\n         .lineWidth(3);\n\n      // Tractor icon design\n      doc.fillColor('#228B22');\n      \n      // Tractor body\n      doc.rect(logoX + 10, logoY + 25, 28, 10)\n         .fill();\n      \n      // Tractor cabin\n      doc.rect(logoX + 24, logoY + 15, 14, 10)\n         .fill();\n      \n      // Large rear wheel\n      doc.circle(logoX + 34, logoY + 40, 7)\n         .fillAndStroke('#228B22', '#FFD700')\n         .lineWidth(2);\n      \n      // Small front wheel\n      doc.circle(logoX + 14, logoY + 40, 5)\n         .fillAndStroke('#228B22', '#FFD700')\n         .lineWidth(2);\n      \n      // Exhaust pipe\n      doc.rect(logoX + 32, logoY + 10, 3, 5)\n         .fill('#228B22');\n\n      // Company branding\n      doc.font('Helvetica-Bold')\n         .fontSize(32)\n         .fillColor('#FFFFFF')\n         .text('KrishiSadhan', logoX + 70, 30);\n\n      doc.font('Helvetica')\n         .fontSize(10)\n         .fillColor('#E8F5E9')\n         .text('Premium Agricultural Equipment Rental', logoX + 70, 58);\n\n      // Professional tagline\n      doc.fontSize(8)\n         .fillColor('#C8E6C9')\n         .text('Empowering Farmers | Building Communities', logoX + 70, 72);\n\n      // Company details box on the right with better visibility\n      const rightBoxX = pageWidth - 180;\n      doc.rect(rightBoxX, 20, 160, 70)\n         .fillAndStroke('#FFFFFF', '#FFD700')\n         .lineWidth(2);\n\n      doc.font('Helvetica-Bold')\n         .fontSize(9)\n         .fillColor('#1a5f1a')\n         .text('Contact Us', rightBoxX + 10, 28);\n\n      doc.font('Helvetica')\n         .fontSize(8)\n         .fillColor('#333333')\n         .text('Web: www.krishisadhan.shop', rightBoxX + 10, 42)\n         .text('Email: support@krishisadhan.shop', rightBoxX + 10, 54)\n         .text('Phone: +91-7385688905', rightBoxX + 10, 66)\n         .text('Location: Maharashtra, India', rightBoxX + 10, 78);\n\n      // ==================== RECEIPT TITLE SECTION ====================\n      // Decorative line\n      doc.moveTo(margin, 135)\n         .lineTo(pageWidth - margin, 135)\n         .lineWidth(3)\n         .strokeColor('#228B22')\n         .stroke();\n\n      doc.font('Helvetica-Bold')\n         .fontSize(26)\n         .fillColor('#1a5f1a')\n         .text('PAYMENT RECEIPT', margin, 145);\n\n      doc.font('Helvetica')\n         .fontSize(11)\n         .fillColor('#666666')\n         .text('Official Transaction Document', margin, 172);\n\n      // ==================== RECEIPT INFO CARDS ====================\n      // Receipt details card\n      doc.roundedRect(margin, 195, (contentWidth / 2) - 10, 85, 8)\n         .fillAndStroke('#F1F8F4', '#C8E6C9')\n         .lineWidth(1);\n\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#1a5f1a')\n         .text('RECEIPT INFORMATION', margin + 15, 205);\n\n      doc.font('Helvetica-Bold')\n         .fontSize(9)\n         .fillColor('#333333')\n         .text('Receipt No:', margin + 15, 225)\n         .font('Helvetica')\n         .fillColor('#555555')\n         .text(`#KS-${receipt.id.toString().padStart(6, '0')}`, margin + 100, 225);\n\n      doc.font('Helvetica-Bold')\n         .fillColor('#333333')\n         .text('Booking Ref:', margin + 15, 240)\n         .font('Helvetica')\n         .fillColor('#555555')\n         .text(`#BK-${receipt.bookingId.toString().padStart(6, '0')}`, margin + 100, 240);\n\n      doc.font('Helvetica-Bold')\n         .fillColor('#333333')\n         .text('Issue Date:', margin + 15, 255)\n         .font('Helvetica')\n         .fillColor('#555555')\n         .text(format(receipt.generatedAt, 'dd MMMM yyyy'), margin + 100, 255);\n\n      // Status badge card\n      const statusX = margin + (contentWidth / 2) + 10;\n      const statusColor = receipt.status === 'paid' ? '#4CAF50' : '#FF9800';\n      const statusText = receipt.status === 'paid' ? '✓ PAYMENT CONFIRMED' : '⏳ PENDING';\n\n      doc.roundedRect(statusX, 195, (contentWidth / 2) - 10, 85, 8)\n         .fillAndStroke('#FFFFFF', statusColor)\n         .lineWidth(3);\n\n      doc.font('Helvetica-Bold')\n         .fontSize(14)\n         .fillColor(statusColor)\n         .text(statusText, statusX + 15, 230, { \n           align: 'center', \n           width: (contentWidth / 2) - 40 \n         });\n\n      // Verified stamp\n      if (receipt.status === 'paid') {\n        doc.font('Helvetica')\n           .fontSize(8)\n           .fillColor('#4CAF50')\n           .text('Digitally Verified & Secured', statusX + 15, 255, { \n             align: 'center', \n             width: (contentWidth / 2) - 40 \n           });\n      }\n\n      // ==================== EQUIPMENT DETAILS ====================\n      doc.font('Helvetica-Bold')\n         .fontSize(15)\n         .fillColor('#1a5f1a')\n         .text('Equipment Details', margin, 300);\n\n      doc.roundedRect(margin, 320, contentWidth, 100, 8)\n         .fillAndStroke('#FFFFFF', '#E0E0E0')\n         .lineWidth(1);\n\n      // Equipment info in two columns\n      const col1X = margin + 20;\n      const col2X = margin + (contentWidth / 2) + 10;\n      let yPos = 335;\n\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Equipment Name:', col1X, yPos)\n         .font('Helvetica')\n         .fontSize(11)\n         .fillColor('#000000')\n         .text(equipment.name, col1X + 110, yPos, { width: 180 });\n\n      yPos += 20;\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Category:', col1X, yPos)\n         .font('Helvetica')\n         .fontSize(10)\n         .fillColor('#555555')\n         .text(equipment.category.charAt(0).toUpperCase() + equipment.category.slice(1), col1X + 110, yPos);\n\n      yPos += 20;\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Location:', col1X, yPos)\n         .font('Helvetica')\n         .fontSize(10)\n         .fillColor('#555555')\n         .text(equipment.location, col1X + 110, yPos);\n\n      yPos += 20;\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Daily Rate:', col1X, yPos)\n         .font('Helvetica-Bold')\n         .fontSize(11)\n         .fillColor('#228B22')\n         .text(formatAmount(equipment.dailyRate), col1X + 110, yPos);\n\n      // ==================== RENTAL PERIOD ====================\n      doc.font('Helvetica-Bold')\n         .fontSize(15)\n         .fillColor('#1a5f1a')\n         .text('Rental Period', margin, 440);\n\n      const rentalDays = Math.max(1, Math.ceil((new Date(booking.endDate).getTime() - new Date(booking.startDate).getTime()) / (1000 * 60 * 60 * 24)) + 1);\n\n      doc.roundedRect(margin, 460, contentWidth, 75, 8)\n         .fillAndStroke('#E8F5E9', '#A5D6A7')\n         .lineWidth(2);\n\n      yPos = 475;\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Start Date:', margin + 20, yPos)\n         .font('Helvetica')\n         .fontSize(10)\n         .fillColor('#555555')\n         .text(format(booking.startDate, 'dd MMMM yyyy'), margin + 150, yPos);\n\n      yPos += 20;\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('End Date:', margin + 20, yPos)\n         .font('Helvetica')\n         .fontSize(10)\n         .fillColor('#555555')\n         .text(format(booking.endDate, 'dd MMMM yyyy'), margin + 150, yPos);\n\n      yPos += 20;\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Total Duration:', margin + 20, yPos)\n         .font('Helvetica-Bold')\n         .fontSize(11)\n         .fillColor('#228B22')\n         .text(`${rentalDays} Day${rentalDays > 1 ? 's' : ''}`, margin + 150, yPos);\n\n      // ==================== PAYMENT BREAKDOWN ====================\n      doc.font('Helvetica-Bold')\n         .fontSize(15)\n         .fillColor('#1a5f1a')\n         .text('Payment Summary', margin, 555);\n\n      // Payment table\n      doc.roundedRect(margin, 575, contentWidth, 120, 8)\n         .fillAndStroke('#FFFFFF', '#E0E0E0')\n         .lineWidth(1);\n\n      // Table header\n      doc.rect(margin, 575, contentWidth, 30)\n         .fill('#F5F5F5');\n\n      doc.font('Helvetica-Bold')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Description', margin + 15, 585)\n         .text('Rate', margin + 240, 585)\n         .text('Days', margin + 340, 585)\n         .text('Amount', margin + 420, 585);\n\n      // Divider line\n      doc.moveTo(margin, 605)\n         .lineTo(pageWidth - margin, 605)\n         .lineWidth(1)\n         .strokeColor('#E0E0E0')\n         .stroke();\n\n      // Table rows\n      const baseAmount = equipment.dailyRate * rentalDays;\n      const gstRate = 18;\n      const gstAmount = Math.round(baseAmount * (gstRate / 100));\n\n      yPos = 615;\n      doc.font('Helvetica')\n         .fontSize(10)\n         .fillColor('#333333')\n         .text('Equipment Rental', margin + 15, yPos)\n         .text(formatAmount(equipment.dailyRate), margin + 240, yPos)\n         .text(`${rentalDays}`, margin + 340, yPos)\n         .font('Helvetica-Bold')\n         .text(formatAmount(baseAmount), margin + 420, yPos);\n\n      yPos += 25;\n      doc.font('Helvetica')\n         .fillColor('#333333')\n         .text(`GST (${gstRate}%)`, margin + 15, yPos)\n         .text('—', margin + 240, yPos)\n         .text('—', margin + 340, yPos)\n         .font('Helvetica-Bold')\n         .text(formatAmount(gstAmount), margin + 420, yPos);\n\n      // Total section\n      doc.rect(margin, 665, contentWidth, 30)\n         .fill('#E8F5E9');\n\n      doc.font('Helvetica-Bold')\n         .fontSize(13)\n         .fillColor('#1a5f1a')\n         .text('TOTAL AMOUNT PAID', margin + 15, 673);\n\n      doc.font('Helvetica-Bold')\n         .fontSize(16)\n         .fillColor('#228B22')\n         .text(formatAmount(receipt.amount), margin + 420, 670);\n\n      // ==================== PAYMENT DETAILS ====================\n      doc.roundedRect(margin, 710, contentWidth, 50, 8)\n         .fillAndStroke('#F9F9F9', '#E0E0E0')\n         .lineWidth(1);\n\n      doc.font('Helvetica-Bold')\n         .fontSize(9)\n         .fillColor('#333333')\n         .text('Transaction Details', margin + 15, 720);\n\n      doc.font('Helvetica')\n         .fontSize(8)\n         .fillColor('#666666')\n         .text(`Payment ID: ${receipt.razorpayPaymentId}`, margin + 15, 735)\n         .text(`Method: ${receipt.metadata.payment_method || 'Online Payment'}`, margin + 15, 747)\n         .text(`Date: ${format(receipt.generatedAt, 'dd MMM yyyy, hh:mm a')}`, margin + 280, 735)\n         .text('Status: Secured & Verified ✓', margin + 280, 747);\n\n      // ==================== FOOTER ====================\n      doc.rect(0, pageHeight - 70, pageWidth, 70)\n         .fill('#1a5f1a');\n\n      doc.font('Helvetica-Bold')\n         .fontSize(13)\n         .fillColor('#FFD700')\n         .text('Thank You for Choosing KrishiSadhan!', 0, pageHeight - 55, { \n           align: 'center', \n           width: pageWidth \n         });\n\n      doc.font('Helvetica')\n         .fontSize(9)\n         .fillColor('#E8F5E9')\n         .text('Your Trusted Partner in Agricultural Equipment Rental', 0, pageHeight - 38, { \n           align: 'center', \n           width: pageWidth \n         });\n\n      doc.fontSize(8)\n         .fillColor('#C8E6C9')\n         .text('Email: support@krishisadhan.shop  |  Phone: +91-7385688905  |  Web: www.krishisadhan.shop', 0, pageHeight - 22, { \n           align: 'center', \n           width: pageWidth \n         });\n\n      doc.end();\n    } catch (error) {\n      console.error('Error generating receipt PDF:', error);\n      res.status(500).json({\n        error: 'Failed to generate receipt PDF',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  app.post(\"/api/reviews\", async (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ error: \"Authentication required\" });\n    }\n\n    try {\n      console.log('Received review data:', req.body);\n\n      const reviewData = {\n        ...req.body,\n        userId: req.user.id,\n        createdAt: new Date()\n      };\n\n      const parsed = reviewSchema.safeParse(reviewData);\n      if (!parsed.success) {\n        console.error('Review validation failed:', parsed.error);\n        return res.status(400).json({\n          error: \"Invalid review data\",\n          details: parsed.error.errors\n        });\n      }\n\n      console.log('Creating review with validated data:', parsed.data);\n      const review = await storage.createReview(parsed.data);\n\n      // Update equipment popularity after review\n      const newPopularity = await storage.calculateEquipmentPopularity(parsed.data.equipmentId);\n      await storage.updateEquipment(parsed.data.equipmentId, {\n        popularity: newPopularity\n      });\n\n      // Update booking to mark it as rated\n      if (req.body.bookingId) {\n        await storage.updateBooking(req.body.bookingId, {\n          isRated: true\n        });\n      }\n\n      console.log('Review created successfully:', review);\n      res.status(201).json(review);\n    } catch (error) {\n      console.error('Error creating review:', error);\n      res.status(500).json({\n        error: \"Failed to create review\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  app.get(\"/api/equipment/:id/reviews\", async (req, res) => {\n    try {\n      const equipmentId = parseInt(req.params.id);\n      if (isNaN(equipmentId)) {\n        return res.status(400).json({ error: \"Invalid equipment ID\" });\n      }\n\n      const reviews = await storage.listEquipmentReviews(equipmentId);\n      res.json(reviews);\n    } catch (error) {\n      console.error('Error fetching reviews:', error);\n      res.status(500).json({\n        error: \"Failed to fetch reviews\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Chatbot endpoint using Gemini API\n  app.post(\"/api/chatbot\", async (req, res) => {\n    try {\n      const { message } = req.body;\n\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ error: 'Message is required' });\n      }\n\n      const apiKey = process.env.GEMINI_API_KEY;\n      if (!apiKey) {\n        return res.status(500).json({ error: 'Google AI API key not configured' });\n      }\n\n      const genAI = new GoogleGenerativeAI(apiKey);\n      const model = genAI.getGenerativeModel({ model: \"gemini-2.5-flash\" });\n\n      // First, use Gemini to detect the language\n      const languageDetectionPrompt = `Analyze this message and identify the language. Respond with ONLY one of these language codes: 'en' for English, 'hi' for Hindi, or 'mr' for Marathi. If unsure, respond with 'en'.\n\nMessage: ${message}`;\n\n      const langDetectionResult = await model.generateContent(languageDetectionPrompt);\n      const langResponse = await langDetectionResult.response;\n      let detectedLanguage = langResponse.text().trim().toLowerCase();\n      \n      // Validate detected language\n      if (!['en', 'hi', 'mr'].includes(detectedLanguage)) {\n        detectedLanguage = 'en'; // Default to English if detection fails\n      }\n\n      console.log('Detected language:', detectedLanguage);\n\n      const languageNames: Record<string, string> = {\n        'en': 'English',\n        'hi': 'Hindi',\n        'mr': 'Marathi'\n      };\n\n      const languageInstructions: Record<string, string> = {\n        'en': 'Respond in English.',\n        'hi': 'उपयोगकर्ता ने हिंदी में सवाल पूछा है। कृपया हिंदी में जवाब दें।',\n        'mr': 'वापरकर्त्याने मराठीत प्रश्न विचारला आहे. कृपया मराठीत उत्तर द्या।'\n      };\n\n      const prompt = `You are a helpful farm equipment rental assistant for KrishiSadhan, an agricultural equipment rental platform. You help farmers and agricultural workers with:\n\nMAIN SERVICES:\n- Finding suitable farm equipment for rent (tractors, harvesters, tillers, sprayers, seeders, cultivators, threshers, irrigation systems, rotavators)\n- Understanding rental prices, availability, and booking process\n- Equipment specifications, usage guidance, and recommendations\n- Customer support for the rental platform\n\nPLATFORM FEATURES:\n- Equipment search and filtering by category, location, price range\n- Online booking with payment gateway integration\n- Multi-language support (English, Hindi, Marathi)\n- Equipment comparison tools\n- Reviews and ratings system\n- Receipt and booking history\n\nGUIDELINES:\n- Be helpful, friendly, and knowledgeable about farm equipment\n- Provide practical advice for agricultural needs\n- Keep responses concise but informative\n- Suggest specific equipment categories when relevant\n- Mention platform features that can help users\n- Use simple language appropriate for farmers\n- If asked about pricing, mention that rates vary by equipment and location\n\nIMPORTANT: The user's message is in ${languageNames[detectedLanguage]}. ${languageInstructions[detectedLanguage]}\nYou MUST respond in the SAME language as the user's question.\n\nUser question: ${message}`;\n\n      const result = await model.generateContent(prompt);\n      const response = await result.response;\n      const text = response.text();\n\n      // Return response with detected language\n      res.json({ \n        response: text,\n        detectedLanguage: detectedLanguage\n      });\n    } catch (error) {\n      console.error('Gemini API error:', error);\n\n      // Handle specific Gemini API errors\n      let errorMessage = 'Failed to get response from AI assistant';\n      if (error instanceof Error) {\n        if (error.message.includes('overloaded')) {\n          errorMessage = 'Our AI assistant is currently busy. Please try again in a moment.';\n        } else if (error.message.includes('quota')) {\n          errorMessage = 'AI service quota reached. Please try again later.';\n        } else if (error.message.includes('API key')) {\n          errorMessage = 'AI service configuration issue. Please contact support.';\n        } else {\n          errorMessage = error.message;\n        }\n      }\n\n      res.status(500).json({ \n        error: errorMessage,\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  return httpServer;\n}\n\nasync function handleWebhookEvent(event: any): Promise<{ status: 'success' | 'failed'; bookingId: number; paymentId?: string } | null> {\n  // This is a placeholder.  Replace with actual webhook event handling logic\n  console.log(\"Webhook event received:\", event);\n  if (event.payload.payment.status === 'captured') {\n    return { status: 'success', bookingId: event.payload.payment.order_id, paymentId: event.payload.payment.id };\n  } else if (event.payload.payment.status === 'failed') {\n    return { status: 'failed', bookingId: event.payload.payment.order_id };\n  }\n  return null;\n}","size_bytes":65936},"client/src/pages/ReceiptHistory.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Download, Loader2, Eye, Calendar, CreditCard } from \"lucide-react\";\nimport { formatDate } from \"@/lib/utils\";\nimport { useTranslation } from \"react-i18next\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport type { Receipt } from \"@shared/schema\";\nimport { MainNav } from \"@/components/main-nav\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState, useMemo } from \"react\";\n\ninterface ReceiptWithMetadata extends Receipt {\n  metadata: {\n    equipment_name?: string;\n    booking_dates?: {\n      start: string;\n      end: string;\n    };\n    payment_method?: string;\n  };\n}\n\nconst ReceiptHistory = () => {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n\n  const formatRupees = (amount: number) => {\n    const rupees = Number(amount) || 0;\n    return new Intl.NumberFormat(\"en-IN\", {\n      style: \"currency\",\n      currency: \"INR\",\n      maximumFractionDigits: 0,\n    }).format(rupees);\n  };\n\n  const {\n    data: receipts,\n    isLoading,\n    error,\n  } = useQuery<ReceiptWithMetadata[]>({\n    queryKey: [\"/api/receipts\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/receipts\", {\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to fetch receipts\");\n      }\n      return response.json();\n    },\n  });\n\n  const filteredReceipts = receipts || [];\n\n  const analytics = useMemo(() => {\n    if (!receipts)\n      return { total: 0, totalAmount: 0, paidCount: 0, pendingCount: 0 };\n\n    const total = receipts.length;\n    const totalAmount = receipts.reduce(\n      (sum, receipt) => sum + Number(receipt.amount),\n      0,\n    );\n    const paidCount = receipts.filter((r) => r.status === \"paid\").length;\n    const pendingCount = receipts.filter((r) => r.status === \"pending\").length;\n\n    return { total, totalAmount, paidCount, pendingCount };\n  }, [receipts]);\n\n  const getStatusInfo = (status: string) => {\n    const statusDisplayMap: Record<\n      string,\n      { text: string; className: string; icon?: JSX.Element }\n    > = {\n      paid: {\n        text: \"Payment Confirmed\",\n        className:\n          \"bg-green-50 text-green-700 border border-green-200 font-medium px-3 py-1.5 rounded-full\",\n        icon: <span className=\"text-green-600 mr-1\">✓</span>,\n      },\n      pending: {\n        text: \"Processing\",\n        className:\n          \"bg-yellow-50 text-yellow-700 border border-yellow-200 font-medium px-3 py-1.5 rounded-full\",\n        icon: <span className=\"text-yellow-600 mr-1\">⏳</span>,\n      },\n      failed: {\n        text: \"Payment Failed\",\n        className:\n          \"bg-red-50 text-red-700 border border-red-200 font-medium px-3 py-1.5 rounded-full\",\n        icon: <span className=\"text-red-600 mr-1\">✗</span>,\n      },\n    };\n\n    return (\n      statusDisplayMap[status.toLowerCase()] || {\n        text: status.charAt(0).toUpperCase() + status.slice(1),\n        className: \"bg-gray-100 text-gray-800 border border-gray-200\",\n      }\n    );\n  };\n\n  const handleDownload = async (receiptId: number) => {\n    try {\n      toast({\n        title: t(\"receipts.downloading\", \"Downloading Receipt...\"),\n        description: t(\n          \"receipts.downloadingDesc\",\n          \"Please wait while we prepare your receipt.\",\n        ),\n      });\n\n      const response = await fetch(`/api/receipts/${receiptId}/download`, {\n        credentials: \"include\",\n      });\n\n      if (!response.ok) throw new Error(\"Failed to download receipt\");\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `receipt-${receiptId}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      toast({\n        title: t(\"receipts.downloadSuccess\", \"Receipt Downloaded\"),\n        description: t(\n          \"receipts.downloadSuccessDesc\",\n          \"Your receipt has been downloaded successfully.\",\n        ),\n      });\n    } catch (error) {\n      console.error(\"Download error:\", error);\n      toast({\n        variant: \"destructive\",\n        title: t(\"receipts.downloadError\", \"Download Failed\"),\n        description: t(\n          \"receipts.downloadErrorDesc\",\n          \"Failed to download the receipt. Please try again.\",\n        ),\n      });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <MainNav />\n        <div className=\"container mx-auto py-8\">\n          <h1 className=\"text-2xl font-bold mb-6\">\n            {t(\"receipts.title\", \"Receipt History\")}\n          </h1>\n          <div className=\"flex items-center justify-center min-h-[200px]\">\n            <Loader2 className=\"h-8 w-8 animate-spin\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <MainNav />\n        <div className=\"container mx-auto py-8\">\n          <h1 className=\"text-2xl font-bold mb-6\">\n            {t(\"receipts.title\", \"Receipt History\")}\n          </h1>\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center min-h-[200px] text-center p-6\">\n              <p className=\"text-destructive mb-4\">\n                {t(\"common.error\", \"Error\")}\n              </p>\n              <p className=\"text-muted-foreground\">\n                {error instanceof Error\n                  ? error.message\n                  : t(\"common.loadError\", \"Failed to load receipts\")}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (!receipts?.length) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <MainNav />\n        <div className=\"container mx-auto py-8\">\n          <h1 className=\"text-2xl font-bold mb-6\">\n            {t(\"receipts.title\", \"Receipt History\")}\n          </h1>\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center min-h-[200px] text-center p-6\">\n              <p className=\"text-muted-foreground\">\n                {t(\"receipts.noReceipts\", \"No receipts found\")}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <MainNav />\n      <div className=\"container mx-auto py-8\">\n        <h1 className=\"text-2xl font-bold mb-6 bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent\">\n          {t(\"receipts.title\", \"Receipt History\")}\n        </h1>\n\n        {/* Analytics */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Total Receipts</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{analytics.total}</div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Total Amount</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">\n                {formatRupees(analytics.totalAmount)}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Paid</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600\">\n                {analytics.paidCount}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Pending</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-yellow-600\">\n                {analytics.pendingCount}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Table */}\n        <div className=\"rounded-lg border bg-card shadow-custom\">\n          <Table>\n            <TableHeader>\n              <TableRow className=\"bg-muted/50\">\n                <TableHead>Receipt ID</TableHead>\n                <TableHead>Equipment</TableHead>\n                <TableHead>Booking Period</TableHead>\n                <TableHead>Amount</TableHead>\n                <TableHead>Payment Status</TableHead>\n                <TableHead>Generated On</TableHead>\n                <TableHead className=\"text-right\">Actions</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredReceipts.map((receipt) => {\n                const statusInfo = getStatusInfo(receipt.status);\n                return (\n                  <TableRow key={receipt.id} className=\"hover:bg-muted/20\">\n                    <TableCell>#{receipt.id}</TableCell>\n                    <TableCell>\n                      {receipt.metadata.equipment_name || \"N/A\"}\n                    </TableCell>\n                    <TableCell>\n                      {receipt.metadata.booking_dates\n                        ? `${formatDate(receipt.metadata.booking_dates.start)} to ${formatDate(receipt.metadata.booking_dates.end)}`\n                        : \"N/A\"}\n                    </TableCell>\n                    <TableCell>{formatRupees(receipt.amount)}</TableCell>\n                    <TableCell>\n                      <span className={statusInfo.className}>\n                        {statusInfo.icon}\n                        {statusInfo.text}\n                      </span>\n                    </TableCell>\n                    <TableCell>{formatDate(receipt.generatedAt)}</TableCell>\n                    <TableCell className=\"text-right\">\n                      <div className=\"flex gap-2 justify-end\">\n                        {/* 👁️ View Button */}\n                        <Dialog>\n                          <DialogTrigger asChild>\n                            <Button variant=\"outline\" size=\"sm\">\n                              <Eye className=\"h-4 w-4 mr-1\" /> View\n                            </Button>\n                          </DialogTrigger>\n                          <DialogContent className=\"max-w-lg rounded-xl shadow-xl\">\n                            <DialogHeader>\n                              <DialogTitle className=\"text-xl font-semibold text-primary\">\n                                Receipt Details #{receipt.id}\n                              </DialogTitle>\n                            </DialogHeader>\n                            <div className=\"space-y-4 text-sm mt-3 divide-y divide-gray-200\">\n                              <div className=\"flex justify-between pt-2\">\n                                <span className=\"font-medium text-gray-600\">\n                                  Equipment\n                                </span>\n                                <span>\n                                  {receipt.metadata?.equipment_name || \"N/A\"}\n                                </span>\n                              </div>\n                              <div className=\"flex justify-between pt-2\">\n                                <span className=\"font-medium text-gray-600\">\n                                  Booking Period\n                                </span>\n                                <span>\n                                  {receipt.metadata?.booking_dates\n                                    ? `${formatDate(receipt.metadata.booking_dates.start)} → ${formatDate(receipt.metadata.booking_dates.end)}`\n                                    : \"N/A\"}\n                                </span>\n                              </div>\n                              <div className=\"flex justify-between pt-2\">\n                                <span className=\"font-medium text-gray-600\">\n                                  Amount\n                                </span>\n                                <span className=\"font-semibold text-green-600\">\n                                  {formatRupees(receipt.amount)}\n                                </span>\n                              </div>\n                              <div className=\"flex justify-between pt-2\">\n                                <span className=\"font-medium text-gray-600\">\n                                  Status\n                                </span>\n                                <span className=\"font-semibold\">\n                                  {getStatusInfo(receipt.status).text}\n                                </span>\n                              </div>\n                              <div className=\"flex justify-between pt-2\">\n                                <span className=\"font-medium text-gray-600\">\n                                  Payment Method\n                                </span>\n                                <span>\n                                  {receipt.metadata?.payment_method ||\n                                    \"Online Payment\"}\n                                </span>\n                              </div>\n                              <div className=\"flex justify-between pt-2\">\n                                <span className=\"font-medium text-gray-600\">\n                                  Generated On\n                                </span>\n                                <span>{formatDate(receipt.generatedAt)}</span>\n                              </div>\n                            </div>\n                          </DialogContent>\n                        </Dialog>\n\n                        {/* 🧾 PDF Button */}\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleDownload(receipt.id)}\n                        >\n                          <Download className=\"h-4 w-4 mr-1\" /> PDF\n                        </Button>\n                      </div>\n                    </TableCell>\n                  </TableRow>\n                );\n              })}\n            </TableBody>\n          </Table>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ReceiptHistory;\n","size_bytes":14634},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7246},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3\",\n        sm: \"h-9 px-2.5\",\n        lg: \"h-11 px-5\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1435},"client/src/components/ui/tooltip.tsx":{"content":"import * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1145},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  ControllerProps,\n  FieldPath,\n  FieldValues,\n  FormProvider,\n  useFormContext,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message) : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4085},"client/src/pages/equipment-page.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Equipment } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Star, CheckCircle, XCircle, ImagePlus, RefreshCw } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format, differenceInDays } from \"date-fns\";\nimport { enUS, hi } from \"date-fns/locale\";\nimport { useTranslation } from \"react-i18next\";\nimport { VoiceAssistant } from \"@/components/voice-assistant\";\nimport { useRoute, Link } from \"wouter\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { CalendarHeatmap } from \"@/components/ui/calendar-heatmap\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ReviewForm } from \"@/components/review-form\";\nimport { PaymentGateway } from \"@/components/payment-gateway\";\n\n// Define the Review interface for this component\ninterface ReviewType {\n  id: number;\n  rating: number;\n  comment: string;\n  createdAt: string;\n  userId: number;\n  equipmentId: number;\n}\n\nexport default function EquipmentPage() {\n  const [, params] = useRoute(\"/equipment/:id\");\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const { t, i18n } = useTranslation();\n  const [, setLocation] = useLocation();\n  const [startDate, setStartDate] = useState<Date | undefined>();\n  const [endDate, setEndDate] = useState<Date | undefined>();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [dialogKey, setDialogKey] = useState(0);\n  const [imageKey, setImageKey] = useState(0); // Add this for forced re-render\n  const [isImageRefreshing, setIsImageRefreshing] = useState(false);\n  const [showPaymentGateway, setShowPaymentGateway] = useState(false);\n  const [bookingData, setBookingData] = useState<any>(null);\n  const [showRatingDialog, setShowRatingDialog] = useState(false);\n\n  // Reset dates when dialog closes\n  useEffect(() => {\n    if (!isDialogOpen) {\n      setStartDate(undefined);\n      setEndDate(undefined);\n      setDialogKey((prev) => prev + 1);\n    }\n  }, [isDialogOpen]);\n\n  // Fetch equipment details\n  const {\n    data: equipment,\n    isLoading,\n    error,\n    refetch,\n  } = useQuery<Equipment>({\n    queryKey: [`/api/equipment/${params?.id}`],\n    enabled: !!params?.id,\n    staleTime: 30000,\n    refetchOnMount: true,\n  });\n\n  // Fetch reviews for this equipment\n  const { data: reviews } = useQuery<ReviewType[]>({\n    queryKey: [`/api/equipment/${params?.id}/reviews`],\n    enabled: !!params?.id,\n  });\n\n  // Create booking mutation\n  const createBookingMutation = useMutation({\n    mutationFn: async () => {\n      if (!equipment || !startDate || !endDate) {\n        throw new Error(t(\"booking.missingInfo\"));\n      }\n\n      // Validate date range\n      if (startDate > endDate) {\n        throw new Error(t(\"booking.invalidDateRange\"));\n      }\n\n      try {\n        const response = await fetch(\"/api/bookings\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          credentials: \"include\",\n          body: JSON.stringify({\n            equipmentId: equipment.id,\n            startDate: startDate.toISOString(),\n            endDate: endDate.toISOString(),\n            status: \"pending\",\n          }),\n        });\n\n        if (!response.ok) {\n          const error = await response.json();\n          throw new Error(error.message || t(\"booking.failed\"));\n        }\n\n        return response.json();\n      } catch (error) {\n        console.error(\"Booking error:\", error);\n        throw error;\n      }\n    },\n    onSuccess: (data) => {\n      console.log('Booking created successfully:', data);\n\n      // Set booking data for payment gateway\n      setBookingData(data);\n      setShowPaymentGateway(true);\n      setIsDialogOpen(false);\n      setStartDate(undefined);\n      setEndDate(undefined);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t(\"common.error\"),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Loading state\n  if (isLoading || !params?.id) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"text-red-500\">\n          <XCircle className=\"h-12 w-12 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold\">{t(\"common.error\")}</h2>\n          <p>\n            {error instanceof Error ? error.message : t(\"common.loadError\")}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!equipment) {\n    return <div>{t(\"equipment.notFound\")}</div>;\n  }\n\n  const canEdit = user?.id === equipment.ownerId;\n\n  const handleDateSelect = (\n    newStartDate: Date | undefined,\n    newEndDate: Date | undefined,\n  ) => {\n    // If clearing selection\n    if (!newStartDate) {\n      setStartDate(undefined);\n      setEndDate(undefined);\n      return;\n    }\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    // Single date selected\n    if (!newEndDate) {\n      if (newStartDate < today) {\n        toast({\n          title: t(\"common.error\"),\n          description: t(\"booking.pastDateError\"),\n          variant: \"destructive\",\n        });\n        return;\n      }\n      setStartDate(newStartDate);\n      setEndDate(undefined);\n      return;\n    }\n\n    // Both dates selected\n    if (newStartDate < today || newEndDate < today) {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"booking.pastDateError\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (newStartDate > newEndDate) {\n      toast({\n        title: t(\"common.error\"),\n        description: t(\"booking.invalidDateRange\"),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setStartDate(newStartDate);\n    setEndDate(newEndDate);\n  };\n\n  // Calculate average rating\n  const averageRating =\n    reviews && reviews.length > 0\n      ? reviews.reduce((acc, review) => acc + review.rating, 0) / reviews.length\n      : 0;\n\n  const handleVoiceCommand = (command: string) => {\n    if (!equipment || canEdit) return;\n\n    console.log(\"Received voice command:\", command);\n\n    const normalizedCommand = command.toLowerCase().trim();\n    console.log(\"Normalized command:\", normalizedCommand);\n\n    if (normalizedCommand === \"book now\") {\n      setIsDialogOpen(true);\n      speak(t(\"voice.bookingStarted\"));\n    } else if (normalizedCommand === \"close\") {\n      setIsDialogOpen(false);\n      speak(t(\"voice.dialogClosed\"));\n    } else if (normalizedCommand === \"confirm booking\") {\n      if (startDate && endDate) {\n        createBookingMutation.mutate();\n        speak(t(\"voice.bookingConfirmed\"));\n      } else {\n        speak(t(\"voice.selectDatesFirst\"));\n      }\n    } else {\n      console.log(\"Unknown command:\", normalizedCommand);\n      speak(t(\"voice.unknownCommand\"));\n    }\n  };\n\n  const speak = (message: string) => {\n    const utterance = new SpeechSynthesisUtterance(message);\n    window.speechSynthesis.speak(utterance);\n    console.log(\"Speaking:\", message);\n  };\n\n  // Function to handle manual image refresh\n  const handleImageRefresh = async () => {\n    if (!equipment?.imageUrl) return;\n\n    setIsImageRefreshing(true);\n    try {\n      // Force browser to refetch the image\n      setImageKey((prev) => prev + 1);\n\n      // Refetch equipment data\n      await refetch();\n\n      toast({\n        title: t(\"common.success\", \"Success\"),\n        description: t(\"equipment.imageRefreshed\", \"Image refreshed successfully\"),\n      });\n    } catch (error) {\n      toast({\n        title: t(\"common.error\", \"Error\"),\n        description: t(\"equipment.refreshError\", \"Failed to refresh image\"),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsImageRefreshing(false);\n    }\n  };\n\n\n  // Format number with locale\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat(i18n.language, {\n      style: \"currency\",\n      currency: \"INR\",\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  // Format date with locale\n  const formatLocalDate = (date: Date) => {\n    return format(date, \"PPP\", {\n      locale: i18n.language === \"hi\" ? hi : enUS, // Default to English for Marathi\n    });\n  };\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"grid md:grid-cols-2 gap-8\">\n        <div className=\"relative w-full h-[400px] rounded-lg overflow-hidden bg-gray-100\">\n          {equipment.imageUrl ? (\n            <div className=\"relative w-full h-full\">\n              <img\n                key={`${equipment.imageUrl}-${imageKey}`}\n                src={`${equipment.imageUrl}?v=${imageKey}`}\n                alt={equipment.name}\n                className=\"w-full h-full object-cover\"\n                onError={(e) => {\n                  const target = e.target as HTMLImageElement;\n                  if (!target.src.includes('placeholder-image.jpg')) {\n                    target.src = \"/placeholder-image.jpg\";\n                    target.classList.add('image-load-failed');\n                  }\n                }}\n              />\n              <Button\n                size=\"sm\"\n                variant=\"secondary\"\n                className=\"absolute top-2 right-2 bg-white/80 hover:bg-white\"\n                onClick={handleImageRefresh}\n                disabled={isImageRefreshing}\n              >\n                <RefreshCw\n                  className={`h-4 w-4 ${isImageRefreshing ? 'animate-spin' : ''}`}\n                />\n              </Button>\n            </div>\n          ) : (\n            <div className=\"flex items-center justify-center w-full h-full\">\n              <ImagePlus className=\"h-12 w-12 text-gray-400\" />\n              <p className=\"text-gray-500 mt-2\">{t('equipment.noImage')}</p>\n            </div>\n          )}\n        </div>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex justify-between items-start mb-4\">\n              <div className=\"flex justify-between items-start w-full\">\n                <div>\n                  <h1 className=\"text-3xl font-bold\">{equipment.name}</h1>\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    {[1, 2, 3, 4, 5].map((star) => (\n                      <Star\n                        key={star}\n                        className={`w-4 h-4 ${\n                          reviews &&\n                          reviews.length > 0 &&\n                          star <= Math.round(averageRating)\n                            ? \"text-yellow-400 fill-current\"\n                            : \"text-gray-300\"\n                        }`}\n                      />\n                    ))}\n                  </div>\n                  <span className=\"text-sm text-muted-foreground\">\n                    {reviews && reviews.length > 0 ? (\n                      <span>\n                        ({reviews.length}{\" \"}\n                        {t(\"reviews.count\", { count: reviews.length })})\n                      </span>\n                    ) : (\n                      t(\"reviews.none\")\n                    )}\n                  </span>\n                </div>\n                <Badge\n                  variant={equipment.availability ? \"success\" : \"destructive\"}\n                  className={`text-base py-1.5 px-4 ${!equipment.availability ? 'shadow-md bg-red-600 hover:bg-red-700' : ''}`}\n                >\n                  {equipment.availability ? (\n                    <>\n                      <CheckCircle className=\"w-5 h-5 mr-2\" />\n                      {t('equipment.available')}\n                    </>\n                  ) : (\n                    <>\n                      <XCircle className=\"w-5 h-5 mr-2\" />\n                      {t('equipment.unavailable')}\n                    </>\n                  )}\n                </Badge>\n              </div>\n              {canEdit && (\n                <Link href=\"/dashboard\">\n                  <Button variant=\"outline\" size=\"sm\">\n                    {t('common.edit')}\n                  </Button>\n                </Link>\n              )}\n              {!canEdit && equipment.availability && <VoiceAssistant onCommand={handleVoiceCommand} />}\n            </div>\n            <p className=\"text-muted-foreground mb-6\">\n              {equipment.description}\n            </p>\n\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"font-medium\">{t('equipment.dailyRate')}</span>\n                <span className=\"text-lg\">\n                  {formatCurrency(equipment.dailyRate)} {t('equipment.perDay')}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"font-medium\">{t('equipment.location')}</span>\n                <span>{equipment.location}</span>\n              </div>\n            </div>\n\n            {!canEdit && equipment.availability && (\n              <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button\n                    className=\"w-full mt-6\"\n                    aria-label={t('equipment.rentNow')}\n                  >\n                    {t('equipment.rentNow')}\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"sm:max-w-[425px] flex flex-col max-h-[90vh]\">\n                  <DialogHeader>\n                    <DialogTitle>{t('booking.selectDates')}</DialogTitle>\n                    <DialogDescription>\n                      {t('booking.selectDatesDescription')}\n                    </DialogDescription>\n                  </DialogHeader>\n\n                  <div className=\"flex-1 overflow-y-auto\">\n                    <div className=\"py-4\">\n                      <CalendarHeatmap\n                        key={`${equipment.id}-${dialogKey}`}\n                        equipmentId={equipment.id}\n                        startDate={startDate}\n                        endDate={endDate}\n                        dailyRate={equipment.dailyRate}\n                        onSelect={handleDateSelect}\n                        className=\"rounded-md border\"\n                        onConfirm={() => {\n                          if (startDate && endDate) {\n                            createBookingMutation.mutate();\n                          }\n                        }}\n                        isConfirming={createBookingMutation.isPending}\n                      />\n                    </div>\n                  </div>\n                </DialogContent>\n              </Dialog>\n            )}\n\n            {!canEdit && !equipment.availability && (\n              <div className=\"mt-6 space-y-4 flex flex-col items-center\">\n                <div className=\"p-4 rounded-lg bg-red-50 border border-red-200 w-full max-w-md mx-auto\">\n                  <p className=\"text-red-600 text-center font-medium\">\n                    {t('equipment.unavailable')}\n                  </p>\n                  <p className=\"text-red-500 text-sm text-center mt-2\">\n                    {t('equipment.checkBackLater')}\n                  </p>\n                </div>\n                <Button\n                  className=\"w-full bg-red-100 hover:bg-red-200 text-red-600 border border-red-200\"\n                  disabled\n                  aria-label={t('equipment.unavailable')}\n                >\n                  {t('equipment.unavailable')}\n                </Button>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Payment Gateway Dialog */}\n      {showPaymentGateway && bookingData && (\n        <Dialog open={showPaymentGateway} onOpenChange={setShowPaymentGateway}>\n          <DialogContent className=\"sm:max-w-[425px]\">\n            <DialogHeader>\n              <DialogTitle>{t('payment.title', 'Complete Payment')}</DialogTitle>\n              <DialogDescription>\n                {t('payment.description', 'Complete your payment to confirm the booking')}\n              </DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <div className=\"border rounded-lg p-4 bg-muted/50\">\n                <h4 className=\"font-medium mb-2\">{t('booking.summary', 'Booking Summary')}</h4>\n                <div className=\"space-y-1 text-sm\">\n                  <p><span className=\"font-medium\">{t('equipment.name', 'Equipment')}:</span> {equipment.name}</p>\n                  <p><span className=\"font-medium\">{t('booking.dates', 'Dates')}:</span> {bookingData.booking.startDate && bookingData.booking.endDate && `${format(new Date(bookingData.booking.startDate), 'PP')} - ${format(new Date(bookingData.booking.endDate), 'PP')}`}</p>\n                  <p><span className=\"font-medium\">{t('booking.total', 'Total')}:</span> ₹{bookingData.booking.totalPrice}</p>\n                </div>\n              </div>\n              <PaymentGateway\n                bookingId={bookingData.booking.id}\n                totalPrice={bookingData.booking.totalPrice}\n                razorpayOrderId={bookingData.booking.razorpayOrderId}\n                userData={user ? { name: user.name, email: user.email, phone: user.phone } : {}}\n                onSuccess={() => {\n                  setShowPaymentGateway(false);\n                  setLocation('/dashboard');\n                }}\n                onError={(error) => {\n                  toast({\n                    title: t('payment.failed', 'Payment Failed'),\n                    description: error.message,\n                    variant: \"destructive\",\n                  });\n                }}\n              />\n            </div>\n          </DialogContent>\n        </Dialog>\n      )}\n\n      <div className=\"mt-8\">\n        <h2 className=\"text-2xl font-bold\">{t(\"reviews.title\")}</h2>\n        {reviews && reviews.length > 0 ? (\n          <div className=\"space-y-4\">\n            {reviews.map((review) => (\n              <Card key={review.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    {[...Array(5)].map((_, i) => (\n                      <Star\n                        key={i}\n                        className={`w-4 h-4 ${\n                          i < review.rating\n                            ? \"text-yellow-400 fill-current\"\n                            : \"text-gray-300\"\n                        }`}\n                      />\n                    ))}\n                  </div>\n                  <p className=\"text-sm text-muted-foreground mb-2\">\n                    {formatLocalDate(new Date(review.createdAt))}\n                  </p>\n                  <p>{review.comment}</p>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-muted-foreground\">{t(\"reviews.none\")}</p>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":19281},"client/src/components/ui/sheet.tsx":{"content":"import * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4267},"client/src/components/footer.tsx":{"content":"import { Link } from \"wouter\";\nimport { useTranslation } from \"react-i18next\";\n\nexport function Footer() {\n  const { t } = useTranslation();\n  const currentYear = new Date().getFullYear();\n\n  return (\n    <footer className=\"border-t mt-auto\">\n      <div className=\"container mx-auto px-4 py-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n          <div>\n            <h3 className=\"font-semibold mb-3\">{t('branding.name')}</h3>\n            <p className=\"text-sm text-muted-foreground\">\n              {t('branding.description')}\n            </p>\n          </div>\n          <div>\n            <h3 className=\"font-semibold mb-3\">{t('footer.quickLinks')}</h3>\n            <ul className=\"space-y-2\">\n              <li>\n                <Link \n                  href=\"/equipment\"\n                  className=\"text-sm text-muted-foreground hover:text-primary\"\n                >\n                  {t('nav.equipment')}\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/compare\"\n                  className=\"text-sm text-muted-foreground hover:text-primary\"\n                >\n                  {t('equipment.compareEquipment')}\n                </Link>\n              </li>\n              <li>\n                <Link \n                  href=\"/dashboard\"\n                  className=\"text-sm text-muted-foreground hover:text-primary\"\n                >\n                  {t('nav.bookings')}\n                </Link>\n              </li>\n            </ul>\n          </div>\n          <div>\n            <h3 className=\"font-semibold mb-3\">{t('footer.contact')}</h3>\n            <p className=\"text-sm text-muted-foreground\">\n              {t('footer.email')}<br />\n              {t('footer.phone')}\n            </p>\n          </div>\n        </div>\n        <div className=\"border-t mt-6 pt-6 text-center text-sm text-muted-foreground\">\n          {t('footer.copyright', { year: currentYear })}\n        </div>\n      </div>\n    </footer>\n  );\n}","size_bytes":1996},"client/src/components/MapView.tsx":{"content":"import { MapView as ActualMapView } from './map-view';\n\n// Export both default and named export to maintain compatibility\nexport const MapView = ActualMapView;\nexport default ActualMapView;","size_bytes":189},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":845},"client/src/hooks/use-voice-assistant.ts":{"content":"import { useState, useEffect, useCallback } from 'react';\nimport SpeechRecognition, { useSpeechRecognition } from 'react-speech-recognition';\nimport { useTranslation } from 'react-i18next';\n\ntype VoiceCommandHandler = (command: string) => void;\n\ninterface UseVoiceAssistantProps {\n  onCommand: VoiceCommandHandler;\n  language?: string;\n}\n\nconst COMMAND_THRESHOLD = 0.8; // Fuzzy matching threshold\nconst NO_SPEECH_TIMEOUT = 10000; // 10 seconds\n\nexport function useVoiceAssistant({ onCommand, language = 'en-US' }: UseVoiceAssistantProps) {\n  const [isListening, setIsListening] = useState(false);\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [noSpeechTimeout, setNoSpeechTimeout] = useState<NodeJS.Timeout | null>(null);\n  const { t, i18n } = useTranslation();\n\n  // Language mapping for voice recognition\n  const languageMap: Record<string, string> = {\n    'en': 'en-US',\n    'hi': 'hi-IN',\n    'mr': 'mr-IN'\n  };\n\n  // Debug logging for language settings\n  useEffect(() => {\n    console.debug('Voice Recognition Settings:', {\n      currentLanguage: i18n.language,\n      mappedLanguage: languageMap[i18n.language] || 'en-US',\n      supportedLanguages: Object.keys(languageMap),\n      browserSupport: !!window.SpeechRecognition || !!window.webkitSpeechRecognition\n    });\n  }, [i18n.language]);\n\n  // Clear timeouts on cleanup\n  const clearTimeouts = useCallback(() => {\n    if (noSpeechTimeout) {\n      clearTimeout(noSpeechTimeout);\n      setNoSpeechTimeout(null);\n    }\n  }, [noSpeechTimeout]);\n\n  // Stop listening with cleanup\n  const stopListening = useCallback(() => {\n    try {\n      console.debug('Stopping voice recognition...');\n      clearTimeouts();\n      SpeechRecognition.stopListening();\n      resetTranscript();\n      setIsListening(false);\n      setError(null);\n    } catch (error) {\n      console.error('Error stopping speech recognition:', error);\n      setError(t('voice.stopError'));\n    }\n  }, [clearTimeouts, t]);\n\n  const {\n    transcript,\n    resetTranscript,\n    browserSupportsSpeechRecognition,\n    isMicrophoneAvailable\n  } = useSpeechRecognition({\n    clearTranscriptOnListen: true,\n    commands: [\n      {\n        command: [\n          'book now', 'book', 'start booking', 'rent', 'rent now',\n          'बुक करा', 'भाड्याने घ्या', // Marathi\n          'किराये पर लें', 'बुक करें', 'किराया', 'किराए पर लें', // Hindi\n          'अभी बुक करें', 'किराए के लिए', // Additional Hindi variations\n          'भाडे करा', 'भाड्यावर घ्या', 'आरक्षण करा' // Additional Marathi variations\n        ],\n        callback: () => {\n          console.debug('Executing book command');\n          onCommand('book now');\n        },\n        isFuzzyMatch: true,\n        fuzzyMatchingThreshold: COMMAND_THRESHOLD\n      },\n      {\n        command: [\n          'close', 'exit', 'cancel', 'go back',\n          'बंद करा', 'रद्द करा', // Marathi\n          'बंद करें', 'रद्द करें', 'वापस जाएं', // Hindi\n          'बाहेर पडा', 'मागे जा', 'रद्द', // Additional Marathi\n          'बंद कीजिए', 'वापस', 'रद्द कीजिए' // Additional Hindi\n        ],\n        callback: () => {\n          console.debug('Executing close command');\n          onCommand('close');\n        },\n        isFuzzyMatch: true,\n        fuzzyMatchingThreshold: COMMAND_THRESHOLD\n      },\n      {\n        command: [\n          'confirm booking', 'confirm', 'complete booking', 'finish booking',\n          'बुकिंग कन्फर्म करा', 'पूर्ण करा', // Marathi\n          'बुकिंग कन्फर्म करें', 'पूरा करें', // Hindi\n          'पुष्टी करा', 'बुकिंग पूर्ण करा', // Additional Marathi\n          'बुकिंग पक्की करें', 'आरक्षण पूरा करें' // Additional Hindi\n        ],\n        callback: () => {\n          console.debug('Executing confirm command');\n          onCommand('confirm booking');\n        },\n        isFuzzyMatch: true,\n        fuzzyMatchingThreshold: COMMAND_THRESHOLD\n      }\n    ]\n  });\n\n  // Start listening with improved error handling\n  const startListening = useCallback(async () => {\n    try {\n      if (!browserSupportsSpeechRecognition) {\n        throw new Error(t('voice.unsupported'));\n      }\n\n      console.debug('Requesting microphone permission...');\n      await navigator.mediaDevices.getUserMedia({ audio: true })\n        .then(stream => stream.getTracks().forEach(track => track.stop()));\n\n      setIsListening(true);\n      setError(null);\n      resetTranscript();\n\n      const recognition = SpeechRecognition.getRecognition();\n      if (recognition) {\n        console.debug('Configuring speech recognition:', {\n          language: languageMap[i18n.language] || 'en-US',\n          continuous: true,\n          interimResults: true\n        });\n\n        recognition.continuous = true;\n        recognition.interimResults = true;\n        recognition.lang = languageMap[i18n.language] || 'en-US';\n\n        // Set up timeout for no speech\n        const timeout = setTimeout(() => {\n          console.debug('No speech detected, stopping recognition');\n          stopListening();\n          setError(t('voice.noSpeechDetected'));\n        }, NO_SPEECH_TIMEOUT);\n        setNoSpeechTimeout(timeout);\n\n        await SpeechRecognition.startListening({\n          continuous: true,\n          language: languageMap[i18n.language] || 'en-US'\n        });\n      }\n    } catch (error) {\n      console.error('Error starting speech recognition:', error);\n      setError(t('voice.startError'));\n      setIsListening(false);\n    }\n  }, [browserSupportsSpeechRecognition, i18n.language, resetTranscript, stopListening, t]);\n\n  // Text-to-speech with improved reliability\n  const speak = useCallback((text: string) => {\n    if (!('speechSynthesis' in window)) {\n      console.error('Browser does not support speech synthesis');\n      return;\n    }\n\n    try {\n      console.debug('Starting speech synthesis:', {\n        text,\n        language: languageMap[i18n.language] || 'en-US'\n      });\n\n      window.speechSynthesis.cancel(); // Clear queue\n\n      const utterance = new SpeechSynthesisUtterance(text);\n      utterance.lang = languageMap[i18n.language] || 'en-US';\n      utterance.rate = 0.9;\n      utterance.pitch = 1;\n      utterance.volume = 1;\n\n      const voices = window.speechSynthesis.getVoices();\n      const voice = voices.find(v => v.lang === utterance.lang) || voices[0];\n      if (voice) utterance.voice = voice;\n\n      utterance.onstart = () => setIsSpeaking(true);\n      utterance.onend = () => {\n        setIsSpeaking(false);\n        window.speechSynthesis.cancel();\n      };\n      utterance.onerror = (event) => {\n        console.error('Speech synthesis error:', event);\n        setIsSpeaking(false);\n        window.speechSynthesis.cancel();\n      };\n\n      window.speechSynthesis.speak(utterance);\n    } catch (error) {\n      console.error('Speech synthesis error:', error);\n      setIsSpeaking(false);\n    }\n  }, [i18n.language]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (isListening) stopListening();\n      if (isSpeaking) window.speechSynthesis.cancel();\n      clearTimeouts();\n    };\n  }, [isListening, isSpeaking, stopListening, clearTimeouts]);\n\n  return {\n    isListening,\n    isSpeaking,\n    transcript,\n    error,\n    startListening,\n    stopListening,\n    browserSupportsSpeechRecognition,\n    isMicrophoneAvailable,\n    speak\n  };\n}","size_bytes":7867},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3007},"client/src/pages/dashboard-page.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Booking, Equipment, insertEquipmentSchema, type InsertEquipment } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Plus, Pencil, Star, Download } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { MainNav } from \"@/components/main-nav\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription } from \"@/components/ui/dialog\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useTranslation } from \"react-i18next\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { PaymentGateway } from \"@/components/payment-gateway\";\nimport { ReviewForm } from \"@/components/review-form\";\n\nexport default function DashboardPage() {\n  const { user } = useAuth();\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingEquipment, setEditingEquipment] = useState<Equipment | null>(null);\n  const [showRatingDialog, setShowRatingDialog] = useState(false);\n  const [ratingBooking, setRatingBooking] = useState<Booking | null>(null);\n  const [downloadingReceipt, setDownloadingReceipt] = useState<number | null>(null);\n\n  const { data: myEquipment, isLoading: isLoadingEquipment, error: equipmentError } = useQuery<Equipment[]>({\n    queryKey: [\"/api/equipment\", \"owned\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/equipment?owned=true\", {\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to fetch equipment\");\n      }\n      return res.json();\n    },\n    enabled: !!user,\n    staleTime: 30000,\n    retry: 1,\n  });\n\n  if (equipmentError) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen text-destructive\">\n        <p>Error loading equipment: {equipmentError instanceof Error ? equipmentError.message : 'Unknown error'}</p>\n      </div>\n    );\n  }\n\n  const { data: bookings, isLoading: isLoadingBookings } = useQuery<Booking[]>({\n    queryKey: [\"/api/bookings\", user?.id],\n    queryFn: async () => {\n      console.log('Fetching bookings for user:', user?.id);\n      const res = await fetch(`/api/bookings?userId=${user?.id}`, {\n        credentials: \"include\",\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        console.error('Error fetching bookings:', error);\n        throw new Error(error.message || \"Failed to fetch bookings\");\n      }\n      const data = await res.json();\n      console.log('Received bookings:', data);\n      return data;\n    },\n    enabled: !!user\n  });\n\n  const form = useForm<InsertEquipment>({\n    resolver: zodResolver(insertEquipmentSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      category: \"\",\n      dailyRate: 0,\n      location: \"\",\n      imageUrl: \"\",\n      ownerId: user?.id || 0,\n      specs: {},\n    },\n  });\n\n  useEffect(() => {\n    const shouldOpenDialog = window.localStorage.getItem('openAddEquipment');\n    if (shouldOpenDialog === 'true') {\n      setIsDialogOpen(true);\n      window.localStorage.removeItem('openAddEquipment');\n    }\n\n    if (editingEquipment) {\n      form.reset({\n        name: editingEquipment.name,\n        description: editingEquipment.description,\n        category: editingEquipment.category,\n        dailyRate: editingEquipment.dailyRate,\n        location: editingEquipment.location,\n        imageUrl: editingEquipment.imageUrl,\n        ownerId: editingEquipment.ownerId,\n        specs: editingEquipment.specs || {},\n      });\n    } else {\n      form.reset({\n        name: \"\",\n        description: \"\",\n        category: \"\",\n        dailyRate: 0,\n        location: \"\",\n        imageUrl: \"\",\n        ownerId: user?.id || 0,\n        specs: {},\n      });\n    }\n  }, [editingEquipment, form, user?.id]);\n\n  const createEquipmentMutation = useMutation({\n    mutationFn: async (data: InsertEquipment) => {\n      try {\n        const formData = new FormData();\n        Object.entries(data).forEach(([key, value]) => {\n          if (key === 'specs') {\n            formData.append(key, JSON.stringify(value));\n          } else if (key === 'dailyRate') {\n            formData.append(key, String(value ?? 0));\n          } else {\n            formData.append(key, value?.toString() ?? '');\n          }\n        });\n\n        const imageInput = document.querySelector<HTMLInputElement>('input[type=\"file\"]');\n        if (imageInput?.files?.[0]) {\n          formData.append(\"image\", imageInput.files[0]);\n        }\n\n        const res = await fetch(\"/api/equipment\", {\n          method: \"POST\",\n          body: formData,\n          credentials: \"include\",\n        });\n\n        if (!res.ok) {\n          const errorData = await res.json();\n          throw new Error(errorData.error || 'Failed to create equipment');\n        }\n\n        return res.json();\n      } catch (error) {\n        console.error('Equipment creation error:', error);\n        throw error;\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/equipment\"] });\n      setIsDialogOpen(false);\n      form.reset();\n      toast({\n        title: \"Success\",\n        description: t('equipment.createSuccess', \"Equipment listed successfully\"),\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t('common.error', \"Error\"),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateEquipmentMutation = useMutation({\n    mutationFn: async (data: InsertEquipment & { id: number }) => {\n      const { id, ...updateData } = data;\n      try {\n        const formData = new FormData();\n        Object.entries(updateData).forEach(([key, value]) => {\n          if (key === 'specs') {\n            formData.append(key, JSON.stringify(value));\n          } else if (key === 'dailyRate') {\n            formData.append(key, String(value ?? 0));\n          } else {\n            formData.append(key, value?.toString() ?? '');\n          }\n        });\n\n        const imageInput = document.querySelector<HTMLInputElement>('input[type=\"file\"]');\n        if (imageInput?.files?.[0]) {\n          formData.append(\"image\", imageInput.files[0]);\n        }\n\n        const res = await fetch(`/api/equipment/${id}`, {\n          method: \"PATCH\",\n          body: formData,\n          credentials: \"include\",\n        });\n\n        if (!res.ok) {\n          const errorData = await res.json();\n          throw new Error(errorData.error || 'Failed to update equipment');\n        }\n\n        return res.json();\n      } catch (error) {\n        console.error('Equipment update error:', error);\n        throw error;\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/equipment\"] });\n      setIsDialogOpen(false);\n      setEditingEquipment(null);\n      form.reset();\n      toast({\n        title: \"Success\",\n        description: t('equipment.updateSuccess', \"Equipment updated successfully\"),\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t('common.error', \"Error\"),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteEquipmentMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/equipment/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\",\n      });\n\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || 'Failed to delete equipment');\n      }\n      return id;\n    },\n    onSuccess: async (id) => {\n      await queryClient.invalidateQueries({ queryKey: [\"/api/equipment\"] });\n      await queryClient.invalidateQueries({ queryKey: [\"/api/equipment\", \"owned\"] });\n      await queryClient.invalidateQueries({ queryKey: [`/api/equipment/${id}`] });\n\n      toast({\n        title: \"Success\",\n        description: t('equipment.deleteSuccess', \"Equipment deleted successfully\"),\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t('common.error', \"Error\"),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const submitReviewMutation = useMutation({\n    mutationFn: async (reviewData: { userId: number, equipmentId: number, rating: number, comment: string }) => {\n      const res = await fetch('/api/reviews', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(reviewData),\n        credentials: 'include'\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || error.details || 'Failed to submit review');\n      }\n\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/bookings'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/equipment'] });\n      setShowRatingDialog(false);\n      setRatingBooking(null);\n      toast({\n        title: t('review.success', 'Review submitted'),\n        description: t('review.thankYou', 'Thank you for your feedback!')\n      });\n    },\n    onError: (error: Error) => {\n      console.error('Review submission error:', error);\n      toast({\n        title: t('common.error', 'Error'),\n        description: error.message,\n        variant: 'destructive'\n      });\n    }\n  });\n\n\n  async function onSubmit(data: InsertEquipment) {\n    if (editingEquipment) {\n      updateEquipmentMutation.mutate({ ...data, id: editingEquipment.id });\n    } else {\n      createEquipmentMutation.mutate(data);\n    }\n  }\n\n  if (isLoadingBookings || isLoadingEquipment) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <MainNav />\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <h1 className=\"text-4xl font-bold\">{t('dashboard.title')}</h1>\n          <div className=\"flex flex-col items-end\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"text-xl font-semibold text-green-600\">\n                {t('dashboard.welcomePrefix', 'Welcome')} {user?.name}!\n              </span>\n              <div className=\"w-2 h-2 rounded-full bg-green-500 animate-pulse\" />\n            </div>\n            <span className=\"text-sm text-muted-foreground\">\n              {format(new Date(), 'EEEE, MMMM d, yyyy')}\n            </span>\n          </div>\n        </div>\n\n        <div className=\"mb-12\">\n          <div className=\"flex justify-between items-center mb-6\">\n            <h2 className=\"text-2xl font-semibold\">\n              {t('dashboard.myEquipment')}\n            </h2>\n            <Dialog open={isDialogOpen} onOpenChange={(open) => {\n              setIsDialogOpen(open);\n              if (!open) {\n                setEditingEquipment(null);\n                form.reset();\n              }\n            }}>\n              <DialogTrigger asChild>\n                <Button>\n                  <Plus className=\"w-4 h-4 mr-2\" />\n                  {t('dashboard.addEquipment')}\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"sm:max-w-[500px]\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingEquipment ? t('dashboard.editEquipment') : t('dashboard.addEquipment')}\n                  </DialogTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    {editingEquipment\n                      ? t('equipment.editDescription')\n                      : t('equipment.addDescription')}\n                  </p>\n                </DialogHeader>\n                <Form {...form}>\n                  <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('equipment.name')}</FormLabel>\n                          <FormControl>\n                            <Input {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"description\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('equipment.description')}</FormLabel>\n                          <FormControl>\n                            <Textarea {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"category\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('equipment.category')}</FormLabel>\n                          <Select\n                            onValueChange={field.onChange}\n                            defaultValue={field.value}\n                          >\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder={t('equipment.selectCategory')} />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"tractors\">{t('categories.tractors')}</SelectItem>\n                              <SelectItem value=\"harvesters\">{t('categories.harvesters')}</SelectItem>\n                              <SelectItem value=\"irrigation\">{t('categories.irrigation')}</SelectItem>\n                              <SelectItem value=\"seeders\">{t('categories.seeders')}</SelectItem>\n                              <SelectItem value=\"sprayers\">{t('categories.sprayers')}</SelectItem>\n                              <SelectItem value=\"plows\">{t('categories.plows')}</SelectItem>\n                              <SelectItem value=\"cultivators\">{t('categories.cultivators')}</SelectItem>\n                              <SelectItem value=\"fertilizer\">{t('categories.fertilizer')}</SelectItem>\n                              <SelectItem value=\"other\">{t('categories.other')}</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"dailyRate\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('equipment.dailyRate')}</FormLabel>\n                          <FormControl>\n                            <Input\n                              type=\"number\"\n                              {...field}\n                              onChange={(e) => field.onChange(Number(e.target.value))}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"location\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('equipment.location')}</FormLabel>\n                          <FormControl>\n                            <Input {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <div>\n                      <FormLabel>{t('equipment.image')}</FormLabel>\n                      <Input\n                        type=\"file\"\n                        accept=\"image/*\"\n                        className=\"mt-1\"\n                      />\n                    </div>\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full\"\n                      disabled={createEquipmentMutation.isPending || updateEquipmentMutation.isPending}\n                    >\n                      {(createEquipmentMutation.isPending || updateEquipmentMutation.isPending) && (\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      )}\n                      {editingEquipment ? t('equipment.update') : t('equipment.create')}\n                    </Button>\n                  </form>\n                </Form>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {myEquipment?.length === 0 ? (\n            <Card className=\"p-6 text-center\">\n              <p className=\"text-muted-foreground mb-4\">\n                {t('dashboard.noEquipment')}\n              </p>\n              <Button\n                variant=\"outline\"\n                onClick={() => setIsDialogOpen(true)}\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                {t('dashboard.addFirstEquipment')}\n              </Button>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {myEquipment?.map((equipment) => (\n                <Card key={equipment.id}>\n                  <img\n                    src={equipment.imageUrl}\n                    alt={equipment.name}\n                    className=\"w-full h-48 object-cover\"\n                  />\n                  <CardContent className=\"p-6\">\n                    <h3 className=\"text-xl font-semibold mb-2\">{equipment.name}</h3>\n                    <p className=\"text-muted-foreground mb-4\">\n                      {equipment.description.slice(0, 100)}...\n                    </p>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-lg font-medium\">\n                        ₹{equipment.dailyRate} {t('equipment.perDay')}\n                      </span>\n                      <div className=\"space-x-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setEditingEquipment(equipment);\n                            setIsDialogOpen(true);\n                          }}\n                        >\n                          <Pencil className=\"w-4 h-4 mr-2\" />\n                          {t('dashboard.actions.edit')}\n                        </Button>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={() => {\n                            if (confirm(t('equipment.confirmDelete'))) {\n                              deleteEquipmentMutation.mutate(equipment.id);\n                            }\n                          }}\n                        >\n                          {t('dashboard.actions.delete')}\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <div className=\"space-y-6\">\n          <h2 className=\"text-2xl font-semibold\">{t('dashboard.yourBookings')}</h2>\n          {bookings?.map((booking) => (\n            <Card key={booking.id}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex justify-between items-start\">\n                  <div>\n                    <h3 className=\"text-xl font-medium mb-2\">\n                      {t('dashboard.booking')} #{booking.id}\n                    </h3>\n                    <p className=\"text-muted-foreground\">\n                      {format(new Date(booking.startDate), \"PP\")} -\n                      {format(new Date(booking.endDate), \"PP\")}\n                    </p>\n                  </div>\n                  <div className=\"text-right\">\n                    <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${\n                      booking.status === 'paid' \n                        ? 'bg-green-100 text-green-800 border-green-200'\n                        : booking.status === 'pending' || booking.status === 'awaiting_payment'\n                        ? 'bg-yellow-100 text-yellow-800 border-yellow-200'\n                        : 'bg-red-100 text-red-800 border-red-200'\n                    }`}>\n                      {booking.status === 'paid' && <span className=\"text-green-600 mr-1\">✓</span>}\n                      {(booking.status === 'pending' || booking.status === 'awaiting_payment') && <span className=\"text-yellow-600 mr-1\">⏳</span>}\n                      {booking.status === 'payment_failed' && <span className=\"text-red-600 mr-1\">✗</span>}\n                      {t(`dashboard.status.${booking.status.toLowerCase()}`)}\n                    </span>\n                    <p className=\"mt-2 font-medium\">\n                      {t('dashboard.totalPrice')}: ₹{booking.totalPrice.toLocaleString()}\n                    </p>\n                    {booking.status === 'awaiting_payment' && booking.razorpayOrderId && (\n                      <PaymentGateway\n                        bookingId={booking.id}\n                        totalPrice={booking.totalPrice}\n                        razorpayOrderId={booking.razorpayOrderId}\n                        userData={{\n                          name: user?.name ?? undefined,\n                          email: user?.contact ?? undefined,\n                          phone: user?.contact ?? undefined,\n                        }}\n                        onSuccess={() => {\n                          queryClient.invalidateQueries({ queryKey: [\"/api/bookings\"] });\n                        }}\n                        onError={(error) => {\n                          console.error('Payment failed:', error);\n                          toast({\n                            title: t('payment.failed', \"Payment Failed\"),\n                            description: error.message,\n                            variant: \"destructive\",\n                          });\n                        }}\n                      />\n                    )}\n                    {booking.status === 'paid' && (\n                      <div className=\"space-y-2 mt-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          disabled={downloadingReceipt === booking.id}\n                          onClick={() => {\n                            setDownloadingReceipt(booking.id);\n                            // Get the receipt for this booking\n                            fetch(`/api/bookings/${booking.id}/receipt`, {\n                              credentials: 'include'\n                            })\n                              .then(res => {\n                                if (!res.ok) {\n                                  throw new Error('Receipt not found');\n                                }\n                                return res.json();\n                              })\n                              .then(receipt => {\n                                if (receipt && receipt.id) {\n                                  // Trigger download in a new window\n                                  window.open(`/api/receipts/${receipt.id}/download`, '_blank');\n                                } else {\n                                  throw new Error('Receipt data is invalid');\n                                }\n                              })\n                              .catch(error => {\n                                console.error('Error downloading receipt:', error);\n                                toast({\n                                  title: t('receipt.error', 'Error'),\n                                  description: t(\n                                    'receipt.downloadFailed',\n                                    'Failed to download receipt. Please try again.'\n                                  ),\n                                  variant: \"destructive\",\n                                });\n                              })\n                              .finally(() => {\n                                setDownloadingReceipt(null);\n                              });\n                          }}\n                        >\n                          {downloadingReceipt === booking.id ? (\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                          ) : (\n                            <Download className=\"w-4 h-4 mr-2\" />\n                          )}\n                          {downloadingReceipt === booking.id\n                            ? t('receipt.downloading', 'Downloading...')\n                            : t('booking.downloadReceipt', 'Download Receipt')}\n                        </Button>\n                        {!booking.isRated && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"ml-2\"\n                            onClick={() => {\n                              setRatingBooking(booking);\n                              setShowRatingDialog(true);\n                            }}\n                          >\n                            <Star className=\"w-4 h-4 mr-2\" />\n                            {t('review.rateBooking')}\n                          </Button>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n\n      {ratingBooking && (\n        <ReviewForm\n          equipmentId={ratingBooking.equipmentId}\n          isOpen={showRatingDialog}\n          onOpenChange={(open) => {\n            setShowRatingDialog(open);\n            if (!open) setRatingBooking(null);\n          }}\n          onSubmitSuccess={() => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/bookings\"] });\n          }}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":27152},"server/payment.ts":{"content":"import Razorpay from 'razorpay';\nimport crypto from 'crypto';\nimport { jsPDF } from 'jspdf';\nimport { storage } from './storage';\n\nif (!process.env.RAZORPAY_KEY_ID || !process.env.RAZORPAY_KEY_SECRET) {\n  throw new Error('RAZORPAY_KEY_ID and RAZORPAY_KEY_SECRET are required');\n}\n\nconst razorpay = new Razorpay({\n  key_id: process.env.RAZORPAY_KEY_ID,\n  key_secret: process.env.RAZORPAY_KEY_SECRET\n});\n\nexport async function createPaymentSession(bookingId: number, amount: number, equipmentName: string) {\n  try {\n    console.log('Creating payment session for booking:', bookingId, 'amount:', amount);\n\n    // Validate amount\n    if (amount <= 0) {\n      throw new Error('Invalid amount. Amount must be greater than 0');\n    }\n\n    // Amount is already in paise from frontend\n    const amountInPaise = Math.floor(amount);\n    console.log('Amount in paise:', amountInPaise);\n\n    const orderOptions = {\n      amount: amountInPaise,\n      currency: 'INR',\n      receipt: `booking_${bookingId}`,\n      notes: {\n        bookingId: bookingId.toString(),\n        equipmentName,\n      },\n    };\n    console.log('Creating Razorpay order with options:', orderOptions);\n\n    const order = await razorpay.orders.create(orderOptions);\n    console.log('Razorpay order created:', order);\n\n    if (!order?.id) {\n      throw new Error('Failed to create Razorpay order');\n    }\n\n    const config = {\n      id: order.id,\n      keyId: process.env.RAZORPAY_KEY_ID,\n      amount: amountInPaise,\n      currency: 'INR',\n      name: \"AgriRent Equipment\",\n      description: `Booking for ${equipmentName}`,\n      prefill: {\n        name: '',\n        email: '',\n        contact: ''\n      }\n    };\n    console.log('Returning payment configuration:', { ...config, keyId: '***' });\n    return config;\n  } catch (error) {\n    console.error('Error creating payment session:', error);\n    throw error;\n  }\n}\n\nexport async function verifyPaymentSignature(orderId: string, paymentId: string, signature: string): Promise<boolean> {\n  try {\n    const text = orderId + \"|\" + paymentId;\n    const expectedSignature = crypto\n      .createHmac(\"sha256\", process.env.RAZORPAY_KEY_SECRET!)\n      .update(text)\n      .digest(\"hex\");\n\n    return expectedSignature === signature;\n  } catch (error) {\n    console.error('Error verifying payment signature:', error);\n    return false;\n  }\n}\n\ninterface RazorpayPayment {\n  status: string;\n  amount: number;\n  currency: string;\n  created_at: number;\n  method: string;\n  notes?: {\n    equipmentName?: string;\n  };\n}\n\nexport async function generateReceipt(bookingId: number, paymentId: string) {\n  try {\n    // Get payment details from Razorpay\n    const payment = await razorpay.payments.fetch(paymentId) as RazorpayPayment;\n    const booking = await storage.getBooking(bookingId);\n    const equipment = booking ? await storage.getEquipment(booking.equipmentId) : null;\n    const user = booking ? await storage.getUser(booking.userId) : null;\n\n    if (!booking || !equipment || !user) {\n      throw new Error('Required information not found');\n    }\n\n    // Create PDF document\n    const doc = new jsPDF();\n    const pageWidth = doc.internal.pageSize.width;\n\n    // Header\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.setFontSize(20);\n    doc.text(\"AgriRent\", pageWidth / 2, 20, { align: \"center\" });\n\n    doc.setFontSize(12);\n    doc.text(\"Payment Receipt\", pageWidth / 2, 30, { align: \"center\" });\n\n    // Receipt details\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.setFontSize(10);\n\n    const startY = 50;\n    const lineHeight = 7;\n    let currentY = startY;\n\n    // Transaction details\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"Transaction Details\", 20, currentY);\n    currentY += lineHeight * 1.5;\n\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.text(`Receipt No: ${bookingId}-${Date.now()}`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Payment Date: ${new Date(payment.created_at * 1000).toLocaleString()}`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Payment Method: ${payment.method.toUpperCase()}`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Transaction ID: ${paymentId}`, 20, currentY);\n    currentY += lineHeight * 2;\n\n    // Customer details\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"Customer Details\", 20, currentY);\n    currentY += lineHeight * 1.5;\n\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.text(`Name: ${user.name}`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Contact: ${user.contact || 'N/A'}`, 20, currentY);\n    currentY += lineHeight * 2;\n\n    // Booking details\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"Booking Details\", 20, currentY);\n    currentY += lineHeight * 1.5;\n\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.text(`Equipment: ${equipment.name}`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Booking Period: ${new Date(booking.startDate).toLocaleDateString()} to ${new Date(booking.endDate).toLocaleDateString()}`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Daily Rate: ₹${equipment.dailyRate.toLocaleString('hi-IN')}`, 20, currentY);\n    currentY += lineHeight * 2;\n\n    // Payment details\n    doc.setFont(\"helvetica\", \"bold\");\n    doc.text(\"Payment Summary\", 20, currentY);\n    currentY += lineHeight * 1.5;\n\n    // Calculate rental details\n    const startDate = new Date(booking.startDate);\n    const endDate = new Date(booking.endDate);\n    const daysRented = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24));\n    const dailyRate = equipment.dailyRate;\n    const totalCalculated = dailyRate * daysRented;\n\n    // Helper function to format currency consistently with proper styling\n    // Amount is already in rupees, just format it\n    const formatAmount = (amount: number) => {\n      return `₹${Math.floor(amount).toLocaleString('en-IN')}`;\n    };\n\n    doc.setFont(\"helvetica\", \"normal\");\n    doc.text(`Daily Rate: ${formatAmount(dailyRate)}`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Rental Period: ${daysRented} day(s)`, 20, currentY);\n    currentY += lineHeight;\n    doc.text(`Equipment Rental: ${formatAmount(dailyRate)} × ${daysRented} = ${formatAmount(totalCalculated)}`, 20, currentY);\n    currentY += lineHeight;\n    const amountInRupees = booking.totalPrice;\n    doc.text(`Total Amount Paid: ${formatAmount(amountInRupees)}`, 20, currentY);\n    doc.text(`Status: ${payment.status.toUpperCase()}`, pageWidth - 60, currentY);\n    currentY += lineHeight * 2;\n\n    // Footer\n    const footerY = doc.internal.pageSize.height - 20;\n    doc.setFontSize(8);\n    doc.text(\"This is a computer generated receipt and does not require a signature.\", pageWidth / 2, footerY, { align: \"center\" });\n\n    // Save the receipt\n    const pdfBuffer = doc.output('arraybuffer');\n    const pdfBase64 = Buffer.from(pdfBuffer).toString('base64');\n\n    // Create receipt record in database - store amount in rupees\n    const receiptData = {\n      bookingId,\n      userId: booking.userId,\n      amount: booking.totalPrice, // Store in rupees directly\n      status: payment.status,\n      razorpayPaymentId: paymentId,\n      pdfUrl: `data:application/pdf;base64,${pdfBase64}`,\n      metadata: {\n        equipment_name: equipment.name,\n        booking_dates: {\n          start: booking.startDate.toISOString(),\n          end: booking.endDate.toISOString()\n        },\n        payment_method: payment.method\n      },\n      generatedAt: new Date()\n    };\n\n    const receipt = await storage.createReceipt(receiptData);\n    return {\n      ...receipt,\n      pdfUrl: receiptData.pdfUrl\n    };\n  } catch (error) {\n    console.error('Error generating receipt:', error);\n    throw new Error('Failed to generate receipt');\n  }\n}\n\ninterface WebhookSuccessResult {\n  status: 'success';\n  bookingId: number;\n  orderId: string;\n  paymentId: string;\n}\n\ninterface WebhookFailureResult {\n  status: 'failed';\n  bookingId: number;\n  error: string;\n}\n\ntype WebhookResult = WebhookSuccessResult | WebhookFailureResult | null;\n\nexport async function handleWebhookEvent(event: any): Promise<WebhookResult> {\n  try {\n    switch (event.event) {\n      case 'payment.captured':\n        // Payment successful\n        const { order_id, id: payment_id } = event.payload.payment.entity;\n        const bookingId = parseInt(event.payload.payment.entity.notes.bookingId);\n\n        if (!bookingId) {\n          throw new Error('Booking ID not found in payment notes');\n        }\n\n        return {\n          status: 'success',\n          bookingId,\n          orderId: order_id,\n          paymentId: payment_id\n        };\n\n      case 'payment.failed':\n        // Payment failed\n        return {\n          status: 'failed',\n          bookingId: parseInt(event.payload.payment.entity.notes.bookingId),\n          error: event.payload.payment.entity.error_description\n        };\n\n      default:\n        // Unhandled event\n        console.log('Unhandled webhook event:', event.event);\n        return null;\n    }\n  } catch (error) {\n    console.error('Error handling webhook event:', error);\n    throw error;\n  }\n}","size_bytes":9054},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1230},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3835},"client/src/components/review-form.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Star, Loader2 } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { reviewSchema } from \"@shared/schema\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface ReviewFormProps {\n  equipmentId: number;\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  onSubmitSuccess?: () => void;\n}\n\nexport function ReviewForm({ equipmentId, isOpen, onOpenChange, onSubmitSuccess }: ReviewFormProps) {\n  const [rating, setRating] = useState<number>(0);\n  const [comment, setComment] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [hasAttemptedSubmit, setHasAttemptedSubmit] = useState(false);\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n  const { user } = useAuth();\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    if (isOpen) {\n      setRating(0);\n      setComment(\"\");\n      setHasAttemptedSubmit(false);\n    }\n  }, [isOpen]);\n\n  const isCommentValid = comment.length >= 10 && comment.length <= 500;\n  const isFormValid = rating > 0 && isCommentValid;\n\n  const handleSubmit = async () => {\n    if (!user?.id) {\n      toast({\n        title: t('review.error'),\n        description: t('review.loginRequired'),\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setHasAttemptedSubmit(true);\n\n    if (!isFormValid) {\n      return;\n    }\n\n    try {\n      setIsSubmitting(true);\n\n      const reviewData = {\n        userId: user.id,\n        equipmentId,\n        rating,\n        comment: comment.trim(),\n        createdAt: new Date().toISOString()\n      };\n\n      console.log('Submitting review with data:', reviewData);\n\n      const response = await fetch('/api/reviews', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        body: JSON.stringify(reviewData)\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || error.error || 'Failed to submit review');\n      }\n\n      const result = await response.json();\n      console.log('Review submission response:', result);\n\n      // Invalidate relevant queries\n      await queryClient.invalidateQueries({ queryKey: [`/api/equipment/${equipmentId}/reviews`] });\n      await queryClient.invalidateQueries({ queryKey: [`/api/equipment/${equipmentId}`] });\n      await queryClient.invalidateQueries({ queryKey: ['/api/bookings'] });\n\n      toast({\n        title: t('review.success'),\n        description: t('review.thankYou'),\n      });\n\n      onSubmitSuccess?.();\n      onOpenChange(false);\n    } catch (error) {\n      console.error('Error submitting review:', error);\n      toast({\n        title: t('review.error'),\n        description: error instanceof Error ? error.message : t('review.error'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handleDialogClose = (open: boolean) => {\n    if (!open && (isSubmitting || (comment.length > 0 && !isCommentValid))) {\n      return;\n    }\n    onOpenChange(open);\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleDialogClose}>\n      <DialogContent className=\"sm:max-w-[425px]\">\n        <DialogHeader>\n          <DialogTitle>{t('review.title')}</DialogTitle>\n          <DialogDescription>\n            {t('review.description')}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-6 py-4\">\n          <div className=\"flex flex-col items-center space-y-2\">\n            <div className=\"flex justify-center space-x-2\" role=\"radiogroup\" aria-label={t('review.ratingLabel')}>\n              {[1, 2, 3, 4, 5].map((star) => (\n                <button\n                  key={star}\n                  type=\"button\"\n                  onClick={() => setRating(star)}\n                  className={`p-1 rounded-full transition-colors hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary ${\n                    rating >= star ? 'text-yellow-400' : 'text-gray-300'\n                  }`}\n                  aria-label={t('review.starRating', { count: star })}\n                  aria-pressed={rating >= star}\n                  disabled={isSubmitting}\n                >\n                  <Star className={`w-8 h-8 ${rating >= star ? 'fill-current' : ''}`} />\n                </button>\n              ))}\n            </div>\n            {hasAttemptedSubmit && rating === 0 && (\n              <p className=\"text-sm text-destructive\">\n                {t('review.selectRating')}\n              </p>\n            )}\n          </div>\n\n          <div className=\"space-y-2\">\n            <Textarea\n              placeholder={t('review.commentPlaceholder')}\n              value={comment}\n              onChange={(e) => setComment(e.target.value)}\n              className={`min-h-[100px] ${\n                hasAttemptedSubmit && !isCommentValid ? 'border-destructive' : ''\n              }`}\n              disabled={isSubmitting}\n            />\n            {hasAttemptedSubmit && comment.length > 0 && !isCommentValid && (\n              <p className=\"text-sm text-destructive\">\n                {comment.length < 10 \n                  ? t('review.commentTooShort')\n                  : t('review.commentTooLong')}\n              </p>\n            )}\n            <p className={`text-sm ${comment.length > 500 ? 'text-destructive' : 'text-muted-foreground'}`}>\n              {comment.length}/500 {t('review.characters')}\n            </p>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button\n            onClick={handleSubmit}\n            disabled={isSubmitting}\n            className=\"w-full\"\n          >\n            {isSubmitting ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                {t('review.submitting')}\n              </>\n            ) : (\n              t('review.submit')\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":6359},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, json } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// User model with language preference and preferences\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  name: text(\"name\").notNull(),\n  contact: text(\"contact\"),\n  language: text(\"language\").notNull().default('en'),\n  imageUrl: text(\"image_url\"),\n  preferences: json(\"preferences\").$type<{\n    preferredCategories: string[];\n    preferredLocations: string[];\n    priceRange: { min: number; max: number };\n    features: string[];\n  }>().default({\n    preferredCategories: [],\n    preferredLocations: [],\n    priceRange: { min: 0, max: 100000 },\n    features: []\n  }).notNull(),\n});\n\n// Equipment model with detailed specifications and search fields\nexport const equipment = pgTable(\"equipment\", {\n  id: serial(\"id\").primaryKey(),\n  ownerId: integer(\"owner_id\").notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  category: text(\"category\").notNull(),\n  dailyRate: integer(\"daily_rate\").notNull(),\n  imageUrl: text(\"image_url\").notNull(),\n  location: text(\"location\").notNull(),\n  availability: boolean(\"availability\").notNull().default(true),\n  specs: json(\"specs\").$type<Record<string, string>>().default({}).notNull(),\n  features: json(\"features\").$type<string[]>().default([]).notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  popularity: integer(\"popularity\").notNull().default(0),\n  latitudeCoord: text(\"latitude_coord\"),\n  longitudeCoord: text(\"longitude_coord\"),\n  seasonalAvailability: json(\"seasonal_availability\").$type<{\n    spring: boolean;\n    summer: boolean;\n    autumn: boolean;\n    winter: boolean;\n  }>().default({\n    spring: true,\n    summer: true,\n    autumn: true,\n    winter: true\n  }).notNull(),\n  searchableSpecs: json(\"searchable_specs\").$type<{\n    [key: string]: {\n      value: string | number;\n      unit: string;\n    };\n  }>().default({}).notNull(),\n});\n\n// Booking model with payment tracking and rating status\nexport const bookings = pgTable(\"bookings\", {\n  id: serial(\"id\").primaryKey(),\n  equipmentId: integer(\"equipment_id\").notNull(),\n  userId: integer(\"user_id\").notNull(),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\").notNull(),\n  totalPrice: integer(\"total_price\").notNull(),\n  status: text(\"status\").notNull().default('pending'),\n  razorpayOrderId: text(\"razorpay_order_id\"),\n  razorpayPaymentId: text(\"razorpay_payment_id\"),\n  isRated: boolean(\"is_rated\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  lastStatusUpdate: timestamp(\"last_status_update\").notNull().defaultNow(),\n});\n\n// Reviews and ratings\nexport const reviews = pgTable(\"reviews\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  equipmentId: integer(\"equipment_id\").notNull(),\n  rating: integer(\"rating\").notNull(),\n  comment: text(\"comment\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Comparison lists\nexport const comparisons = pgTable(\"comparisons\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  equipmentIds: integer(\"equipment_ids\").array().notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Recommendations\nexport const recommendations = pgTable(\"recommendations\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").notNull(),\n  equipmentId: integer(\"equipment_id\").notNull(),\n  score: integer(\"score\").notNull(),\n  reason: text(\"reason\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Add receipts table after the recommendations table\nexport const receipts = pgTable(\"receipts\", {\n  id: serial(\"id\").primaryKey(),\n  bookingId: integer(\"booking_id\").notNull(),\n  userId: integer(\"user_id\").notNull(),\n  amount: integer(\"amount\").notNull(),\n  status: text(\"status\").notNull(),\n  generatedAt: timestamp(\"generated_at\").notNull().defaultNow(),\n  pdfUrl: text(\"pdf_url\"),\n  razorpayPaymentId: text(\"razorpay_payment_id\"),\n  metadata: json(\"metadata\").$type<{\n    equipment_name?: string;\n    booking_dates?: { start: string; end: string };\n    payment_method?: string;\n  }>().default({}).notNull(),\n});\n\n// Add password validation schema\nconst passwordSchema = z.string()\n  .min(4, \"Password must be at least 4 characters\")\n  .regex(/[A-Z]/, \"Password must contain at least one uppercase letter\")\n  .regex(/[a-z]/, \"Password must contain at least one lowercase letter\")\n  .regex(/[0-9]/, \"Password must contain at least one number\");\n\n// Update the insert schema with better validation\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n  name: true,\n  language: true,\n}).extend({\n  username: z.string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(30, \"Username cannot exceed 30 characters\")\n    .regex(/^[a-zA-Z0-9_]+$/, \"Username can only contain letters, numbers, and underscores\"),\n  password: passwordSchema,\n  name: z.string()\n    .min(2, \"Name must be at least 2 characters\")\n    .max(50, \"Name cannot exceed 50 characters\")\n    .regex(/^[a-zA-Z\\s]+$/, \"Name can only contain letters and spaces\"),\n});\n\nexport const insertEquipmentSchema = createInsertSchema(equipment).omit({\n  id: true,\n  createdAt: true,\n  popularity: true,\n}).extend({\n  specs: z.record(z.string(), z.string()).default({}),\n  features: z.array(z.string()).default([]),\n  searchableSpecs: z.record(z.string(), z.object({\n    value: z.union([z.string(), z.number()]),\n    unit: z.string()\n  })).default({}),\n  seasonalAvailability: z.object({\n    spring: z.boolean(),\n    summer: z.boolean(),\n    autumn: z.boolean(),\n    winter: z.boolean()\n  }).default({\n    spring: true,\n    summer: true,\n    autumn: true,\n    winter: true\n  }),\n  latitudeCoord: z.string().nullable().optional(),\n  longitudeCoord: z.string().nullable().optional()\n});\n\nexport const insertBookingSchema = createInsertSchema(bookings).omit({\n  id: true,\n  createdAt: true,\n  lastStatusUpdate: true,\n  isRated: true,\n}).extend({\n  startDate: z.coerce.date(),\n  endDate: z.coerce.date(),\n  status: z.string().default('pending'),\n  totalPrice: z.number().optional(),\n});\n\nexport const insertRecommendationSchema = createInsertSchema(recommendations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const updateProfileSchema = z.object({\n  name: z.string().min(1, \"Name is required\"),\n  contact: z.string().optional(),\n  language: z.string().optional(),\n  imageUrl: z.string().optional(),\n});\n\nexport const reviewSchema = z.object({\n  id: z.number().optional(),\n  userId: z.number(),\n  equipmentId: z.number(),\n  rating: z.number().min(1, \"Please select a rating\").max(5, \"Rating cannot exceed 5 stars\"),\n  comment: z.string().min(10, \"Please provide a detailed comment (minimum 10 characters)\").max(500, \"Comment is too long (maximum 500 characters)\"),\n  createdAt: z.date().optional()\n});\n\nexport const paymentSessionSchema = z.object({\n  id: z.string(),\n  url: z.string(),\n  bookingId: z.number(),\n});\n\n// Update receipt schema (replace existing receiptSchema)\nexport const receiptSchema = createInsertSchema(receipts).extend({\n  generatedAt: z.coerce.date(),\n  metadata: z.object({\n    equipment_name: z.string().optional(),\n    booking_dates: z.object({\n      start: z.string(),\n      end: z.string()\n    }).optional(),\n    payment_method: z.string().optional()\n  }).optional().default({}),\n});\n\n// Export types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Equipment = typeof equipment.$inferSelect;\nexport type InsertEquipment = z.infer<typeof insertEquipmentSchema>;\nexport type Booking = typeof bookings.$inferSelect;\nexport type InsertBooking = z.infer<typeof insertBookingSchema>;\nexport type UpdateProfile = z.infer<typeof updateProfileSchema>;\nexport type Review = z.infer<typeof reviewSchema>;\nexport type InsertReview = z.infer<typeof reviewSchema>;\nexport type PaymentSession = z.infer<typeof paymentSessionSchema>;\nexport type Receipt = typeof receipts.$inferSelect;\nexport type InsertReceipt = z.infer<typeof receiptSchema>;\nexport type Recommendation = typeof recommendations.$inferSelect;\nexport type InsertRecommendation = z.infer<typeof insertRecommendationSchema>;","size_bytes":8537},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/calendar-heatmap.tsx":{"content":"import * as React from \"react\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { cn } from \"@/lib/utils\";\nimport { format, isValid, parseISO, startOfToday, isBefore, differenceInDays, addDays } from \"date-fns\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Loader2, AlertCircle, CalendarDays } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport { DateRange } from \"react-day-picker\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface CalendarHeatmapProps {\n  equipmentId: number;\n  startDate?: Date;\n  endDate?: Date;\n  dailyRate: number;\n  onSelect: (startDate: Date | undefined, endDate: Date | undefined) => void;\n  className?: string;\n  onConfirm?: () => void;\n  isConfirming?: boolean;\n}\n\nexport function CalendarHeatmap({\n  equipmentId,\n  startDate,\n  endDate,\n  dailyRate,\n  onSelect,\n  className,\n  onConfirm,\n  isConfirming = false,\n}: CalendarHeatmapProps) {\n  const { t } = useTranslation();\n  const [isChecking, setIsChecking] = React.useState(false);\n  const today = startOfToday();\n  const initialEndDate = addDays(today, 30);\n\n  const selectedDateRange: DateRange | undefined = React.useMemo(\n    () =>\n      startDate && endDate\n        ? { from: startDate, to: endDate }\n        : undefined,\n    [startDate, endDate]\n  );\n\n  const {\n    data: availability,\n    isLoading,\n    error,\n    refetch\n  } = useQuery({\n    queryKey: [`/api/equipment/${equipmentId}/availability`],\n    enabled: !isChecking && equipmentId > 0,\n    queryFn: async () => {\n      const formattedStartDate = format(today, \"yyyy-MM-dd\");\n      const formattedEndDate = format(initialEndDate, \"yyyy-MM-dd\");\n      setIsChecking(true);\n\n      try {\n        const response = await fetch(\n          `/api/equipment/${equipmentId}/availability?startDate=${formattedStartDate}&endDate=${formattedEndDate}`,\n          {\n            credentials: \"include\",\n          }\n        );\n\n        if (!response.ok) {\n          throw new Error(`Failed to fetch availability: ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        if (!data.startDate || !data.endDate) {\n          throw new Error(\"Invalid date range received from server\");\n        }\n\n        setIsChecking(false);\n        return {\n          available: data.available,\n          startDate: parseISO(data.startDate),\n          endDate: parseISO(data.endDate),\n          message: data.message,\n        };\n      } catch (error) {\n        console.error(\"Error fetching availability:\", error);\n        setIsChecking(false);\n        throw error;\n      }\n    },\n  });\n\n  const isDateAvailable = React.useCallback((date: Date): boolean => {\n    if (!isValid(date) || !availability) return false;\n    return !isBefore(date, today) && availability.available;\n  }, [availability, today]);\n\n  const handleSelect = React.useCallback((range: DateRange | undefined) => {\n    if (!range) {\n      onSelect(undefined, undefined);\n      return;\n    }\n\n    const { from, to } = range;\n    if (!from || !isDateAvailable(from)) {\n      onSelect(undefined, undefined);\n      return;\n    }\n\n    onSelect(from, to || from);\n  }, [onSelect, isDateAvailable]);\n\n  // Calculate total days and price\n  const totalDays = React.useMemo(() => {\n    if (!startDate || !endDate) return 0;\n    return differenceInDays(endDate, startDate) + 1;\n  }, [startDate, endDate]);\n\n  const totalPrice = React.useMemo(() => {\n    return totalDays * dailyRate;\n  }, [totalDays, dailyRate]);\n\n  const formatPrice = (amount: number) => {\n    return new Intl.NumberFormat('en-IN', {\n      style: 'currency',\n      currency: 'INR',\n      maximumFractionDigits: 0,\n    }).format(amount);\n  };\n\n  const handleDateClick = (date: Date) => {\n    if (!startDate || (startDate && endDate)) {\n      // Start new selection\n      setStartDate(date);\n      setEndDate(undefined);\n      onSelect?.(date, undefined);\n    } else if (startDate && !endDate) {\n      // Complete selection\n      let finalStartDate = startDate;\n      let finalEndDate = date;\n\n      if (date < startDate) {\n        // If end date is before start date, swap them\n        finalStartDate = date;\n        finalEndDate = startDate;\n      }\n\n      setStartDate(finalStartDate);\n      setEndDate(finalEndDate);\n      onSelect?.(finalStartDate, finalEndDate);\n\n      // Auto-trigger booking creation after a short delay\n      setTimeout(() => {\n        if (onConfirm) {\n          onConfirm();\n        }\n      }, 500);\n    }\n  };\n\n  if (error) {\n    return (\n      <div className=\"space-y-4\">\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            {error instanceof Error ? error.message : t(\"common.loadError\")}\n          </AlertDescription>\n        </Alert>\n        <Button onClick={() => refetch()} variant=\"outline\" className=\"w-full\">\n          {t(\"common.retry\")}\n        </Button>\n      </div>\n    );\n  }\n\n  if (isLoading || isChecking) {\n    return (\n      <div className=\"flex items-center justify-center h-96\">\n        <div className=\"text-center\">\n          <Loader2 className=\"h-8 w-8 animate-spin mx-auto mb-2\" />\n          <p className=\"text-sm text-muted-foreground\">{t(\"common.loading\")}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full bg-card rounded-lg border shadow-md\">\n      {/* Scrollable Content Area */}\n      <div className=\"flex-1 overflow-y-auto min-h-0 pb-4\">\n        <div>\n        <Calendar\n          mode=\"range\"\n          selected={selectedDateRange}\n          onSelect={handleSelect}\n          className={cn(\"rounded-t-lg\", className)}\n          disabled={(date) => !isDateAvailable(date)}\n          fromDate={today}\n          toDate={initialEndDate}\n        />\n        <div className=\"p-4 border-t\">\n          <div className=\"flex items-center gap-4 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-4 rounded-full bg-gray-300\"></div>\n              <span>Available</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-4 rounded-full bg-gray-400\"></div>\n              <span>Unavailable</span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <div className=\"w-4 h-4 rounded-full bg-primary\"></div>\n              <span>Selected</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n        {/* Booking Summary - Inside scrollable area */}\n        {startDate && endDate && (\n          <div className=\"p-4 border-t\">\n            <div className=\"flex items-center gap-2 mb-4\">\n              <CalendarDays className=\"h-5 w-5 text-muted-foreground\" />\n              <span className=\"font-medium text-base\">{t(\"booking.summary\")}</span>\n            </div>\n            <div className=\"grid grid-cols-2 gap-y-2 text-sm\">\n              <span className=\"text-muted-foreground\">{t(\"booking.startDate\")}</span>\n              <span className=\"text-right\">{format(startDate, \"PPP\")}</span>\n\n              <span className=\"text-muted-foreground\">{t(\"booking.endDate\")}</span>\n              <span className=\"text-right\">{format(endDate, \"PPP\")}</span>\n\n              <span className=\"text-muted-foreground\">{t(\"booking.days\")}</span>\n              <span className=\"text-right\">{totalDays}</span>\n\n              <span className=\"text-muted-foreground font-medium\">{t(\"booking.total\")}</span>\n              <span className=\"text-right font-medium\">{formatPrice(totalPrice)}</span>\n            </div>\n          </div>\n        )}\n\n        {availability?.message && (\n          <Alert variant=\"default\" className=\"mx-4\">\n            <AlertDescription className=\"text-sm\">\n              {availability.message}\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n\n      {/* Confirm Button - Fixed at bottom, outside scroll area */}\n      {onConfirm && startDate && endDate && (\n        <div className=\"sticky bottom-0 p-4 border-t bg-background mt-auto\">\n          <Button \n            onClick={onConfirm} \n            className=\"w-full h-12 text-base font-medium\"\n            disabled={isConfirming}\n          >\n            {isConfirming ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                {t('common.processing')}\n              </>\n            ) : (\n              <>\n                {t(\"booking.confirm\")} ({formatPrice(totalPrice)})\n              </>\n            )}\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":8600},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      fontFamily: {\n        sans: ['Poppins', 'sans-serif'],\n        serif: ['Lora', 'serif'],\n      },\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2891},"client/src/components/voice-assistant.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Mic, MicOff, Volume2, AlertCircle, Loader2, HelpCircle } from \"lucide-react\";\nimport { useVoiceAssistant } from \"@/hooks/use-voice-assistant\";\nimport { useTranslation } from \"react-i18next\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  Alert,\n  AlertDescription,\n  AlertTitle,\n} from \"@/components/ui/alert\";\nimport { useState, useCallback, useEffect } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VoiceAssistantProps {\n  onCommand: (command: string) => void;\n  className?: string;\n}\n\nexport function VoiceAssistant({ onCommand, className }: VoiceAssistantProps) {\n  const { t, i18n } = useTranslation();\n  const [isInitializing, setIsInitializing] = useState(false);\n  const [recognitionError, setRecognitionError] = useState<string | null>(null);\n\n  const {\n    isListening,\n    isSpeaking,\n    transcript,\n    error: voiceError,\n    startListening,\n    stopListening,\n    browserSupportsSpeechRecognition,\n    isMicrophoneAvailable,\n    speak,\n  } = useVoiceAssistant({\n    onCommand,\n  });\n\n  // Reset error state when language changes\n  useEffect(() => {\n    setRecognitionError(null);\n  }, [i18n.language]);\n\n  // Debug logging for voice assistant state\n  useEffect(() => {\n    console.debug('Voice Assistant Status:', {\n      isInitializing,\n      browserSupport: browserSupportsSpeechRecognition,\n      microphoneAvailable: isMicrophoneAvailable,\n      isListening,\n      isSpeaking,\n      error: voiceError,\n      currentLanguage: i18n.language,\n      recognitionError\n    });\n  }, [\n    isInitializing,\n    browserSupportsSpeechRecognition,\n    isMicrophoneAvailable,\n    isListening,\n    isSpeaking,\n    voiceError,\n    i18n.language,\n    recognitionError\n  ]);\n\n  const toggleListening = useCallback(async () => {\n    try {\n      setRecognitionError(null);\n\n      if (isListening) {\n        console.debug('Stopping voice assistant...');\n        stopListening();\n      } else {\n        console.debug('Starting voice assistant...');\n        setIsInitializing(true);\n        await startListening();\n        speak(t('voice.listening'));\n      }\n    } catch (error) {\n      console.error('Error toggling voice recognition:', error);\n      setRecognitionError(error instanceof Error ? error.message : t('voice.startError'));\n    } finally {\n      setIsInitializing(false);\n    }\n  }, [isListening, startListening, stopListening, speak, t]);\n\n  if (!browserSupportsSpeechRecognition) {\n    console.warn('Browser does not support speech recognition');\n    return (\n      <Alert variant=\"destructive\" className=\"max-w-md\">\n        <AlertCircle className=\"h-4 w-4\" />\n        <AlertTitle>{t('common.error')}</AlertTitle>\n        <AlertDescription>\n          {t('voice.unsupported')}\n        </AlertDescription>\n      </Alert>\n    );\n  }\n\n  if (!isMicrophoneAvailable) {\n    console.warn('Microphone is not available');\n    return (\n      <Alert variant=\"destructive\" className=\"max-w-md\">\n        <AlertCircle className=\"h-4 w-4\" />\n        <AlertTitle>{t('common.error')}</AlertTitle>\n        <AlertDescription>\n          {t('voice.noMicrophone')}\n        </AlertDescription>\n      </Alert>\n    );\n  }\n\n  return (\n    <TooltipProvider>\n      <div className={cn(\"flex flex-col items-start gap-2\", className)}>\n        <div className=\"flex items-center gap-3\">\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant={isListening ? \"default\" : \"outline\"}\n                size=\"icon\"\n                onClick={toggleListening}\n                disabled={isInitializing}\n                className={cn(\n                  \"transition-all duration-300\",\n                  isListening && \"animate-pulse ring-2 ring-primary ring-offset-2\",\n                  !isListening && \"hover:bg-primary/10\",\n                  (voiceError || recognitionError) && \"ring-2 ring-destructive\"\n                )}\n                aria-label={isListening ? t('voice.stopListening') : t('voice.startListening')}\n              >\n                {isInitializing ? (\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                ) : isListening ? (\n                  <Mic className=\"h-4 w-4 animate-bounce\" aria-hidden=\"true\" />\n                ) : (\n                  <MicOff className=\"h-4 w-4\" aria-hidden=\"true\" />\n                )}\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent side=\"right\" className=\"flex items-center gap-2\">\n              <HelpCircle className=\"h-4 w-4\" aria-hidden=\"true\" />\n              <p>{t('voice.commandHelp')}</p>\n            </TooltipContent>\n          </Tooltip>\n\n          {isListening && (\n            <Badge \n              variant=\"secondary\"\n              className=\"animate-pulse flex items-center gap-2 max-w-xs truncate\"\n              role=\"status\"\n              aria-live=\"polite\"\n            >\n              <span className=\"w-2 h-2 rounded-full bg-green-500 animate-ping\" aria-hidden=\"true\" />\n              <span className=\"truncate\">{transcript || t('voice.listening')}</span>\n            </Badge>\n          )}\n\n          {isSpeaking && (\n            <Badge \n              variant=\"secondary\"\n              className=\"flex items-center gap-2\"\n              role=\"status\"\n              aria-live=\"polite\"\n            >\n              <Volume2 className=\"h-4 w-4 animate-pulse\" aria-hidden=\"true\" />\n              {t('voice.speaking')}\n            </Badge>\n          )}\n        </div>\n\n        {(voiceError || recognitionError) && (\n          <Alert variant=\"destructive\" className=\"mt-2 max-w-md\" role=\"alert\">\n            <AlertCircle className=\"h-4 w-4\" aria-hidden=\"true\" />\n            <AlertDescription>\n              {voiceError || recognitionError}\n            </AlertDescription>\n          </Alert>\n        )}\n      </div>\n    </TooltipProvider>\n  );\n}","size_bytes":5969},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/pages/admin-page.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Booking } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Calendar } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useTranslation } from \"react-i18next\";\n\nexport default function AdminPage() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n\n  const { data: bookings, isLoading } = useQuery<Booking[]>({\n    queryKey: [\"/api/bookings\"],\n  });\n\n  const updateBookingStatus = useMutation({\n    mutationFn: async ({ bookingId, status }: { bookingId: number; status: string }) => {\n      const response = await fetch(`/api/bookings/${bookingId}/status`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status })\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || t('booking.updateError'));\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/bookings\"] });\n      toast({\n        title: t('common.success'),\n        description: t('booking.statusUpdateSuccess'),\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t('common.error'),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (!user?.isAdmin) {\n    setLocation(\"/\");\n    return null;\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <h1 className=\"text-4xl font-bold mb-8\">{t('admin.dashboard')}</h1>\n\n      <div className=\"space-y-6\">\n        <h2 className=\"text-2xl font-semibold\">{t('admin.allBookings')}</h2>\n        {bookings?.map((booking) => (\n          <Card key={booking.id}>\n            <CardContent className=\"p-6\">\n              <div className=\"flex justify-between items-start\">\n                <div>\n                  <h3 className=\"text-xl font-medium mb-2\">\n                    {t('booking.number', { id: booking.id })}\n                  </h3>\n                  <div className=\"space-y-2\">\n                    <p className=\"text-muted-foreground\">\n                      {t('booking.userId', { id: booking.userId })}\n                    </p>\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Calendar className=\"h-4 w-4\" />\n                      <span>\n                        {format(new Date(booking.startDate), \"PPP\")} - \n                        {format(new Date(booking.endDate), \"PPP\")}\n                      </span>\n                    </div>\n                    <p className=\"text-muted-foreground\">\n                      {t('booking.currentStatus')}: \n                      <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary/10 text-primary ml-2\">\n                        {t(`booking.status.${booking.status}`)}\n                      </span>\n                    </p>\n                  </div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"space-x-2\">\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => \n                        updateBookingStatus.mutate({ \n                          bookingId: booking.id, \n                          status: 'approved' \n                        })\n                      }\n                      disabled={updateBookingStatus.isPending || booking.status === 'approved'}\n                    >\n                      {updateBookingStatus.isPending ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                      ) : null}\n                      {t('booking.approve')}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      onClick={() => \n                        updateBookingStatus.mutate({ \n                          bookingId: booking.id, \n                          status: 'rejected' \n                        })\n                      }\n                      disabled={updateBookingStatus.isPending || booking.status === 'rejected'}\n                    >\n                      {updateBookingStatus.isPending ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                      ) : null}\n                      {t('booking.reject')}\n                    </Button>\n                  </div>\n                  <p className=\"mt-4 font-medium\">\n                    {t('common.total')}: {t('common.price', { price: booking.totalPrice })}\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}","size_bytes":5344},"client/src/pages/home-page.tsx":{"content":"import { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { MainNav } from \"@/components/main-nav\";\nimport { Footer } from \"@/components/footer\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  Calendar,\n  Shield,\n  IndianRupee,\n  ShieldCheck,\n  HeadphonesIcon,\n  Loader2,\n  CheckCircle,\n  XCircle,\n} from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Equipment } from \"@shared/schema\";\nimport { Card, CardContent, CardFooter } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Chatbot } from \"@/components/chatbot\";\n\nexport default function HomePage() {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n\n  const {\n    data: equipment,\n    isLoading,\n    error,\n  } = useQuery<Equipment[]>({\n    queryKey: ['/api/equipment'],\n    select: (data) => {\n      // Sort equipment: available first, then unavailable\n      return [...data].sort((a, b) => {\n        if (a.availability === b.availability) return 0;\n        return a.availability ? -1 : 1;\n      });\n    }\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"text-red-500\">\n          <XCircle className=\"h-12 w-12 mx-auto mb-4\" />\n          <h2 className=\"text-xl font-semibold text-center\">\n            {t('common.error')}\n          </h2>\n          <p className=\"text-center\">\n            {error instanceof Error ? error.message : t('common.loadError')}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  const allEquipment = equipment || [];\n\n  return (\n    <div>\n      <MainNav />\n      <main>\n        {/* Hero Section - with animations */}\n        <section className=\"py-20 bg-gradient-to-r from-primary to-primary/80 text-white\">\n          <div className=\"container mx-auto px-4 text-center\">\n            <h1 className=\"text-5xl font-bold mb-6 animate-fade-in\">\n              {t('home.hero.title')}\n            </h1>\n            <p className=\"text-xl mb-8 animate-slide-up\">\n              {t('home.hero.subtitle')}\n            </p>\n            <Button\n              asChild\n              size=\"lg\"\n              variant=\"secondary\"\n              className=\"bg-secondary hover:bg-secondary/90 text-secondary-foreground button-pulse shadow-lg\"\n            >\n              <Link href=\"/equipment\">{t('common.getStarted')}</Link>\n            </Button>\n          </div>\n        </section>\n\n        {/* Popular Equipment Section */}\n        <section className=\"py-16 bg-gray-50\">\n          <div className=\"container mx-auto px-4\">\n            <h2 className=\"text-4xl font-bold text-center text-[#5D4037] mb-12\">\n              {t('equipment.popularSection')}\n            </h2>\n            {allEquipment.length > 0 ? (\n              <div className=\"grid md:grid-cols-3 gap-8\">\n                {allEquipment.slice(0, 3).map((item, index) => (\n                  <div\n                    key={item.id}\n                    className={`equipment-card card-gradient rounded-lg shadow-custom overflow-hidden ${\n                      !item.availability ? 'opacity-75' : ''\n                    } animate-slide-up`}\n                    style={{ animationDelay: `${index * 0.15}s` }}\n                  >\n                    <div className=\"relative overflow-hidden\">\n                      <img\n                        src={item.imageUrl}\n                        alt={item.name}\n                        className=\"w-full h-48 object-cover transition-transform duration-700 hover:scale-110\"\n                      />\n                      {item.availability && (\n                        <div className=\"absolute top-2 right-2\">\n                          <Badge variant=\"success\" className=\"animate-pulse-soft\">\n                            <CheckCircle className=\"w-4 h-4 mr-1\" />\n                            {t('equipment.available')}\n                          </Badge>\n                        </div>\n                      )}\n                      {!item.availability && (\n                        <div className=\"absolute top-2 right-2\">\n                          <Badge variant=\"destructive\">\n                            <XCircle className=\"w-4 h-4 mr-1\" />\n                            {t('equipment.unavailable')}\n                          </Badge>\n                        </div>\n                      )}\n                    </div>\n                    <div className=\"p-6\">\n                      <div className=\"mb-4\">\n                        <h3 className=\"text-xl font-semibold\">{item.name}</h3>\n                      </div>\n                      <p className=\"text-muted-foreground mb-4\">{item.description}</p>\n                      <div className=\"flex justify-between items-center\">\n                        <span className=\"text-primary font-bold\">\n                          ₹{new Intl.NumberFormat('hi-IN').format(item.dailyRate)} {t('equipment.perDay')}\n                        </span>\n                        <Button\n                          asChild\n                          variant={item.availability ? \"default\" : \"secondary\"}\n                          className={`${item.availability ? \"bg-primary hover:bg-primary/90\" : \"\"} transition-all duration-300`}\n                          disabled={!item.availability}\n                        >\n                          <Link href={`/equipment/${item.id}`}>\n                            {t(item.availability ? 'equipment.viewDetails' : 'equipment.unavailable')}\n                          </Link>\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <p className=\"text-muted-foreground\">\n                  {t('equipment.noEquipment')}\n                </p>\n                <Button asChild variant=\"outline\" className=\"mt-4\">\n                  <Link href=\"/auth\">\n                    {t('common.signUpNow')}\n                  </Link>\n                </Button>\n              </div>\n            )}\n          </div>\n        </section>\n\n        {/* Why Choose Us Section */}\n        <section className=\"py-16 bg-white\">\n          <div className=\"container mx-auto px-4\">\n            <h2 className=\"text-4xl font-bold text-center text-[#5D4037] mb-4\">\n              {t('home.whyChooseUs.title')}\n            </h2>\n            <p className=\"text-center text-gray-600 mb-12\">\n              {t('home.whyChooseUs.subtitle')}\n            </p>\n            <div className=\"grid md:grid-cols-3 gap-8\">\n              <div className=\"bg-card rounded-lg p-8 text-center shadow-custom hover-lift\">\n                <div className=\"text-primary mb-4 bg-primary/10 p-4 rounded-full inline-block\">\n                  <IndianRupee className=\"w-12 h-12 mx-auto\" />\n                </div>\n                <h3 className=\"text-xl font-semibold mb-2\">\n                  {t('home.whyChooseUs.affordablePrices')}\n                </h3>\n                <p className=\"text-muted-foreground\">\n                  {t('home.whyChooseUs.affordablePricesDesc')}\n                </p>\n              </div>\n              <div className=\"bg-card rounded-lg p-8 text-center shadow-custom hover-lift\" style={{ animationDelay: '0.15s' }}>\n                <div className=\"text-primary mb-4 bg-primary/10 p-4 rounded-full inline-block\">\n                  <ShieldCheck className=\"w-12 h-12 mx-auto\" />\n                </div>\n                <h3 className=\"text-xl font-semibold mb-2\">\n                  {t('home.whyChooseUs.verifiedEquipment')}\n                </h3>\n                <p className=\"text-muted-foreground\">\n                  {t('home.whyChooseUs.verifiedEquipmentDesc')}\n                </p>\n              </div>\n              <div className=\"bg-card rounded-lg p-8 text-center shadow-custom hover-lift\" style={{ animationDelay: '0.3s' }}>\n                <div className=\"text-primary mb-4 bg-primary/10 p-4 rounded-full inline-block\">\n                  <HeadphonesIcon className=\"w-12 h-12 mx-auto\" />\n                </div>\n                <h3 className=\"text-xl font-semibold mb-2\">\n                  {t('home.whyChooseUs.support')}\n                </h3>\n                <p className=\"text-muted-foreground\">\n                  {t('home.whyChooseUs.supportDesc')}\n                </p>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Testimonials Section */}\n        <section className=\"py-16 bg-gray-50\">\n          <div className=\"container mx-auto px-4\">\n            <h2 className=\"text-4xl font-bold text-center text-[#5D4037] mb-12\">\n              {t('home.testimonials.title')}\n            </h2>\n            <div className=\"grid md:grid-cols-3 gap-8\">\n              {[\n                {\n                  id: 1,\n                  village: t('locations.paithan'),\n                  image: \"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=500&h=500&fit=crop\",\n                },\n                {\n                  id: 2,\n                  village: t('locations.vaijapur'),\n                  image: \"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=500&h=500&fit=crop\",\n                },\n                {\n                  id: 3,\n                  village: t('locations.phulambri'),\n                  image: \"https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=500&h=500&fit=crop\",\n                },\n              ].map((item, index) => (\n                <div\n                  key={item.id}\n                  className=\"bg-card rounded-lg shadow-custom p-6 animate-slide-up hover-lift\"\n                  style={{ animationDelay: `${index * 0.15}s` }}\n                >\n                  <div className=\"relative overflow-hidden rounded-lg mb-4\">\n                    <img\n                      src={item.image}\n                      alt={t('home.testimonials.farmIn', { village: item.village })}\n                      className=\"w-full h-48 object-cover transition-transform duration-700 hover:scale-110\"\n                    />\n                    <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-primary/80 to-transparent p-2\">\n                      <p className=\"text-white text-sm font-semibold\">{item.village}</p>\n                    </div>\n                  </div>\n                  <p className=\"text-muted-foreground mb-4 italic border-l-4 border-primary/30 pl-4\">\n                    \"{t('home.testimonials.quote')}\"\n                  </p>\n                  <div className=\"flex items-center\">\n                    <div className=\"w-12 h-12 rounded-full mr-4 overflow-hidden border-2 border-primary p-1\">\n                      <img\n                        src={`https://api.dicebear.com/7.x/initials/svg?seed=${item.village}`}\n                        alt={t('home.testimonials.farmerFrom', { village: item.village })}\n                        className=\"w-full h-full rounded-full\"\n                      />\n                    </div>\n                    <div>\n                      <h4 className=\"font-semibold\">\n                        {t('home.testimonials.farmer')}\n                      </h4>\n                      <p className=\"text-muted-foreground text-sm\">{item.village}</p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Call to Action Section */}\n        <section className=\"py-20 bg-gradient-to-r from-primary to-primary/80 text-white text-center\">\n          <div className=\"container mx-auto px-4\">\n            <h2 className=\"text-4xl font-bold mb-4 animate-fade-in\">\n              {t('home.cta.title')}\n            </h2>\n            <p className=\"text-xl mb-10 animate-slide-up\">\n              {t('home.cta.subtitle')}\n            </p>\n            <Button\n              asChild\n              size=\"lg\"\n              variant=\"secondary\"\n              className=\"bg-secondary hover:bg-secondary/90 text-secondary-foreground button-pulse shadow-lg px-8 py-6 text-lg\"\n            >\n              <Link href=\"/auth\">{t('common.signUpNow')}</Link>\n            </Button>\n          </div>\n        </section>\n      </main>\n      <Footer />\n      <Chatbot />\n    </div>\n  );\n}","size_bytes":12465},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7361},"client/src/components/language-switcher.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Languages, Loader2 } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useState, useEffect } from \"react\";\n\nconst languages = [\n  { code: 'en', label: 'English', nativeLabel: 'English' },\n  { code: 'hi', label: 'Hindi', nativeLabel: 'हिंदी' },\n  { code: 'mr', label: 'Marathi', nativeLabel: 'मराठी' }\n];\n\n// Placeholder for a more unique language icon component\nconst LanguageIcon = () => <Languages className=\"h-5 w-5\" />;\n\n\nexport function LanguageSwitcher() {\n  const { i18n } = useTranslation();\n  const [isChanging, setIsChanging] = useState(false);\n\n  useEffect(() => {\n    const savedLang = localStorage.getItem('i18nextLng');\n    if (savedLang && i18n.language !== savedLang) {\n      handleLanguageChange(savedLang);\n    }\n  }, []);\n\n  const handleLanguageChange = async (langCode: string) => {\n    try {\n      setIsChanging(true);\n      console.debug('Changing language to:', langCode);\n\n      // Change language and wait for it to complete\n      await i18n.changeLanguage(langCode);\n      localStorage.setItem('i18nextLng', langCode);\n      document.documentElement.lang = langCode;\n\n      // Reload resources for the new language\n      await i18n.reloadResources(langCode);\n\n      // Force re-render\n      window.dispatchEvent(new Event('languageChanged'));\n\n      console.debug('Language change completed for:', langCode);\n    } catch (error) {\n      console.error('Error changing language:', error);\n    } finally {\n      setIsChanging(false);\n    }\n  };\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button \n          variant=\"ghost\" \n          size=\"icon\"\n          className=\"relative hover:bg-green-50 transition-colors\"\n        >\n          <LanguageIcon />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-[150px]\">\n        {languages.map((lang) => (\n          <DropdownMenuItem\n            key={lang.code}\n            onClick={() => handleLanguageChange(lang.code)}\n            className={`flex items-center justify-between ${\n              i18n.language === lang.code ? 'bg-secondary' : ''\n            }`}\n            disabled={isChanging}\n            aria-current={i18n.language === lang.code ? 'true' : undefined}\n          >\n            <span>{lang.label}</span>\n            <span className=\"text-sm text-muted-foreground\">\n              {lang.nativeLabel}\n            </span>\n          </DropdownMenuItem>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}","size_bytes":2714},"client/src/hooks/use-websocket.ts":{"content":"// This file is kept as a placeholder but functionality is removed\nexport function useWebSocket() {\n  return {\n    sendMessage: () => {},\n    isConnected: false\n  };\n}","size_bytes":167},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { setupAuth } from \"./auth\";\nimport { createTables } from \"./migrations\";\n\n// Create uploads directory if it doesn't exist\nconst uploadsDir = path.join(process.cwd(), \"uploads\");\nif (!fs.existsSync(uploadsDir)) {\n  fs.mkdirSync(uploadsDir, { recursive: true });\n}\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\n// Add request logging middleware\napp.use((req, res, next) => {\n  const start = Date.now();\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (req.path.startsWith(\"/api\")) {\n      log(`${req.method} ${req.path} ${res.statusCode} in ${duration}ms`);\n    }\n  });\n  next();\n});\n\n// Initialize database tables with better error handling\ncreateTables().catch((err) => {\n  console.error(\"Failed to create database tables:\", err);\n  process.exit(1);\n});\n\n(async () => {\n  try {\n    const port = Number(process.env.PORT) || 5002;\n    const server = registerRoutes(app);\n    await setupAuth(app);\n\n    // Configure server timeouts\n    server.keepAliveTimeout = 120000; // 2 minutes\n    server.headersTimeout = 121000; // Slightly higher than keepAliveTimeout\n    server.timeout = 180000; // 3 minutes\n\n    // Enhanced error handling\n    app.use(\n      (\n        err: Error & { status?: number; statusCode?: number },\n        _req: Request,\n        res: Response,\n        _next: NextFunction,\n      ) => {\n        const status = err.status || err.statusCode || 500;\n        const message = err.message || \"Internal Server Error\";\n        console.error(\"Error:\", {\n          status,\n          message,\n          stack: err.stack,\n          timestamp: new Date().toISOString(),\n        });\n        res.status(status).json({\n          message,\n          status,\n          timestamp: new Date().toISOString(),\n        });\n      },\n    );\n\n    // Set up Vite in development mode\n    if (app.get(\"env\") === \"development\") {\n      await setupVite(app, server);\n    } else {\n      serveStatic(app);\n    }\n\n    // Enhanced connection handling\n    server.on(\"connection\", (socket) => {\n      socket.setKeepAlive(true, 30000);\n      socket.setTimeout(120000);\n\n      socket.on(\"error\", (err) => {\n        console.error(\"Socket error:\", err);\n      });\n\n      socket.on(\"timeout\", () => {\n        console.log(\"Socket timeout detected\");\n        socket.end();\n      });\n    });\n\n    // Start server with improved logging\n    server.listen(port, \"0.0.0.0\", () => {\n      console.log(`Server is running at http://0.0.0.0:${port}`);\n      log(`Server ready and listening on port ${port}`);\n\n      // Write a ready file to indicate the server is up\n      const readyFile = path.join(process.cwd(), \".ready\");\n      fs.writeFileSync(readyFile, \"ready\");\n\n      // Signal ready state\n      if (process.send) {\n        process.send(\"ready\");\n      }\n    });\n\n    // Enhanced graceful shutdown\n    const cleanup = async () => {\n      console.log(\"Initiating graceful shutdown...\");\n\n      // Remove ready file\n      try {\n        const readyFile = path.join(process.cwd(), \".ready\");\n        if (fs.existsSync(readyFile)) {\n          fs.unlinkSync(readyFile);\n        }\n      } catch (error) {\n        console.error(\"Error removing ready file:\", error);\n      }\n\n      // Close server\n      server.close(() => {\n        console.log(\"Server closed\");\n        process.exit(0);\n      });\n    };\n\n    // Register cleanup handlers\n    process.on(\"SIGTERM\", cleanup);\n    process.on(\"SIGINT\", cleanup);\n  } catch (error) {\n    console.error(\"Failed to start server:\", error);\n    process.exit(1);\n  }\n})();\n","size_bytes":3782},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { AuthProvider } from \"@/hooks/use-auth\";\nimport { ProtectedRoute } from \"./lib/protected-route\";\nimport NotFound from \"@/pages/not-found\";\nimport AuthPage from \"@/pages/auth-page\";\nimport HomePage from \"@/pages/home-page\";\nimport EquipmentListPage from \"@/pages/equipment-list-page\";\nimport EquipmentPage from \"@/pages/equipment-page\";\nimport DashboardPage from \"@/pages/dashboard-page\";\nimport AdminPage from \"@/pages/admin-page\";\nimport BookingPage from \"@/pages/BookingPage\";\nimport ComparePage from \"@/pages/compare-page\";\nimport ReceiptHistory from \"@/pages/ReceiptHistory\";\nimport \"./lib/i18n\";\nimport ReceiptPage from \"./pages/ReceiptPage\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/auth\" component={AuthPage} />\n      <ProtectedRoute path=\"/\" component={HomePage} />\n      <ProtectedRoute path=\"/equipment\" component={EquipmentListPage} />\n      <ProtectedRoute path=\"/equipment/:id\" component={EquipmentPage} />\n      <ProtectedRoute path=\"/booking/:id\" component={BookingPage} />\n      <ProtectedRoute path=\"/bookings/:id/receipt\" component={ReceiptPage} />\n      <ProtectedRoute path=\"/receipts\" component={ReceiptHistory} />\n      <ProtectedRoute path=\"/compare\" component={ComparePage} />\n      <ProtectedRoute path=\"/dashboard\" component={DashboardPage} />\n      <ProtectedRoute path=\"/admin\" component={() => <AdminPage />} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <Router />\n        <Toaster />\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;","size_bytes":1844},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n        success:\n          \"border-transparent bg-green-100 text-green-800 hover:bg-green-200/80\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }","size_bytes":1226},"client/src/components/map-view.tsx":{"content":"import { useEffect, useRef, useState, useCallback } from 'react';\nimport { MapContainer, TileLayer, Marker, Popup, useMapEvents } from 'react-leaflet';\nimport { Equipment } from '@shared/schema';\nimport { useTranslation } from 'react-i18next';\nimport { Button } from '@/components/ui/button';\nimport { Loader2, Navigation2, List, Map, RotateCcw } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { Card } from '@/components/ui/card';\nimport L from 'leaflet';\n\ninterface MapViewProps {\n  equipment?: Equipment[];\n  center?: [number, number];\n  zoom?: number;\n  onMarkerClick?: (equipment: Equipment) => void;\n  onLocationSelect?: (location: string) => void;\n}\n\n// Initialize city coordinates\nconst cityCoordinates: Record<string, [number, number]> = {\n  'pune': [18.5204, 73.8567],\n  'mumbai': [19.0760, 72.8777],\n  'delhi': [28.6139, 77.2090],\n  'bangalore': [12.9716, 77.5946],\n  'hyderabad': [17.3850, 78.4867],\n  'chennai': [13.0827, 80.2707],\n  'kolkata': [22.5726, 88.3639],\n  'ahmedabad': [23.0225, 72.5714],\n  'latur': [18.4088, 76.5604],\n  'nilanga': [18.1177, 76.7506],\n  'aurangabad': [19.8762, 75.3433],\n  'chh. sambhajinagar': [19.8762, 75.3433],\n  'nagpur': [21.1458, 79.0882],\n  'nashik': [19.9975, 73.7898],\n  'barshi': [18.2333, 75.6833],\n};\n\nfunction MapEventHandler({ onLocationSelect }: { onLocationSelect?: (location: string) => void }) {\n  useMapEvents({\n    click: (e) => {\n      const nearest = findNearestCity(e.latlng.lat, e.latlng.lng);\n      if (nearest && onLocationSelect) {\n        onLocationSelect(nearest);\n      }\n    }\n  });\n  return null;\n}\n\nconst findNearestCity = (lat: number, lng: number): string | null => {\n  let nearest = null;\n  let minDistance = Infinity;\n\n  Object.entries(cityCoordinates).forEach(([city, [cityLat, cityLng]]) => {\n    const distance = Math.sqrt(\n      Math.pow(lat - cityLat, 2) + Math.pow(lng - cityLng, 2)\n    );\n    if (distance < minDistance) {\n      minDistance = distance;\n      nearest = city;\n    }\n  });\n\n  return nearest;\n};\n\nexport function MapView({\n  equipment = [],\n  center = [20.5937, 78.9629], // Center of India\n  zoom = 5,\n  onMarkerClick,\n  onLocationSelect\n}: MapViewProps) {\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [isLocating, setIsLocating] = useState(false);\n  const [viewMode, setViewMode] = useState<'map' | 'list'>('map');\n  const [mapKey, setMapKey] = useState(0);\n  const [isMapLoading, setIsMapLoading] = useState(true);\n  const [isViewChanging, setIsViewChanging] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const markersRef = useRef<Record<number, L.Marker>>({});\n  \n  // Force map refresh when equipment data changes\n  useEffect(() => {\n    // Reset map key to force a refresh when equipment changes\n    if (viewMode === 'map') {\n      console.log(\"Equipment data changed, refreshing map markers\", equipment.length);\n      setMapKey(prev => prev + 1);\n      setIsMapLoading(true);\n      \n      // Clear and rebuild markers cache on data change\n      markersRef.current = {};\n      \n      // Log equipment locations for debugging\n      equipment.forEach(item => {\n        if (item.location) {\n          console.log(`Equipment ${item.id}: ${item.name} - Location: ${item.location}, Coordinates: ${item.latitudeCoord},${item.longitudeCoord}`);\n        }\n      });\n    }\n  }, [equipment, viewMode]);\n  \n  // Add a specialized effect for checking location and coordinate changes\n  useEffect(() => {\n    // Create a \"fingerprint\" of equipment locations that includes both city locations and coordinates\n    const locationFingerprint = equipment.map(item => \n      `${item.id}-${item.location}-${item.latitudeCoord}-${item.longitudeCoord}`\n    ).join('|');\n    \n    // Force map refresh when any equipment's location or coordinates change\n    if (viewMode === 'map') {\n      console.log(\"Checking equipment location changes\");\n      setMapKey(prev => prev + 1);\n      setIsMapLoading(true);\n    }\n  }, [equipment.map(item => `${item.id}-${item.location}-${item.latitudeCoord}-${item.longitudeCoord}`).join('|'), viewMode]);\n\n  const createCustomIcon = useCallback((dailyRate: number) => {\n    return L.divIcon({\n      className: 'custom-marker',\n      html: `\n        <div class=\"w-8 h-8 bg-primary rounded-full border-2 border-white shadow-lg flex items-center justify-center hover:scale-110 transition-transform\">\n          <span class=\"text-white text-xs font-bold\">₹${new Intl.NumberFormat('hi-IN').format(dailyRate)}</span>\n        </div>\n      `\n    });\n  }, []);\n\n  useEffect(() => {\n    if (containerRef.current) {\n      const { offsetWidth, offsetHeight } = containerRef.current;\n      if (offsetWidth === 0 || offsetHeight === 0) {\n        console.warn('Map container has zero dimensions');\n      }\n    }\n  }, []);\n\n  const handleLocationClick = useCallback(async () => {\n    if (!navigator.geolocation) {\n      toast({\n        title: t('map.locationError'),\n        description: t('map.locationAccessDenied'),\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsLocating(true);\n\n    try {\n      const position = await new Promise<GeolocationPosition>((resolve, reject) => {\n        navigator.geolocation.getCurrentPosition(resolve, reject, {\n          enableHighAccuracy: true,\n          timeout: 5000,\n          maximumAge: 0\n        });\n      });\n\n      const { latitude, longitude } = position.coords;\n      const nearest = findNearestCity(latitude, longitude);\n\n      if (nearest && onLocationSelect) {\n        onLocationSelect(nearest);\n        toast({\n          title: t('map.locationFound'),\n          description: t('map.locationUpdated')\n        });\n      }\n    } catch (error) {\n      toast({\n        title: t('map.locationError'),\n        description: t('map.locationAccessDenied'),\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsLocating(false);\n    }\n  }, [t, toast, onLocationSelect]);\n\n  return (\n    <div className=\"space-y-4 animate-fade-in\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent\">{t('equipment.availableEquipment')}</h2>\n        <div className=\"flex gap-2\">\n          {viewMode === 'map' && (\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => {\n                // Clear all markers/locations\n                if (onLocationSelect) {\n                  onLocationSelect(\"\");\n                }\n                setMapKey(k => k + 1);\n                setIsMapLoading(true);\n              }}\n              className=\"flex items-center gap-2 hover:bg-primary/10 transition-all duration-300\"\n            >\n              <RotateCcw className=\"h-4 w-4\" />\n              <span>{t('map.clear', 'Clear')}</span>\n            </Button>\n          )}\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => {\n              setIsViewChanging(true);\n              setViewMode(prev => prev === 'map' ? 'list' : 'map');\n              setMapKey(k => k + 1);\n              setTimeout(() => setIsViewChanging(false), 500);\n            }}\n            className=\"flex items-center gap-2 hover:bg-secondary/10 transition-all duration-300\"\n          >\n            {viewMode === 'map' ? (\n              <>\n                <List className=\"h-4 w-4\" />\n                <span>{t('map.listView')}</span>\n              </>\n            ) : (\n              <>\n                <Map className=\"h-4 w-4\" />\n                <span>{t('map.mapView')}</span>\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n\n      {isViewChanging ? (\n        <div className=\"h-[600px] w-full flex items-center justify-center bg-card rounded-lg border\">\n          <Loader2 className=\"h-8 w-8 animate-spin\" />\n          <span className=\"ml-2\">{t('common.loading')}</span>\n        </div>\n      ) : viewMode === 'map' ? (\n        <div ref={containerRef} className=\"h-[600px] w-full relative bg-card rounded-lg overflow-hidden border\">\n          {isMapLoading && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-background/50 z-50\">\n              <Loader2 className=\"h-8 w-8 animate-spin\" />\n              <span className=\"ml-2\">{t('map.loading')}</span>\n            </div>\n          )}\n          <MapContainer\n            key={mapKey}\n            center={center}\n            zoom={zoom}\n            className=\"w-full h-full\"\n            whenReady={() => setIsMapLoading(false)}\n          >\n            <TileLayer\n              url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n              attribution='© OpenStreetMap contributors'\n            />\n            <MapEventHandler onLocationSelect={onLocationSelect} />\n            {equipment\n              .filter(item => item.location)\n              .map(item => {\n                // First check if item has direct latitude/longitude\n                let markerPosition: [number, number] | null = null;\n                \n                if (item.latitudeCoord && item.longitudeCoord) {\n                  const lat = parseFloat(item.latitudeCoord);\n                  const lng = parseFloat(item.longitudeCoord);\n                  if (!isNaN(lat) && !isNaN(lng)) {\n                    markerPosition = [lat, lng];\n                    console.log(`Using database coordinates for ${item.name}:`, markerPosition);\n                  }\n                }\n                \n                // If no coordinates, fall back to city map\n                if (!markerPosition) {\n                  // Clean and normalize location name before lookup\n                  const locationName = item.location!.toLowerCase().trim();\n                  \n                  // Try direct match first\n                  markerPosition = cityCoordinates[locationName];\n                  \n                  // If not found, try alternate lookups (partial matches)\n                  if (!markerPosition) {\n                    // Look for substring matches\n                    for (const [city, coords] of Object.entries(cityCoordinates)) {\n                      if (locationName.includes(city) || city.includes(locationName)) {\n                        markerPosition = coords;\n                        console.log(`Found partial location match for ${locationName}: using ${city} coordinates`);\n                        break;\n                      }\n                    }\n                  }\n                  \n                  if (markerPosition) {\n                    console.log(`Using map coordinates for ${item.name}:`, markerPosition);\n                  }\n                }\n\n                // If still no coordinates, use default position for India\n                if (!markerPosition) {\n                  markerPosition = [20.5937, 78.9629]; // Center of India as fallback\n                  console.log(`Using default coordinates for ${item.name} at ${item.location}`);\n                }\n\n                return (\n                  <Marker\n                    key={item.id}\n                    position={markerPosition}\n                    icon={createCustomIcon(item.dailyRate)}\n                    eventHandlers={{\n                      click: () => onMarkerClick?.(item)\n                    }}\n                  >\n                    <Popup>\n                      <div className=\"p-3\">\n                        <h3 className=\"font-bold text-lg\">{item.name}</h3>\n                        <p className=\"text-sm text-gray-600 mt-1\">\n                          {item.description}\n                        </p>\n                        <p className=\"text-sm font-semibold mt-2\">\n                          ₹{item.dailyRate}/day\n                        </p>\n                        <div className=\"mt-2\">\n                          <span className={`inline-block px-2 py-1 text-xs font-semibold rounded-full ${\n                            item.availability\n                              ? 'text-green-700 bg-green-100'\n                              : 'text-red-700 bg-red-100'\n                          }`}>\n                            {item.availability ? t('equipment.available') : t('equipment.unavailable')}\n                          </span>\n                        </div>\n                      </div>\n                    </Popup>\n                  </Marker>\n                );\n              })}\n          </MapContainer>\n          <Button\n            variant=\"secondary\"\n            size=\"icon\"\n            className=\"absolute top-4 right-4 z-[400] bg-white/90 shadow-lg hover:bg-white\"\n            onClick={handleLocationClick}\n            disabled={isLocating}\n          >\n            {isLocating ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <Navigation2 className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </div>\n      ) : (\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n          {equipment.map((item, index) => (\n            <Card \n              key={item.id} \n              className=\"p-4 equipment-card shadow-custom animate-slide-up\"\n              style={{ animationDelay: `${index * 0.1}s` }}\n            >\n              <div className=\"aspect-video rounded-md overflow-hidden mb-4 relative\">\n                <img\n                  src={item.imageUrl}\n                  alt={item.name}\n                  className=\"w-full h-full object-cover transition-transform duration-700 hover:scale-110\"\n                />\n                <div className=\"absolute top-2 right-2\">\n                  <span className={`px-2 py-1 text-xs font-semibold rounded-full ${\n                    item.availability\n                      ? 'text-green-700 bg-green-100'\n                      : 'text-red-700 bg-red-100'\n                  } ${item.availability ? 'animate-pulse-soft' : ''}`}>\n                    {item.availability ? t('equipment.available') : t('equipment.unavailable')}\n                  </span>\n                </div>\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2\">{item.name}</h3>\n              <p className=\"text-sm text-muted-foreground mb-3\">\n                {item.description}\n              </p>\n              <div className=\"flex items-center justify-between mb-4\">\n                <span className=\"font-bold text-primary text-lg\">₹{new Intl.NumberFormat('hi-IN').format(item.dailyRate)}/day</span>\n              </div>\n              <Button\n                className=\"w-full mt-2 transition-all duration-300 bg-primary hover:bg-primary/90\"\n                onClick={() => onMarkerClick?.(item)}\n              >\n                {t('equipment.viewDetails')}\n              </Button>\n            </Card>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":14792},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/main-nav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Button } from \"@/components/ui/button\";\nimport { LanguageSwitcher } from \"@/components/language-switcher\";\nimport { useTranslation } from \"react-i18next\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useForm } from \"react-hook-form\";\nimport {\n  Menu,\n  Search,\n  ShoppingCart,\n  Tractor,\n  User,\n  Plus,\n  Loader2,\n  ChevronDown,\n  ImagePlus,\n  ScrollText,\n  Scale,\n  ArrowLeft,\n  MessageCircle,\n  Phone\n} from \"lucide-react\";\nimport { z } from \"zod\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { UpdateProfile } from \"@shared/schema\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nconst profileSchema = z.object({\n  name: z.string().min(1, \"Name is required\"),\n  contact: z.string().optional(),\n  imageUrl: z.string().optional(),\n});\n\nconst equipmentSchema = z.object({\n  name: z.string().min(1, \"Name is required\"),\n  category: z.string().min(1, \"Category is required\"),\n  description: z.string().min(10, \"Description must be at least 10 characters\"),\n  dailyRate: z.coerce.number().min(1, \"Daily rate must be at least ₹1\"),\n  location: z.string().min(1, \"Location is required\"),\n  imageUrl: z.string().optional(),\n});\n\ntype ProfileFormData = z.infer<typeof profileSchema>;\ntype EquipmentFormData = z.infer<typeof equipmentSchema>;\n\nconst categories = [\n  { id: \"tractors\", labelKey: \"categories.tractors\" },\n  { id: \"harvesters\", labelKey: \"categories.harvesters\" },\n  { id: \"irrigation\", labelKey: \"categories.irrigation\" },\n  { id: \"seeders\", labelKey: \"categories.seeders\" },\n  { id: \"sprayers\", labelKey: \"categories.sprayers\" },\n];\n\nexport function MainNav() {\n  const { user, logoutMutation } = useAuth();\n  const { t } = useTranslation();\n  const [isProfileOpen, setIsProfileOpen] = useState(false);\n  const [isPostEquipmentOpen, setIsPostEquipmentOpen] = useState(false);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { toast } = useToast();\n  const [location, setLocation] = useLocation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [previewImage, setPreviewImage] = useState<string | null>(null);\n  const [imageKey, setImageKey] = useState(0);\n  const [avatarKey, setAvatarKey] = useState(Date.now());\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: UpdateProfile) => {\n      const res = await apiRequest(\"/api/user/profile\", \"PATCH\", data);\n      if (!res.ok) {\n        throw new Error(\"Failed to update profile\");\n      }\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.setQueryData([\"/api/user\"], data);\n      toast({\n        title: t('profile.updateSuccess', 'Profile Updated'),\n        description: t('profile.updateSuccessDesc', 'Your profile has been updated successfully'),\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: t('common.error', 'Error'),\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  useEffect(() => {\n    if (user) {\n      console.log('User data changed, updating avatar key');\n      setAvatarKey(Date.now() + Math.random());\n    }\n  }, [user]);\n\n  useEffect(() => {\n    if (user?.imageUrl) {\n      console.log('Image URL changed, forcing avatar update');\n      setAvatarKey(Date.now() + Math.random());\n    }\n  }, [user?.imageUrl]);\n\n  const profileForm = useForm<ProfileFormData>({\n    resolver: zodResolver(profileSchema),\n    defaultValues: {\n      name: user?.name || \"\",\n      contact: user?.contact || \"\",\n      imageUrl: user?.imageUrl || \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (user) {\n      profileForm.reset({\n        name: user.name || \"\",\n        contact: user.contact || \"\",\n        imageUrl: user.imageUrl || \"\",\n      });\n    }\n  }, [user, profileForm]);\n\n  async function onProfileSubmit(data: ProfileFormData) {\n    try {\n      await updateProfileMutation.mutateAsync(data);\n      setIsProfileOpen(false);\n      setAvatarKey(Date.now() + Math.random());\n      toast({\n        title: t('profile.updateSuccess', 'Profile Updated'),\n        description: t('profile.updateSuccessDesc', 'Your profile has been updated successfully'),\n      });\n    } catch (error) {\n      toast({\n        title: t('common.error', 'Error'),\n        description: t('profile.errorOccurred', 'An error occurred while updating your profile'),\n        variant: \"destructive\",\n      });\n    }\n  }\n\n  async function onEquipmentSubmit(data: EquipmentFormData) {\n    try {\n      setIsSubmitting(true);\n      const formData = new FormData();\n\n      Object.entries(data).forEach(([key, value]) => {\n        if (value !== undefined && value !== null) {\n          formData.append(key, value.toString());\n        }\n      });\n\n      const response = await fetch('/api/equipment', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include',\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(errorText || 'Failed to post equipment');\n      }\n\n      setIsPostEquipmentOpen(false);\n      toast({\n        title: t('equipment.createSuccess', 'Equipment Posted'),\n        description: t('equipment.createSuccessDesc', 'Your equipment has been posted successfully'),\n      });\n\n      equipmentForm.reset({\n        name: \"\",\n        category: \"\",\n        description: \"\",\n        dailyRate: 0,\n        location: \"\",\n        imageUrl: \"\",\n      });\n      setLocation('/dashboard');\n\n    } catch (error) {\n      console.error('Equipment submission error:', error);\n      toast({\n        title: t('common.error', 'Error'),\n        description: error instanceof Error ? error.message : t('equipment.createError', 'Failed to post equipment. Please try again.'),\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (searchQuery.trim()) {\n      setLocation(`/equipment?search=${encodeURIComponent(searchQuery.trim())}`);\n    }\n  };\n\n  const handleDialogChange = (open: boolean) => {\n    setIsPostEquipmentOpen(open);\n    if (!open) {\n      equipmentForm.reset({\n        name: \"\",\n        category: \"\",\n        description: \"\",\n        dailyRate: 0,\n        location: \"\",\n        imageUrl: \"\",\n      });\n    }\n  };\n  const equipmentForm = useForm<EquipmentFormData>({\n    resolver: zodResolver(equipmentSchema),\n    defaultValues: {\n      name: \"\",\n      category: \"\",\n      description: \"\",\n      dailyRate: 0,\n      location: \"\",\n      imageUrl: \"\",\n    },\n  });\n\n  // Handle logout function\n  const handleLogout = async () => {\n    console.log('Initiating logout process');\n    try {\n      await logoutMutation.mutateAsync();\n      console.log('Logout successful, redirecting to auth page');\n      setLocation('/auth');\n    } catch (error) {\n      console.error('Logout failed:', error);\n      toast({\n        title: t('common.error', 'Error'),\n        description: t('auth.logoutError', 'Failed to logout. Please try again.'),\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  return (\n    <nav className=\"border-b bg-green-50/80 sticky top-0 z-50 backdrop-blur-sm shadow-sm\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"flex h-16 items-center justify-between\">\n          <Sheet>\n            <SheetTrigger asChild className=\"md:hidden\">\n              <Button variant=\"ghost\" size=\"icon\" aria-label={t('nav.menu', 'Menu')}>\n                <Menu className=\"h-6 w-6\" />\n              </Button>\n            </SheetTrigger>\n            <SheetContent side=\"left\" className=\"w-[300px]\">\n              <SheetHeader>\n                <SheetTitle>{t('nav.menu', 'Menu')}</SheetTitle>\n              </SheetHeader>\n              <div className=\"flex flex-col gap-4 py-4\">\n                <Link href=\"/equipment\" className=\"flex items-center gap-2 px-2 py-2 rounded-md hover:bg-accent\">\n                  <Tractor className=\"h-5 w-5\" />\n                  {t('nav.equipment', 'Equipment')}\n                </Link>\n                <Link href=\"/compare\" className=\"flex items-center gap-2 px-2 py-2 rounded-md hover:bg-accent\">\n                  <Scale className=\"h-5 w-5\" />\n                  {t('nav.compare', 'Compare Equipment')}\n                </Link>\n                <Link href=\"/dashboard\" className=\"flex items-center gap-2 px-2 py-2 rounded-md hover:bg-accent\">\n                  <ShoppingCart className=\"h-5 w-5\" />\n                  {t('nav.bookings', 'Bookings')}\n                </Link>\n                <Link href=\"/receipts\" className=\"flex items-center gap-2 px-2 py-2 rounded-md hover:bg-accent\">\n                  <ScrollText className=\"h-5 w-5\" />\n                  {t('nav.receipts', 'Receipt History')}\n                </Link>\n                {user?.isAdmin && (\n                  <Link href=\"/admin\" className=\"flex items-center gap-2 px-2 py-2 rounded-md hover:bg-accent\">\n                    <User className=\"h-5 w-5\" />\n                    {t('nav.admin', 'Admin Dashboard')}\n                  </Link>\n                )}\n                <Button\n                  variant=\"outline\"\n                  onClick={handleLogout}\n                  disabled={logoutMutation.isPending}\n                  className=\"w-full mt-2\"\n                >\n                  {logoutMutation.isPending ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  ) : (\n                    t('nav.logout', 'Logout')\n                  )}\n                </Button>\n              </div>\n            </SheetContent>\n          </Sheet>\n\n          <div className=\"flex items-center gap-2\">\n            <Link href=\"/\" className=\"flex items-center gap-2\">\n              <Tractor className=\"h-7 w-7 text-green-600\" />\n              <span className=\"text-2xl font-bold bg-gradient-to-r from-green-700 to-green-500 bg-clip-text text-transparent font-serif tracking-wide\">\n                {t('branding.name', 'KrishiSadhan')}\n              </span>\n            </Link>\n            {location !== \"/\" && (\n              <div className=\"hidden md:flex items-center gap-2 text-sm text-muted-foreground\">\n                <ArrowLeft className=\"h-4 w-4\" />\n                <Button variant=\"ghost\" size=\"sm\" asChild>\n                  <Link href=\"/\">\n                    {t('nav.backToHome', 'Back to Home')}\n                  </Link>\n                </Button>\n              </div>\n            )}\n          </div>\n\n          <div className=\"hidden md:flex flex-1 items-center justify-center px-8 gap-4\">\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"ghost\" className=\"gap-1\">\n                  {t('nav.categories', 'Categories')}\n                  <ChevronDown className=\"h-4 w-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"center\">\n                {categories.map((category) => (\n                  <DropdownMenuItem key={category.id} asChild>\n                    <Link href={`/equipment?category=${category.id}`} className=\"w-full\">\n                      {t(category.labelKey)}\n                    </Link>\n                  </DropdownMenuItem>\n                ))}\n              </DropdownMenuContent>\n            </DropdownMenu>\n\n            <form onSubmit={handleSearch} className=\"flex-1 mx-4\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n                <Input\n                  type=\"search\"\n                  placeholder={t('search.placeholder', 'Search farming equipment...')}\n                  className=\"w-full pl-10 pr-4\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  aria-label={t('search.label', 'Search equipment')}\n                />\n              </div>\n            </form>\n\n            <Button variant=\"ghost\" asChild>\n              <Link href=\"/compare\" className=\"flex items-center gap-2\">\n                <Scale className=\"h-5 w-5\" />\n                {t('nav.compare', 'Compare')}\n              </Link>\n            </Button>\n          </div>\n\n          <div className=\"flex items-center gap-4\">\n            <LanguageSwitcher />\n\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => {\n                const phoneNumber = \"917385688905\";\n                const message = \"Hello! I need help with farm equipment rental. Can you assist me?\";\n                const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;\n                window.open(whatsappUrl, '_blank');\n              }}\n              aria-label=\"Contact us on WhatsApp\"\n              title=\"Contact Support - 7385688905\"\n            >\n              <Phone className=\"h-5 w-5\" />\n            </Button>\n\n            <Link href=\"/dashboard\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                aria-label={t('nav.bookings', 'Your Bookings')}\n              >\n                <ShoppingCart className=\"h-5 w-5\" />\n              </Button>\n            </Link>\n\n            <Link href=\"/receipts\">\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                aria-label={t('nav.receipts', 'Receipt History')}\n              >\n                <ScrollText className=\"h-5 w-5\" />\n              </Button>\n            </Link>\n\n            <Dialog open={isProfileOpen} onOpenChange={setIsProfileOpen}>\n              <DialogTrigger asChild>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"relative h-8 w-8 rounded-full navbar-avatar\"\n                  aria-label={t('profile.manage', 'Manage Profile')}\n                >\n                  <Avatar className=\"h-8 w-8\">\n                    <AvatarImage\n                      className=\"navbar-avatar\"\n                      key={`avatar-${avatarKey}`}\n                      src={user?.imageUrl ? `${user.imageUrl}?v=${avatarKey}` : '/default-avatar.png'}\n                      alt={user?.name}\n                    />\n                    <AvatarFallback>\n                      <User className=\"h-4 w-4\" />\n                    </AvatarFallback>\n                  </Avatar>\n                </Button>\n              </DialogTrigger>\n              <DialogContent>\n                <DialogHeader>\n                  <DialogTitle>{t('profile.edit', 'Edit Profile')}</DialogTitle>\n                  <DialogDescription>\n                    {t('profile.editDesc', 'Update your profile information below.')}\n                  </DialogDescription>\n                </DialogHeader>\n                <Form {...profileForm}>\n                  <form onSubmit={profileForm.handleSubmit(onProfileSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={profileForm.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('profile.name', 'Name')}</FormLabel>\n                          <FormControl>\n                            <Input {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={profileForm.control}\n                      name=\"contact\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('profile.contact', 'Contact')}</FormLabel>\n                          <FormControl>\n                            <Input {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={profileForm.control}\n                      name=\"imageUrl\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('profile.image', 'Profile Image')}</FormLabel>\n                          <FormControl>\n                            <div className=\"flex flex-col gap-4\">\n                              {(field.value || previewImage) && (\n                                <div className=\"relative w-32 h-32 mx-auto\">\n                                  <img\n                                    key={`profile-preview-${avatarKey}`}\n                                    src={previewImage || `${field.value}?v=${avatarKey}`}\n                                    alt=\"Profile preview\"\n                                    className=\"w-full h-full object-cover rounded-full\"\n                                  />\n                                </div>\n                              )}\n                              <div className=\"flex items-center gap-4\">\n                                <Input\n                                  type=\"file\"\n                                  accept=\"image/*\"\n                                  onChange={async (e) => {\n                                    const file = e.target.files?.[0];\n                                    if (file) {\n                                      console.log('File selected, creating preview');\n                                      const preview = URL.createObjectURL(file);\n                                      setPreviewImage(preview);\n\n                                      const formData = new FormData();\n                                      formData.append('image', file);\n                                      try {\n                                        console.log('Uploading profile image');\n                                        const res = await fetch('/api/user/profile/image', {\n                                          method: 'POST',\n                                          credentials: 'include',\n                                          body: formData\n                                        });\n                                        if (!res.ok) {\n                                          throw new Error('Failed to upload profile image');\n                                        }\n                                        const data = await res.json();\n                                        console.log('Profile image uploaded successfully');\n                                        field.onChange(data.imageUrl);\n                                        setAvatarKey(Date.now() + Math.random());\n                                        setPreviewImage(null);\n\n                                        await updateProfileMutation.mutateAsync({\n                                          ...profileForm.getValues(),\n                                          imageUrl: data.imageUrl\n                                        });\n\n                                        toast({\n                                          title: t('common.success', 'Success'),\n                                          description: t('profile.imageUploadSuccess', 'Profile image uploaded successfully'),\n                                        });\n                                      } catch (error) {\n                                        console.error('Profile image upload error:', error);\n                                        setPreviewImage(null);\n                                        toast({\n                                          title: t('common.error', 'Error'),\n                                          description: t('profile.imageUploadError', 'Failed to upload profile image'),\n                                          variant: \"destructive\",\n                                        });\n                                      }\n                                    }\n                                  }}\n                                />\n                                <ImagePlus className=\"h-5 w-5 text-muted-foreground\" />\n                              </div>\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <Button\n                      type=\"submit\"\n                      className=\"w-full\"\n                      disabled={updateProfileMutation.isPending}\n                    >\n                      {updateProfileMutation.isPending && (\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      )}\n                      {t('profile.save', 'Save Changes')}\n                    </Button>\n                  </form>\n                </Form>\n              </DialogContent>\n            </Dialog>\n\n            <Button\n              variant=\"outline\"\n              onClick={handleLogout}\n              disabled={logoutMutation.isPending}\n              className=\"hidden sm:flex\"\n            >\n              {logoutMutation.isPending ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                t('nav.logout', 'Logout')\n              )}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </nav>\n  );\n}","size_bytes":22220},"client/src/types/razorpay.d.ts":{"content":"interface RazorpayOptions {\n  key: string;\n  amount: number;\n  currency: string;\n  name: string;\n  description: string;\n  order_id: string;\n  prefill: {\n    name?: string;\n    email?: string;\n    contact?: string;\n  };\n  modal?: {\n    ondismiss?: () => void;\n    escape?: boolean;\n  };\n  theme?: {\n    color?: string;\n  };\n  handler: (response: RazorpayResponse) => void;\n}\n\ninterface RazorpayResponse {\n  razorpay_payment_id: string;\n  razorpay_order_id: string;\n  razorpay_signature: string;\n}\n\ninterface RazorpayError {\n  code: string;\n  description: string;\n  source: string;\n  step: string;\n  reason: string;\n}\n\ninterface RazorpayInstance {\n  on(event: string, handler: (response: { error: RazorpayError }) => void): void;\n  open(): void;\n}\n\ninterface RazorpayStatic {\n  new (options: RazorpayOptions): RazorpayInstance;\n}\n\ninterface Window {\n  Razorpay: RazorpayStatic;\n}\n","size_bytes":878},"client/src/components/ui/select.tsx":{"content":"import * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5615},"server/auth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport { Express } from \"express\";\nimport session from \"express-session\";\nimport { scrypt, randomBytes, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\nimport { storage } from \"./storage\";\nimport { User as SelectUser, insertUserSchema } from \"@shared/schema\";\nimport nodemailer from \"nodemailer\";\nimport { z } from \"zod\";\nimport { fromZodError } from \"zod-validation-error\";\n\ndeclare global {\n  namespace Express {\n    interface User extends SelectUser {}\n  }\n}\n\nconst scryptAsync = promisify(scrypt);\n\nasync function hashPassword(password: string) {\n  const salt = randomBytes(16).toString(\"hex\");\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString(\"hex\")}.${salt}`;\n}\n\nasync function comparePasswords(supplied: string, stored: string) {\n  const [hashed, salt] = stored.split(\".\");\n  const hashedBuf = Buffer.from(hashed, \"hex\");\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}\n\nconst forgotPasswordSchema = z.object({\n  email: z.string().email(\"Invalid email format\"),\n});\n\nexport function setupAuth(app: Express) {\n  const sessionSettings: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET!,\n    resave: false,\n    saveUninitialized: false,\n    store: storage.sessionStore,\n    cookie: {\n      secure: false, // Set to false in development\n      httpOnly: true,\n      maxAge: 24 * 60 * 60 * 1000, // 24 hours\n    },\n  };\n\n  if (app.get(\"env\") === \"production\") {\n    app.set(\"trust proxy\", 1);\n  }\n\n  app.use(session(sessionSettings));\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  passport.use(\n    new LocalStrategy(async (username, password, done) => {\n      try {\n        const user = await storage.getUserByUsername(username);\n        if (!user || !(await comparePasswords(password, user.password))) {\n          console.log(\"Login failed for username:\", username);\n          return done(null, false);\n        }\n        console.log(\"Login successful for user:\", user.id);\n        return done(null, user);\n      } catch (error) {\n        console.error(\"Login error:\", error);\n        return done(error);\n      }\n    }),\n  );\n\n  passport.serializeUser((user, done) => {\n    console.log(\"Serializing user:\", user.id);\n    done(null, user.id);\n  });\n\n  passport.deserializeUser(async (id: number, done) => {\n    try {\n      const user = await storage.getUser(id);\n      if (!user) {\n        console.log(\"User not found during deserialization:\", id);\n        return done(null, false);\n      }\n      console.log(\"Deserialized user:\", id);\n      done(null, user);\n    } catch (error) {\n      console.error(\"Deserialization error:\", error);\n      done(error);\n    }\n  });\n\n  app.post(\"/api/register\", async (req, res, next) => {\n    try {\n      // Validate request body against schema\n      const validatedData = insertUserSchema.parse(req.body);\n\n      // Check for existing user\n      const existingUser = await storage.getUserByUsername(validatedData.username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already exists\" });\n      }\n\n      // Create user with hashed password\n      const user = await storage.createUser({\n        ...validatedData,\n        password: await hashPassword(validatedData.password),\n      });\n\n      req.login(user, (err) => {\n        if (err) return next(err);\n        console.log(\"New user registered and logged in:\", user.id);\n        res.status(201).json(user);\n      });\n    } catch (error) {\n      console.error(\"Registration error:\", error);\n      if (error instanceof z.ZodError) {\n        const readableError = fromZodError(error);\n        return res.status(400).json({\n          message: \"Validation failed\",\n          errors: readableError.details.map(detail => ({\n            path: detail.path,\n            message: detail.message\n          }))\n        });\n      }\n      next(error);\n    }\n  });\n\n  app.post(\"/api/login\", passport.authenticate(\"local\"), (req, res) => {\n    console.log(\"Login successful, sending user data\");\n    res.status(200).json(req.user);\n  });\n\n  app.post(\"/api/logout\", (req, res, next) => {\n    if (!req.isAuthenticated()) {\n      return res.sendStatus(200);\n    }\n\n    const userId = req.user?.id;\n    req.logout((err) => {\n      if (err) {\n        console.error(\"Logout error:\", err);\n        return next(err);\n      }\n\n      req.session.destroy((err) => {\n        if (err) {\n          console.error(\"Session destruction error:\", err);\n          return next(err);\n        }\n\n        console.log(\"User logged out successfully:\", userId);\n        res.clearCookie('connect.sid');\n        res.sendStatus(200);\n      });\n    });\n  });\n\n  app.get(\"/api/user\", (req, res) => {\n    if (!req.isAuthenticated()) {\n      return res.sendStatus(401);\n    }\n    res.json(req.user);\n  });\n\n  // Add forgot password endpoint\n  app.post(\"/api/auth/forgot-password\", async (req, res) => {\n    try {\n      const { email } = forgotPasswordSchema.parse(req.body);\n      console.log(\"Forgot password request received for email:\", email);\n\n      // For security, don't reveal if the email exists or not\n      res.json({ \n        message: \"If an account exists with this email, you will receive password reset instructions.\" \n      });\n\n      // In a real implementation, you would:\n      // 1. Find user by email\n      // 2. Generate a reset token\n      // 3. Save the token and its expiration\n      // 4. Send an email with the reset link\n\n      console.log(\"Forgot password request processed for:\", email);\n    } catch (error) {\n      console.error(\"Forgot password error:\", error);\n      res.status(400).json({ \n        message: \"Invalid request\",\n        error: error instanceof Error ? error.message : \"Unknown error\" \n      });\n    }\n  });\n}\n","size_bytes":5900},"server/storage.ts":{"content":"import { Pool as PgPool } from 'pg';\nimport { users, equipment as equipmentTable, bookings, reviews, comparisons, recommendations, receipts, type User, type InsertUser, type Equipment, type InsertEquipment, type Booking, type InsertBooking, type UpdateProfile, type Review, type InsertReview, type Recommendation, type InsertRecommendation, type Receipt, type InsertReceipt } from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, gte, lte, or, desc } from \"drizzle-orm\";\nimport session from \"express-session\";\nimport connectPg from \"connect-pg-simple\";\nimport { pool } from \"./db\";\nimport { sql } from \"drizzle-orm\";\n\nconst PostgresSessionStore = connectPg(session);\n\nexport interface IStorage {\n  // User operations\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: number, data: Partial<UpdateProfile>): Promise<User>;\n\n  // Equipment operations\n  getEquipment(id: number): Promise<Equipment | undefined>;\n  listEquipment(): Promise<Equipment[]>;\n  listEquipmentByOwner(ownerId: number): Promise<Equipment[]>;\n  createEquipment(equipment: InsertEquipment): Promise<Equipment>;\n  deleteEquipment(id: number): Promise<void>;\n  updateEquipment(id: number, data: Partial<InsertEquipment> & { popularity?: number }): Promise<Equipment>;\n\n  // Booking operations\n  getBooking(id: number): Promise<Booking | undefined>;\n  findBookingByRazorpayOrderId(orderId: string): Promise<Booking | undefined>;\n  listBookings(userId?: number): Promise<Booking[]>;\n  createBooking(booking: InsertBooking): Promise<Booking>;\n  updateBookingStatus(id: number, status: string): Promise<Booking>;\n  updateBooking(id: number, data: Partial<Booking>): Promise<Booking>;\n  getBookingsByStatus(status: string): Promise<Booking[]>;\n  getBookingsByDateRange(equipmentId: number, startDate: Date, endDate: Date): Promise<Booking[]>;\n  checkEquipmentAvailability(equipmentId: number, startDate: Date, endDate: Date): Promise<boolean>;\n  deleteEquipmentBookings(equipmentId: number): Promise<void>;  \n\n  // Review operations\n  createReview(review: InsertReview): Promise<Review>;\n  getReviewsByEquipment(equipmentId: number): Promise<Review[]>;\n  getAverageRating(equipmentId: number): Promise<number>;\n\n  // Comparison operations\n  addToComparison(userId: number, equipmentId: number): Promise<void>;\n  removeFromComparison(userId: number, equipmentId: number): Promise<void>;\n  getComparison(userId: number): Promise<Equipment[]>;\n\n  // Add recommendation operations\n  createRecommendation(recommendation: InsertRecommendation): Promise<Recommendation>;\n  getRecommendationsForUser(userId: number): Promise<Recommendation[]>;\n\n  // Receipt operations\n  createReceipt(receipt: InsertReceipt): Promise<Receipt>;\n  getReceipt(id: number): Promise<Receipt | undefined>;\n  listReceipts(userId: number): Promise<Receipt[]>;\n  getReceiptByBookingId(bookingId: number): Promise<Receipt | undefined>; // Added method\n\n  sessionStore: session.Store;\n\n  // Add new search methods\n  searchEquipment(params: {\n    query?: string;\n    category?: string;\n    minPrice?: number;\n    maxPrice?: number;\n    location?: string;\n    radius?: number;\n    specifications?: Record<string, any>;\n    season?: 'spring' | 'summer' | 'autumn' | 'winter';\n    availability?: boolean;\n  }): Promise<Equipment[]>;\n\n  getEquipmentBySpecification(specKey: string, value: string | number): Promise<Equipment[]>;\n  getEquipmentInRadius(lat: number, lng: number, radiusKm: number): Promise<Equipment[]>;\n  calculateEquipmentPopularity(equipmentId: number): Promise<number>;\n  listEquipmentReviews(equipmentId: number): Promise<Review[]>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  public sessionStore!: session.Store;\n\n  constructor() {\n    // Session store will be initialized in init()\n  }\n\n  async init() {\n    const maxRetries = 5;\n    const retryDelay = 5000; // 5 seconds\n    let retries = maxRetries;\n\n    while (retries > 0) {\n      try {\n        // Test database connection\n        await pool.query('SELECT NOW()');\n        console.log('Database connection verified successfully');\n\n        // Initialize session store with the correct pool type\n        this.sessionStore = new PostgresSessionStore({\n          pool: pool as unknown as PgPool,\n          tableName: 'session',\n          createTableIfMissing: true,\n          pruneSessionInterval: 60\n        });\n\n        console.log('Session store initialized successfully');\n        return;\n      } catch (error) {\n        console.error(`Database initialization attempt failed (${retries} retries left):`, error);\n        retries--;\n\n        if (retries > 0) {\n          console.log(`Retrying in ${retryDelay/1000} seconds...`);\n          await new Promise(resolve => setTimeout(resolve, retryDelay));\n        } else {\n          console.error('All database initialization attempts failed');\n        }\n      }\n    }\n  }\n\n  async getUser(id: number): Promise<User | undefined> {\n    try {\n        const [user] = await db.select().from(users).where(eq(users.id, id));\n        return user;\n    } catch (error) {\n        console.error('Error in getUser:', error);\n        throw new Error('Failed to fetch user');\n    }\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    try {\n      const [user] = await db.select().from(users).where(eq(users.username, username));\n      return user;\n    } catch (error) {\n      console.error('Error in getUserByUsername:', error);\n      throw new Error('Failed to fetch user by username');\n    }\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    try {\n      const [user] = await db.insert(users).values(insertUser).returning();\n      return user;\n    } catch (error) {\n      console.error('Error in createUser:', error);\n      throw new Error('Failed to create user');\n    }\n  }\n\n  async updateUser(id: number, data: Partial<UpdateProfile>): Promise<User> {\n    try {\n      const [user] = await db\n        .update(users)\n        .set(data)\n        .where(eq(users.id, id))\n        .returning();\n      if (!user) throw new Error('User not found');\n      return user;\n    } catch (error) {\n      console.error('Error in updateUser:', error);\n      throw new Error('Failed to update user');\n    }\n  }\n\n  async getEquipment(id: number): Promise<Equipment | undefined> {\n    try {\n      const [equip] = await db.select().from(equipmentTable).where(eq(equipmentTable.id, id));\n      return equip;\n    } catch (error) {\n      console.error('Error in getEquipment:', error);\n      throw new Error('Failed to fetch equipment');\n    }\n  }\n\n  async listEquipment(): Promise<Equipment[]> {\n    try {\n      console.log('Attempting to list equipment from database...');\n      const equipment = await db\n        .select({\n          id: equipmentTable.id,\n          ownerId: equipmentTable.ownerId,\n          name: equipmentTable.name,\n          description: equipmentTable.description,\n          category: equipmentTable.category,\n          dailyRate: equipmentTable.dailyRate,\n          location: equipmentTable.location,\n          imageUrl: equipmentTable.imageUrl,\n          availability: equipmentTable.availability,\n          specs: equipmentTable.specs,\n          features: equipmentTable.features,\n          seasonalAvailability: equipmentTable.seasonalAvailability,\n          searchableSpecs: equipmentTable.searchableSpecs,\n          createdAt: equipmentTable.createdAt,\n          popularity: equipmentTable.popularity,\n          latitudeCoord: equipmentTable.latitudeCoord,\n          longitudeCoord: equipmentTable.longitudeCoord\n        })\n        .from(equipmentTable)\n        .orderBy(desc(equipmentTable.createdAt));\n\n      console.log('Raw database query result:', equipment);\n\n      // Transform the data to ensure proper parsing of JSON fields\n      const transformedEquipment = equipment.map(item => {\n        try {\n          return {\n            ...item,\n            availability: Boolean(item.availability),\n            specs: this.parseJsonField(item.specs, {}),\n            features: this.parseJsonField(item.features, []),\n            seasonalAvailability: this.parseJsonField(item.seasonalAvailability, {\n              spring: true,\n              summer: true,\n              autumn: true,\n              winter: true\n            }),\n            searchableSpecs: this.parseJsonField(item.searchableSpecs, {})\n          };\n        } catch (parseError) {\n          console.error('Error parsing equipment fields for item:', item.id, parseError);\n          return {\n            ...item,\n            availability: Boolean(item.availability),\n            specs: {},\n            features: [],\n            seasonalAvailability: {\n              spring: true,\n              summer: true,\n              autumn: true,\n              winter: true\n            },\n            searchableSpecs: {}\n          };\n        }\n      });\n\n      console.log('Transformed equipment:', transformedEquipment);\n      return transformedEquipment;\n    } catch (error) {\n      console.error('Error in listEquipment:', error);\n      if (error instanceof Error) {\n        console.error('Error details:', error.message);\n        console.error('Error stack:', error.stack);\n      }\n      throw new Error('Failed to list equipment');\n    }\n  }\n\n  async listEquipmentByOwner(ownerId: number): Promise<Equipment[]> {\n    try {\n      const equipment = await db\n        .select()\n        .from(equipmentTable)\n        .where(eq(equipmentTable.ownerId, ownerId));\n\n      console.log(`Equipment for owner ${ownerId}:`, equipment);\n\n      // Transform the data to ensure proper boolean values\n      const transformedEquipment = equipment.map(item => ({\n        ...item,\n        availability: Boolean(item.availability)\n      }));\n\n      return transformedEquipment;\n    } catch (error) {\n      console.error('Error in listEquipmentByOwner:', error);\n      throw new Error('Failed to list equipment by owner');\n    }\n  }\n\n  async createEquipment(insertEquipment: InsertEquipment): Promise<Equipment> {\n    try {\n      const [equipment] = await db\n        .insert(equipmentTable)\n        .values({\n          ownerId: insertEquipment.ownerId,\n          name: insertEquipment.name,\n          description: insertEquipment.description,\n          category: insertEquipment.category,\n          dailyRate: insertEquipment.dailyRate,\n          location: insertEquipment.location,\n          imageUrl: insertEquipment.imageUrl,\n          specs: insertEquipment.specs ?? {},\n          features: insertEquipment.features ?? [],\n          seasonalAvailability: insertEquipment.seasonalAvailability ?? {\n            spring: true,\n            summer: true,\n            autumn: true,\n            winter: true\n          },\n          searchableSpecs: insertEquipment.searchableSpecs ?? {},\n          availability: true\n        })\n        .returning();\n\n      if (!equipment) {\n        throw new Error('Failed to create equipment record');\n      }\n\n      return {\n        ...equipment,\n        specs: this.parseJsonField(equipment.specs, {}),\n        features: this.parseJsonField(equipment.features, []),\n        seasonalAvailability: this.parseJsonField(equipment.seasonalAvailability, {\n          spring: true,\n          summer: true,\n          autumn: true,\n          winter: true\n        }),\n        searchableSpecs: this.parseJsonField(equipment.searchableSpecs, {})\n      };\n    } catch (error) {\n      console.error('Error in createEquipment:', error);\n      throw new Error('Failed to create equipment');\n    }\n  }\n\n  async updateEquipment(id: number, data: Partial<InsertEquipment> & { popularity?: number }): Promise<Equipment> {\n    try {\n      // Ensure JSON fields are properly handled\n      const updateData = {\n        ...data,\n        specs: data.specs ? data.specs : undefined,\n        features: Array.isArray(data.features) ? data.features : undefined,\n        seasonalAvailability: data.seasonalAvailability ? data.seasonalAvailability : undefined,\n        searchableSpecs: data.searchableSpecs ? data.searchableSpecs : undefined\n      };\n\n      const [equipment] = await db\n        .update(equipmentTable)\n        .set(updateData)\n        .where(eq(equipmentTable.id, id))\n        .returning();\n\n      if (!equipment) {\n        throw new Error('Equipment not found');\n      }\n\n      // Transform JSON fields in the response\n      return {\n        ...equipment,\n        specs: this.parseJsonField(equipment.specs, {}),\n        features: this.parseJsonField(equipment.features, []),\n        seasonalAvailability: this.parseJsonField(equipment.seasonalAvailability, {\n          spring: true,\n          summer: true,\n          autumn: true,\n          winter: true\n        }),\n        searchableSpecs: this.parseJsonField(equipment.searchableSpecs, {})\n      };\n    } catch (error) {\n      console.error('Error updating equipment:', error);\n      throw new Error('Failed to update equipment');\n    }\n  }\n\n  async deleteEquipment(id: number): Promise<void> {\n    try {\n      await db.delete(equipmentTable).where(eq(equipmentTable.id, id));\n    } catch (error) {\n      console.error('Error in deleteEquipment:', error);\n      throw new Error('Failed to delete equipment');\n    }\n  }\n\n  async getBooking(id: number): Promise<Booking | undefined> {\n    try {\n      console.log(`Fetching booking with ID: ${id}`);\n      const [booking] = await db.select().from(bookings).where(eq(bookings.id, id));\n\n      if (!booking) {\n        console.log(`No booking found with ID: ${id}`);\n        return undefined;\n      }\n\n      console.log(`Found booking:`, booking);\n      return booking;\n    } catch (error) {\n      console.error('Error in getBooking:', error);\n      throw new Error('Failed to fetch booking');\n    }\n  }\n\n  async findBookingByRazorpayOrderId(orderId: string): Promise<Booking | undefined> {\n    try {\n      const [booking] = await db\n        .select()\n        .from(bookings)\n        .where(eq(bookings.razorpayOrderId, orderId));\n      return booking;\n    } catch (error) {\n      console.error('Error finding booking by Razorpay order ID:', error);\n      throw new Error('Failed to find booking by Razorpay order ID');\n    }\n  }\n\n  async listBookings(userId?: number): Promise<Booking[]> {\n    try {\n      console.log(`Fetching bookings for user: ${userId}`);\n\n      let bookingsQuery;\n      // If userId is provided, filter bookings for that user\n      if (userId) {\n        console.log('Filtering bookings by user ID');\n        bookingsQuery = db\n          .select()\n          .from(bookings)\n          .where(eq(bookings.userId, userId))\n          .orderBy(desc(bookings.createdAt));\n      } else {\n        // Return all bookings for admin users\n        console.log('Fetching all bookings (admin view)');\n        bookingsQuery = db\n          .select()\n          .from(bookings)\n          .orderBy(desc(bookings.createdAt));\n      }\n\n      const result = await bookingsQuery;\n      console.log(`Found ${result.length} bookings:`, result);\n      return result;\n    } catch (error) {\n      console.error('Error listing bookings:', error);\n      if (error instanceof Error) {\n        console.error('Error details:', error.message);\n        console.error('Error stack:', error.stack);\n      }\n      return [];\n    }\n  }\n\n  async createBooking(insertBooking: InsertBooking): Promise<Booking> {\n    try {\n      const [booking] = await db\n        .insert(bookings)\n        .values({\n          ...insertBooking,\n          status: insertBooking.status || 'pending',\n          createdAt: new Date(),\n          lastStatusUpdate: new Date()\n        } as any)\n        .returning();\n      return booking;\n    } catch (error) {\n      console.error('Error in createBooking:', error);\n      throw new Error('Failed to create booking');\n    }\n  }\n\n  async updateBookingStatus(id: number, status: string): Promise<Booking> {\n    try {\n      const [booking] = await db\n        .update(bookings)\n        .set({\n          status,\n          lastStatusUpdate: new Date()\n        })\n        .where(eq(bookings.id, id))\n        .returning();\n      if (!booking) throw new Error('Booking not found');\n      return booking;\n    } catch (error) {\n      console.error('Error in updateBookingStatus:', error);\n      throw new Error('Failed to update booking status');\n    }\n  }\n\n  async updateBooking(id: number, data: Partial<Booking>): Promise<Booking> {\n    try {\n      const [booking] = await db\n        .update(bookings)\n        .set({\n          ...data,\n          lastStatusUpdate: new Date()\n        })\n        .where(eq(bookings.id, id))\n        .returning();\n      if (!booking) throw new Error('Booking not found');\n      return booking;\n    } catch (error) {\n      console.error('Error in updateBooking:', error);\n      throw new Error('Failed to update booking');\n    }\n  }\n\n  async getBookingsByStatus(status: string): Promise<Booking[]> {\n    try {\n      return await db\n        .select()\n        .from(bookings)\n        .where(eq(bookings.status, status));\n    } catch (error) {\n      console.error('Error in getBookingsByStatus:', error);\n      throw new Error('Failed to get bookings by status');\n    }\n  }\n\n  async getBookingsByDateRange(\n    equipmentId: number,\n    startDate: Date,\n    endDate: Date\n  ): Promise<Booking[]> {\n    try {\n      // Parse dates and ensure they are valid Date objects\n      const start = new Date(startDate);\n      const end = new Date(endDate);\n\n      // Validate dates\n      if (isNaN(start.getTime()) || isNaN(end.getTime())) {\n        console.error('Invalid date input:', { startDate, endDate });\n        return [];\n      }\n\n      // Set times to start and end of day in UTC\n      start.setUTCHours(0, 0, 0, 0);\n      end.setUTCHours(23, 59, 59, 999);\n\n      // Query bookings within the date range\n      const bookingsResult = await db\n        .select()\n        .from(bookings)\n        .where(\n          and(\n            eq(bookings.equipmentId, equipmentId),\n            or(\n              // Booking starts within the range\n              and(\n                gte(bookings.startDate, start),\n                lte(bookings.startDate, end)\n              ),\n              // Booking ends within the range\n              and(\n                gte(bookings.endDate, start),\n                lte(bookings.endDate, end)\n              ),\n              // Booking spans the entire range\n              and(\n                lte(bookings.startDate, start),\n                gte(bookings.endDate, end)\n              )\n            )\n          )\n        );\n\n      return bookingsResult.map(booking => ({\n        ...booking,\n        startDate: new Date(booking.startDate),\n        endDate: new Date(booking.endDate)\n      }));\n    } catch (error) {\n      console.error('Error in getBookingsByDateRange:', error);\n      return [];\n    }\n  }\n\n  // Add a new method to check equipment availability directly\n  async checkEquipmentAvailability(\n    equipmentId: number, \n    startDate: Date, \n    endDate: Date\n  ): Promise<boolean> {\n    try {\n      // First check if equipment exists and is generally available\n      const equipment = await this.getEquipment(equipmentId);\n      if (!equipment || !equipment.availability) {\n        return false;\n      }\n\n      // Then check for any conflicting bookings\n      const existingBookings = await this.getBookingsByDateRange(equipmentId, startDate, endDate);\n      const hasConflictingBooking = existingBookings.some(booking => \n        booking.status === 'paid' || booking.status === 'awaiting_payment'\n      );\n\n      return !hasConflictingBooking;\n    } catch (error) {\n      console.error('Error checking equipment availability:', error);\n      throw new Error('Failed to check equipment availability');\n    }\n  }\n\n  async deleteEquipmentBookings(equipmentId: number): Promise<void> {\n    try {\n      await db.delete(bookings).where(eq(bookings.equipmentId, equipmentId));\n      console.log(`Successfully deleted all bookings for equipment ${equipmentId}`);\n    } catch (error) {\n      console.error('Error deleting equipment bookings:', error);\n      throw new Error('Failed to delete equipment bookings');\n    }\n  }\n\n  async createReview(review: InsertReview): Promise<Review> {\n    try {\n      const reviewData = {\n        userId: review.userId,\n        equipmentId: review.equipmentId,\n        rating: review.rating,\n        comment: review.comment,\n        createdAt: new Date()\n      };\n\n      const [newReview] = await db\n        .insert(reviews)\n        .values(reviewData)\n        .returning();\n\n      return newReview;\n    } catch (error) {\n      console.error('Error creating review:', error);\n      throw new Error('Failed to create review');\n    }\n  }\n\n  async getReviewsByEquipment(equipmentId: number): Promise<Review[]> {\n    try {\n      const results = await db\n        .select()\n        .from(reviews)\n        .where(eq(reviews.equipmentId, equipmentId));\n\n      return results;\n    } catch (error) {\n      console.error('Error in getReviewsByEquipment:', error);\n      throw new Error('Failed to get reviews by equipment');\n    }\n  }\n\n  async getAverageRating(equipmentId: number): Promise<number> {\n    try {\n      const result = await db\n        .select({\n          average: sql<number>`COALESCE(AVG(${reviews.rating})::numeric(10,1), 0)`\n        })\n        .from(reviews)\n        .where(eq(reviews.equipmentId, equipmentId));\n      return result[0]?.average || 0;\n    } catch (error) {\n      console.error('Error in getAverageRating:', error);\n      throw new Error('Failed to get average rating');\n    }\n  }\n\n  async addToComparison(userId: number, equipmentId: number): Promise<void> {\n    try {\n      const [existingComparison] = await db\n        .select()\n        .from(comparisons)\n        .where(eq(comparisons.userId, userId));\n\n      if (existingComparison) {\n        const equipmentIds = existingComparison.equipmentIds || [];\n        if (!equipmentIds.includes(equipmentId)) {\n          await db\n            .update(comparisons)\n            .set({\n              equipmentIds: [...equipmentIds, equipmentId],\n            })\n            .where(eq(comparisons.userId, userId));\n        }\n      } else {\n        await db\n          .insert(comparisons)\n          .values({\n            userId,\n            equipmentIds: [equipmentId],\n            createdAt: new Date()\n          });\n      }\n    } catch (error) {\n      console.error('Error in addToComparison:', error);\n      throw new Error('Failed to add to comparison');\n    }\n  }\n\n  async removeFromComparison(userId: number, equipmentId: number): Promise<void> {\n    try {\n      const [comparison] = await db\n        .select()\n        .from(comparisons)\n        .where(eq(comparisons.userId, userId));\n\n      if (comparison) {\n        const equipmentIds = comparison.equipmentIds.filter(id => id !== equipmentId);\n        await db\n          .update(comparisons)\n          .set({ equipmentIds })\n          .where(eq(comparisons.userId, userId));\n      }\n    } catch (error) {\n      console.error('Error in removeFromComparison:', error);\n      throw new Error('Failed to remove from comparison');\n    }\n  }\n\n  async getComparison(userId: number): Promise<Equipment[]> {\n    try {\n      const [comparison] = await db\n        .select()\n        .from(comparisons)\n        .where(eq(comparisons.userId, userId));\n\n      if (!comparison) return [];\n\n      return await db\n        .select()\n        .from(equipmentTable)\n        .where(sql`${equipmentTable.id} = ANY(${comparison.equipmentIds})`);\n    } catch (error) {\n      console.error('Error in getComparison:', error);\n      throw new Error('Failed to get comparison');\n    }\n  }\n\n  async createRecommendation(insertRecommendation: InsertRecommendation): Promise<Recommendation> {\n    try {\n      const [recommendation] = await db\n        .insert(recommendations)\n        .values({\n          ...insertRecommendation,\n          createdAt: new Date()\n        })\n        .returning();\n\n      return recommendation;\n    } catch (error) {\n      console.error('Error creating recommendation:', error);\n      throw new Error('Failed to create recommendation');\n    }\n  }\n\n  async getRecommendationsForUser(userId: number): Promise<Recommendation[]> {\n    try {\n      const userRecommendations = await db\n        .select()\n        .from(recommendations)\n        .where(eq(recommendations.userId, userId))\n        .orderBy(desc(recommendations.createdAt));\n\n      return userRecommendations;\n    } catch (error) {\n      console.error('Error fetching recommendations:', error);\n      throw new Error('Failed to fetch recommendations');\n    }\n  }\n\n  async createReceipt(receiptData: InsertReceipt): Promise<Receipt> {\n    try {\n      const [newReceipt] = await db\n        .insert(receipts)\n        .values({\n          ...receiptData,\n          generatedAt: new Date(),\n          metadata: receiptData.metadata || {}\n        })\n        .returning();\n\n      return newReceipt;\n    } catch (error) {\n      console.error('Error creating receipt:', error);\n      throw new Error('Failed to create receipt');\n    }\n  }\n\n  async getReceipt(id: number): Promise<Receipt | undefined> {\n    try {\n      const [receipt] = await db\n        .select()\n        .from(receipts)\n        .where(eq(receipts.id, id));\n\n      return receipt;\n    } catch (error) {\n      console.error('Error fetching receipt:', error);\n      throw new Error('Failed to fetch receipt');\n    }\n  }\n\n  async listReceipts(userId: number): Promise<Receipt[]> {\n    try {\n      const userReceipts = await db\n        .select()\n        .from(receipts)\n        .where(eq(receipts.userId, userId))\n        .orderBy(desc(receipts.generatedAt));\n\n      return userReceipts;\n    } catch (error) {\n      console.error('Error listing receipts:', error);\n      throw new Error('Failed to list receipts');\n    }\n  }\n\n  async getReceiptByBookingId(bookingId: number): Promise<Receipt | undefined> {\n    try {\n      const [receipt] = await db\n        .select()\n        .from(receipts)\n        .where(eq(receipts.bookingId, bookingId));\n\n      return receipt;\n    } catch (error) {\n      console.error('Error fetching receipt by booking ID:', error);\n      throw new Error('Failed to fetch receipt by booking ID');\n    }\n  }\n\n  async searchEquipment(params: {\n    query?: string;\n    category?: string;\n    minPrice?: number;\n    maxPrice?: number;\n    location?: string;\n    radius?: number;\n    specifications?: Record<string, any>;\n    season?: 'spring' | 'summer' | 'autumn' | 'winter';\n    availability?: boolean;\n  }): Promise<Equipment[]> {\n    try {\n      const conditions = [];\n\n      if (params.query) {\n        conditions.push(\n          or(\n            sql`${equipmentTable.name} ILIKE ${`%${params.query}%`}`,\n            sql`${equipmentTable.description} ILIKE ${`%${params.query}%`}`\n          )\n        );\n      }\n\n      if (params.category && params.category !== 'all') {\n        conditions.push(eq(equipmentTable.category, params.category));\n      }\n\n      if (params.minPrice !== undefined) {\n        conditions.push(gte(equipmentTable.dailyRate, params.minPrice));\n      }\n\n      if (params.maxPrice !== undefined) {\n        conditions.push(lte(equipmentTable.dailyRate, params.maxPrice));\n      }\n\n      if (params.location) {\n        conditions.push(sql`${equipmentTable.location} ILIKE ${`%${params.location}%`}`);\n      }\n\n      if (params.availability !== undefined) {\n        conditions.push(eq(equipmentTable.availability, params.availability));\n      }\n\n      if (params.season) {\n        conditions.push(\n          sql`${equipmentTable.seasonalAvailability}->>'${params.season}' = 'true'`\n        );\n      }\n\n      const query = conditions.length > 0\n        ? db.select().from(equipmentTable).where(and(...conditions))\n        : db.select().from(equipmentTable);\n\n      const results = await query.orderBy(desc(equipmentTable.createdAt));\n\n      return results.map(equipment => ({\n        ...equipment,\n        availability: Boolean(equipment.availability),\n        specs: this.parseJsonField(equipment.specs, {}),\n        features: this.parseJsonField(equipment.features, []),\n        seasonalAvailability: this.parseJsonField(equipment.seasonalAvailability, {\n          spring: true,\n          summer: true,\n          autumn: true,\n          winter: true\n        }),\n        searchableSpecs: this.parseJsonField(equipment.searchableSpecs, {})\n      }));\n    } catch (error) {\n      console.error('Error in searchEquipment:', error);\n      if (error instanceof Error) {\n        console.error('Error details:', error.message);\n        console.error('Error stack:', error.stack);\n      }\n      throw new Error('Failed to search equipment');\n    }\n  }\n\n  async getEquipmentBySpecification(specKey: string, value: string | number): Promise<Equipment[]> {\n    try {\n      const results = await db\n        .select()\n        .from(equipmentTable)\n        .where(\n          sql`${equipmentTable.searchableSpecs}->>'${specKey}' = ${value.toString()}`\n        );\n\n      return results.map(equipment => ({\n        ...equipment,\n        availability: Boolean(equipment.availability)\n      }));\n    } catch (error) {\n      console.error('Error in getEquipmentBySpecification:', error);\n      throw new Error('Failed to get equipment by specification');\n    }\n  }\n\n  async getEquipmentInRadius(lat: number, lng: number, radiusKm: number): Promise<Equipment[]> {\n    try {\n      // Using PostgreSQL's earthdistance extension for location-based search\n      const { rows } = await pool.query(`\n        SELECT *\n        FROM equipment\n        WHERE point(${lng}, ${lat}) <@> point(NULLIF(longitude_coord, '')::float8, NULLIF(latitude_coord, '')::float8) <= ${radiusKm}\n      `);\n\n      return rows.map(equipment => ({\n        ...equipment,\n        availability: Boolean(equipment.availability)\n      }));\n    } catch (error) {\n      console.error('Error in getEquipmentInRadius:', error);\n      throw new Error('Failed to get equipment in radius');\n    }\n  }\n\n  // Helper method to safely parse JSON fields\n  private parseJsonField(field: any, defaultValue: any): any {\n    if (!field) return defaultValue;\n    if (typeof field === 'object') return field;\n\n    try {\n      // Handle '[object Object]' case\n      if (field === '[object Object]') return defaultValue;\n\n      // Try to parse if it's a string\n      if (typeof field === 'string') {\n        if (field.trim() === '') return defaultValue;\n        const parsed = JSON.parse(field);\n        return parsed || defaultValue;\n      }\n\n      return defaultValue;\n    } catch (error) {\n      console.error('Error parsing JSON field:', error);\n      console.error('Field value:', field);\n      console.error('Field type:', typeof field);\n      return defaultValue;\n    }\n  }\n\n  async calculateEquipmentPopularity(equipmentId: number): Promise<number> {\n    try {\n      const [result] = await db\n        .select({\n          popularity: sql<number>`\n            COALESCE(\n              (\n                SELECT COUNT(*)::int * 10 +\n                (SELECT COALESCE(AVG(${reviews.rating}), 0) * 2)::int\n                FROM ${reviews}\n                WHERE ${reviews.equipmentId} = ${equipmentId}\n              ),\n              0\n            )`\n        })\n        .from(equipmentTable)\n        .where(eq(equipmentTable.id, equipmentId));\n\n      return result?.popularity || 0;\n    } catch (error) {\n      console.error('Error calculating equipment popularity:', error);\n      return 0;\n    }\n  }\n\n  async listEquipmentReviews(equipmentId: number): Promise<Review[]> {\n    try {\n      const equipmentReviews = await db\n        .select({\n          id: reviews.id,\n          userId: reviews.userId,\n          equipmentId: reviews.equipmentId,\n          rating: reviews.rating,\n          comment: reviews.comment,\n          createdAt: reviews.createdAt\n        })\n        .from(reviews)\n        .where(eq(reviews.equipmentId, equipmentId))\n        .orderBy(desc(reviews.createdAt));\n\n      return equipmentReviews;\n    } catch (error) {\n      console.error('Error listing equipment reviews:', error);\n      throw new Error('Failed to list equipment reviews');\n    }\n  }\n}\n\nexport const storage = new DatabaseStorage();\nstorage.init().catch(err => {\n  console.error('Error initializing storage:', err);\n});","size_bytes":32269},"client/src/components/ui/toggle-group.tsx":{"content":"import * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1739},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":772},"client/src/pages/compare-page.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Equipment } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus, Loader2 } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { useTranslation } from \"react-i18next\";\nimport { EquipmentComparison } from \"@/components/equipment-comparison\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { MainNav } from \"@/components/main-nav\";\n\nexport default function ComparePage() {\n  const { t } = useTranslation();\n  const [selectedIds, setSelectedIds] = useState<number[]>([]);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n\n  const { data: equipment, isLoading } = useQuery<Equipment[]>({\n    queryKey: [\"/api/equipment\"],\n    enabled: true,\n  });\n\n  const filteredEquipment = equipment?.filter(\n    (item) =>\n      !selectedIds.includes(item.id) &&\n      (item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        item.category.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        item.location.toLowerCase().includes(searchTerm.toLowerCase()))\n  );\n\n  const handleAddToComparison = (equipmentId: number) => {\n    if (selectedIds.length < 3) {\n      setSelectedIds([...selectedIds, equipmentId]);\n      setIsDialogOpen(false);\n    }\n  };\n\n  const handleRemoveFromComparison = (equipmentId: number) => {\n    setSelectedIds(selectedIds.filter((id) => id !== equipmentId));\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <MainNav />\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"flex justify-between items-center mb-8\">\n          <h1 className=\"text-4xl font-bold\">\n            {t('comparison.title', 'Compare Equipment')}\n          </h1>\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button\n                disabled={selectedIds.length >= 3}\n                className=\"flex items-center gap-2\"\n              >\n                <Plus className=\"w-4 h-4\" />\n                {t('comparison.add', 'Add to Compare')}\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[600px]\">\n              <DialogHeader>\n                <DialogTitle>\n                  {t('comparison.select', 'Select Equipment to Compare')}\n                </DialogTitle>\n              </DialogHeader>\n              <div className=\"py-4\">\n                <Input\n                  placeholder={t('comparison.search', 'Search by name, category, or location...')}\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"mb-4\"\n                />\n                <ScrollArea className=\"h-[400px]\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    {filteredEquipment?.map((item) => (\n                      <Card key={item.id} className=\"cursor-pointer hover:bg-accent\">\n                        <CardContent\n                          className=\"p-4 flex items-center gap-4\"\n                          onClick={() => handleAddToComparison(item.id)}\n                        >\n                          <img\n                            src={item.imageUrl}\n                            alt={item.name}\n                            className=\"w-16 h-16 object-cover rounded\"\n                          />\n                          <div>\n                            <h3 className=\"font-semibold\">{item.name}</h3>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {item.category} • {item.location}\n                            </p>\n                            <p className=\"text-sm font-medium\">\n                              ₹{item.dailyRate}/day\n                            </p>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                </ScrollArea>\n              </div>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {selectedIds.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-8 text-center\">\n              <h2 className=\"text-xl font-semibold mb-4\">\n                {t('comparison.empty', 'No Equipment Selected')}\n              </h2>\n              <p className=\"text-muted-foreground mb-6\">\n                {t('comparison.emptyDescription', 'Select up to 3 equipment items to compare their features and specifications side by side.')}\n              </p>\n              <Button onClick={() => setIsDialogOpen(true)}>\n                <Plus className=\"w-4 h-4 mr-2\" />\n                {t('comparison.start', 'Start Comparing')}\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <EquipmentComparison\n            equipmentIds={selectedIds}\n            onRemove={handleRemoveFromComparison}\n          />\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":5409},"client/src/components/ui/resizable.tsx":{"content":"import { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1709},"client/src/hooks/use-auth.tsx":{"content":"import { createContext, ReactNode, useContext } from \"react\";\nimport {\n  useQuery,\n  useMutation,\n  UseMutationResult,\n} from \"@tanstack/react-query\";\nimport { insertUserSchema, User as SelectUser, InsertUser, UpdateProfile } from \"@shared/schema\";\nimport { getQueryFn, apiRequest, queryClient } from \"../lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype AuthContextType = {\n  user: SelectUser | null;\n  isLoading: boolean;\n  error: Error | null;\n  loginMutation: UseMutationResult<SelectUser, Error, LoginData>;\n  logoutMutation: UseMutationResult<void, Error, void>;\n  registerMutation: UseMutationResult<SelectUser, Error, InsertUser>;\n  updateProfileMutation: UseMutationResult<SelectUser, Error, UpdateProfile>;\n};\n\ntype LoginData = Pick<InsertUser, \"username\" | \"password\">;\n\nexport const AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const { toast } = useToast();\n  const {\n    data: user,\n    error,\n    isLoading,\n  } = useQuery<SelectUser | undefined, Error>({\n    queryKey: [\"/api/user\"],\n    queryFn: getQueryFn({ on401: \"returnNull\" }),\n    staleTime: 0, // Always fetch fresh data\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginData) => {\n      const res = await apiRequest(\"/api/login\", \"POST\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: UpdateProfile) => {\n      console.log('Updating profile with data:', data);\n      const res = await apiRequest(\"/api/user/profile\", \"PATCH\", data);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      console.log('Profile update successful, updating cache');\n      queryClient.setQueryData([\"/api/user\"], user);\n      queryClient.invalidateQueries({ queryKey: [\"/api/user\"] });\n      toast({\n        title: \"Success\",\n        description: \"Profile updated successfully\",\n      });\n    },\n    onError: (error: Error) => {\n      console.error('Profile update failed:', error);\n      toast({\n        title: \"Update failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (credentials: InsertUser) => {\n      const res = await apiRequest(\"/api/register\", \"POST\", credentials);\n      return await res.json();\n    },\n    onSuccess: (user: SelectUser) => {\n      queryClient.setQueryData([\"/api/user\"], user);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"/api/logout\", \"POST\");\n      if (!res.ok) {\n        throw new Error(\"Failed to logout\");\n      }\n    },\n    onSuccess: () => {\n      // Clear all query cache to ensure no stale data remains\n      queryClient.clear();\n      // Reset user data to null\n      queryClient.setQueryData([\"/api/user\"], null);\n      console.log(\"Logout successful - cleared cache and user data\");\n    },\n    onError: (error: Error) => {\n      console.error(\"Logout error:\", error);\n      toast({\n        title: \"Logout failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  return (\n    <AuthContext.Provider\n      value={{\n        user: user ?? null,\n        isLoading,\n        error,\n        loginMutation,\n        logoutMutation,\n        registerMutation,\n        updateProfileMutation,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}","size_bytes":4143},"client/src/lib/protected-route.tsx":{"content":"import { useAuth } from \"@/hooks/use-auth\";\nimport { Loader2 } from \"lucide-react\";\nimport { Redirect, Route } from \"wouter\";\n\nexport function ProtectedRoute({\n  path,\n  component: Component,\n}: {\n  path: string;\n  component: () => React.JSX.Element;\n}) {\n  const { user, isLoading } = useAuth();\n\n  if (isLoading) {\n    return (\n      <Route path={path}>\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-border\" />\n        </div>\n      </Route>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Route path={path}>\n        <Redirect to=\"/auth\" />\n      </Route>\n    );\n  }\n\n  return <Component />\n}\n","size_bytes":675},"client/src/components/equipment-recommendations.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Equipment } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Star } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useLocation } from \"wouter\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea, ScrollBar } from \"@/components/ui/scroll-area\";\n\ninterface EquipmentRecommendationsProps {\n  userId: number;\n}\n\nexport function EquipmentRecommendations({ userId }: EquipmentRecommendationsProps) {\n  const { t } = useTranslation();\n  const [, setLocation] = useLocation();\n\n  const { data: recommendations, isLoading } = useQuery<{\n    equipment: Equipment;\n    score: number;\n    reason: string;\n  }[]>({\n    queryKey: ['/api/recommendations', userId],\n    enabled: !!userId,\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-48\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (!recommendations || recommendations.length === 0) {\n    return (\n      <Card>\n        <CardContent className=\"p-6\">\n          <p className=\"text-muted-foreground text-center\">\n            {t('recommendations.empty', 'No recommendations available yet. Start browsing equipment to get personalized suggestions!')}\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-2xl font-bold\">\n        {t('recommendations.title', 'Recommended for You')}\n      </h2>\n      <ScrollArea className=\"w-full whitespace-nowrap rounded-md border\">\n        <div className=\"flex w-max space-x-4 p-4\">\n          {recommendations.map(({ equipment, score, reason }) => (\n            <Card \n              key={equipment.id} \n              className=\"w-[300px] flex-none\"\n            >\n              <div className=\"relative\">\n                <img\n                  src={equipment.imageUrl}\n                  alt={equipment.name}\n                  className=\"w-full h-48 object-cover rounded-t-lg\"\n                />\n                <Badge \n                  className=\"absolute top-2 right-2\" \n                  variant=\"secondary\"\n                >\n                  {Math.round(score)}% {t('recommendations.match', 'Match')}\n                </Badge>\n              </div>\n              <CardContent className=\"p-4\">\n                <h3 className=\"font-semibold truncate\">{equipment.name}</h3>\n                <p className=\"text-sm text-muted-foreground mb-2\">{reason}</p>\n                <p className=\"text-lg font-semibold mb-4\">\n                  ₹{equipment.dailyRate}/day\n                </p>\n                <Button \n                  className=\"w-full\"\n                  onClick={() => setLocation(`/equipment/${equipment.id}`)}\n                >\n                  {t('equipment.viewDetails', 'View Details')}\n                </Button>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n        <ScrollBar orientation=\"horizontal\" />\n      </ScrollArea>\n    </div>\n  );\n}\n","size_bytes":3124},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        if (setOpenProp) {\n          return setOpenProp?.(\n            typeof value === \"function\" ? value(open) : value\n          )\n        }\n\n        _setOpen(value)\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${open}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full text-sidebar-foreground has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23337},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/collapsible.tsx":{"content":"import * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":315},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport themePlugin from \"@replit/vite-plugin-shadcn-theme-json\";\nimport path, { dirname } from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { fileURLToPath } from \"url\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nexport default defineConfig({\n  plugins: [react(), runtimeErrorOverlay(), themePlugin()],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(__dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(__dirname, \"shared\"),\n    },\n  },\n  root: path.resolve(__dirname, \"client\"),\n  build: {\n    outDir: path.resolve(__dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n});\n","size_bytes":756},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([_, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item.dataKey || item.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10466},"client/src/pages/ReceiptPage.tsx":{"content":"import { useParams } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Download } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { MainNav } from \"@/components/main-nav\";\n\ninterface Receipt {\n  id: number;\n  bookingId: number;\n  paymentId: string;\n  status: string;\n  amount: number;\n  currency: string;\n  timestamp: string;\n  method: string;\n  metadata: {\n    equipment_name?: string;\n    booking_dates?: {\n      start: string;\n      end: string;\n    };\n    renter_name?: string;\n    renter_contact?: string;\n    equipment_owner?: string;\n    location?: string;\n  };\n}\n\nexport default function ReceiptPage() {\n  const { id } = useParams<{ id: string }>();\n  const { t } = useTranslation();\n\n  const { data: receipt, isLoading } = useQuery<Receipt>({\n    queryKey: [`/api/receipts/${id}`],\n    queryFn: async () => {\n      const response = await fetch(`/api/receipts/${id}`, {\n        credentials: \"include\",\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to fetch receipt\");\n      }\n      return response.json();\n    },\n    enabled: !!id,\n  });\n\n  const handleDownload = async () => {\n    try {\n      const response = await fetch(`/api/receipts/${id}/download`, {\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Failed to download receipt\");\n      }\n\n      const blob = await response.blob();\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `receipt-${id}.pdf`;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n    } catch (error) {\n      console.error(\"Download error:\", error);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <MainNav />\n        <div className=\"flex items-center justify-center min-h-[calc(100vh-4rem)]\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!receipt) {\n    return (\n      <div className=\"min-h-screen bg-background\">\n        <MainNav />\n        <div className=\"container mx-auto px-4 py-8\">\n          <Card>\n            <CardContent className=\"p-6 text-center\">\n              <h1 className=\"text-2xl font-bold mb-2 text-destructive\">\n                {t(\"receipt.notFound\", \"Receipt Not Found\")}\n              </h1>\n              <p className=\"text-muted-foreground\">\n                {t(\n                  \"receipt.notFoundDesc\",\n                  \"This receipt does not exist or has been deleted.\",\n                )}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <MainNav />\n      <div className=\"container mx-auto px-4 py-8 max-w-2xl\">\n        <Card className=\"shadow-lg border border-gray-200 rounded-xl\">\n          <CardContent className=\"p-8\">\n            {/* Header */}\n            <div className=\"flex justify-between items-start mb-8\">\n              <div>\n                <h1 className=\"text-3xl font-bold text-primary mb-2\">\n                  {t(\"receipt.title\", \"Payment Receipt\")}\n                </h1>\n                <p className=\"text-muted-foreground\">\n                  #{receipt.id} | {format(new Date(receipt.timestamp), \"PPP\")}\n                </p>\n              </div>\n              <Button\n                variant=\"default\"\n                size=\"lg\"\n                className=\"bg-primary text-primary-foreground hover:bg-primary/90\"\n                onClick={handleDownload}\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                {t(\"receipt.download\", \"Download PDF\")}\n              </Button>\n            </div>\n\n            {/* Details Section */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8\">\n              <div>\n                <h2 className=\"font-semibold mb-2 text-lg text-primary\">\n                  {t(\"receipt.equipmentDetails\", \"Equipment Details\")}\n                </h2>\n                <p className=\"text-muted-foreground\">\n                  {receipt.metadata.equipment_name || \"N/A\"}\n                </p>\n                <p className=\"text-muted-foreground\">\n                  {receipt.metadata.location || \"—\"}\n                </p>\n                <p className=\"text-muted-foreground\">\n                  {receipt.metadata.booking_dates && (\n                    <>\n                      {format(\n                        new Date(receipt.metadata.booking_dates.start),\n                        \"PPP\",\n                      )}{\" \"}\n                      -{\" \"}\n                      {format(\n                        new Date(receipt.metadata.booking_dates.end),\n                        \"PPP\",\n                      )}\n                    </>\n                  )}\n                </p>\n              </div>\n\n              <div>\n                <h2 className=\"font-semibold mb-2 text-lg text-primary\">\n                  {t(\"receipt.paymentDetails\", \"Payment Details\")}\n                </h2>\n                <p className=\"text-muted-foreground\">\n                  {t(\"receipt.paymentId\", \"Payment ID\")}: {receipt.paymentId}\n                </p>\n                <p className=\"text-muted-foreground\">\n                  {t(\"receipt.method\", \"Method\")}: {receipt.method}\n                </p>\n                <p className=\"text-muted-foreground\">\n                  {t(\"receipt.status\", \"Status\")}:{\" \"}\n                  <span\n                    className={`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${\n                      receipt.status === \"paid\"\n                        ? \"bg-green-100 text-green-800 border-green-200\"\n                        : \"bg-yellow-100 text-yellow-800 border-yellow-200\"\n                    }`}\n                  >\n                    {receipt.status === \"paid\" && (\n                      <span className=\"text-green-600 mr-1\">✓</span>\n                    )}\n                    {receipt.status === \"pending\" && (\n                      <span className=\"text-yellow-600 mr-1\">⏳</span>\n                    )}\n                    {receipt.status.charAt(0).toUpperCase() +\n                      receipt.status.slice(1)}\n                  </span>\n                </p>\n              </div>\n            </div>\n\n            {/* Total Section */}\n            <div className=\"border-t pt-6\">\n              <div className=\"flex justify-between items-center text-xl font-semibold\">\n                <span>{t(\"receipt.totalAmount\", \"Total Amount\")}</span>\n                <span className=\"text-green-700 font-bold tracking-wide\">\n                  {new Intl.NumberFormat(\"en-IN\", {\n                    style: \"currency\",\n                    currency: receipt.currency || \"INR\",\n                    maximumFractionDigits: 0,\n                  }).format((Number(receipt.amount) || 0) / 100)}\n                </span>\n              </div>\n            </div>\n\n            {/* Footer */}\n            <p className=\"text-xs text-muted-foreground text-center mt-6\">\n              Thank you for using AgroRental. Please keep this receipt for your\n              records.\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7569},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/lib/i18n.ts":{"content":"import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\nimport enTranslations from '../translations/en.json';\nimport hiTranslations from '../translations/hi.json';\nimport mrTranslations from '../translations/mr.json';\n\nconst resources = {\n  en: {\n    translation: enTranslations\n  },\n  hi: {\n    translation: hiTranslations\n  },\n  mr: {\n    translation: mrTranslations\n  }\n};\n\nconsole.debug('Initializing i18n with resources:', Object.keys(resources));\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next)\n  .init({\n    resources,\n    fallbackLng: 'en',\n    interpolation: {\n      escapeValue: false,\n    },\n    detection: {\n      order: ['localStorage', 'navigator'],\n      caches: ['localStorage'],\n      lookupLocalStorage: 'i18nextLng',\n    },\n    react: {\n      useSuspense: false,\n    },\n    returnNull: false,\n    returnEmptyString: false,\n    returnObjects: true,\n    saveMissing: true,\n    debug: true,\n    preload: ['en', 'hi', 'mr'],\n    load: 'all',\n  });\n\n// Initialize HTML lang attribute\ndocument.documentElement.lang = i18n.language;\nconsole.debug('Initial language set to:', i18n.language);\n\n// Update HTML lang attribute when language changes\ni18n.on('languageChanged', (lng) => {\n  console.debug('Language changed to:', lng);\n  document.documentElement.lang = lng;\n});\n\n// Add missing key logging\ni18n.on('missingKey', (lngs, namespace, key, res) => {\n  console.warn('Missing translation:', { languages: lngs, namespace, key, result: res });\n});\n\nexport default i18n;","size_bytes":1577},"client/src/pages/BookingPage.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { useTranslation } from \"react-i18next\";\nimport { Equipment } from \"@shared/schema\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, Star, Download } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { format } from 'date-fns';\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { PaymentGateway } from \"@/components/payment-gateway\";\nimport { ReviewForm } from \"@/components/review-form\";\nimport { useState } from \"react\";\nimport { CalendarHeatmap } from \"@/components/ui/calendar-heatmap\";\n\ninterface BookingDetails {\n  id: number;\n  equipmentId: number;\n  startDate: string;\n  endDate: string;\n  totalPrice: number;\n  status: string;\n  razorpayOrderId?: string;\n  user?: {\n    name?: string;\n    email?: string;\n    phone?: string;\n  }\n}\n\nexport default function BookingPage() {\n  const { id } = useParams<{ id: string }>();\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [showRatingDialog, setShowRatingDialog] = useState(false);\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const [startDate, setStartDate] = useState<Date>();\n  const [endDate, setEndDate] = useState<Date>();\n  const queryClient = useQueryClient();\n\n  const { data: booking, isLoading: isLoadingBooking } = useQuery<BookingDetails>({\n    queryKey: [`/api/bookings/${id}`],\n    enabled: !!id && !!user,\n    retry: 3,\n  });\n\n  const { data: equipment, isLoading: isLoadingEquipment } = useQuery<Equipment>({\n    queryKey: [`/api/equipment/${booking?.equipmentId}`],\n    enabled: !!booking?.equipmentId,\n    retry: 3,\n  });\n\n  const handleDateSelect = (start: Date | undefined, end: Date | undefined) => {\n    setStartDate(start);\n    setEndDate(end);\n  };\n\n  const handleReviewSuccess = () => {\n    setShowRatingDialog(false);\n    queryClient.invalidateQueries({ queryKey: [`/api/bookings/${id}`] });\n    queryClient.invalidateQueries({ queryKey: [`/api/equipment/${booking?.equipmentId}`] });\n  };\n\n  if (isLoadingBooking || isLoadingEquipment) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  if (!booking || !equipment) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <h1 className=\"text-2xl font-bold mb-4\">\n              {t('booking.notFound')}\n            </h1>\n            <p className=\"text-muted-foreground mb-4\">\n              {t('booking.noAccess')}\n            </p>\n            <Button onClick={() => setLocation('/dashboard')}>\n              {t('common.returnToDashboard')}\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen p-4\">\n      <div className=\"container mx-auto\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <h1 className=\"text-2xl font-bold mb-4\">\n              {t('booking.details')} #{booking?.id}\n            </h1>\n\n            {equipment && (\n              <div className=\"mb-6\">\n                <h2 className=\"text-xl font-semibold mb-4\">\n                  {t('equipment.details', 'Equipment Details')}\n                </h2>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <img\n                      src={equipment.imageUrl}\n                      alt={equipment.name}\n                      className=\"w-full h-48 object-cover rounded-lg\"\n                    />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-medium\">{equipment.name}</h3>\n                    <p className=\"text-muted-foreground mt-2\">{equipment.description}</p>\n                    <p className=\"mt-2\">\n                      <span className=\"font-medium\">{t('equipment.category')}:</span>{' '}\n                      {equipment.category}\n                    </p>\n                    <p>\n                      <span className=\"font-medium\">{t('equipment.location')}:</span>{' '}\n                      {equipment.location}\n                    </p>\n                    <p>\n                      <span className=\"font-medium\">{t('equipment.dailyRate')}:</span>{' '}\n                      ₹{equipment.dailyRate}/day\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className=\"mb-6\">\n              <CalendarHeatmap\n                equipmentId={equipment?.id || 0}\n                startDate={startDate}\n                endDate={endDate}\n                dailyRate={equipment?.dailyRate || 0}\n                onSelect={handleDateSelect}\n                onConfirm={() => {\n                  console.log('Booking confirmed:', { startDate, endDate });\n                }}\n              />\n            </div>\n\n            <div className=\"space-y-4\">\n              {booking && (\n                <>\n                  <p>\n                    <span className=\"font-semibold\">{t('booking.dates')}:</span>{' '}\n                    {format(new Date(booking.startDate), 'PP')} - {format(new Date(booking.endDate), 'PP')}\n                  </p>\n                  <p>\n                    <span className=\"font-semibold\">{t('booking.totalPrice')}:</span>{' '}\n                    {t('common.price', { price: booking.totalPrice })}\n                  </p>\n                  <p>\n                    <span className=\"font-semibold\">{t('booking.status')}:</span>{' '}\n                  <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${\n                    booking.status === 'paid' \n                      ? 'bg-green-100 text-green-800 border-green-200'\n                      : booking.status === 'pending' || booking.status === 'awaiting_payment'\n                      ? 'bg-yellow-100 text-yellow-800 border-yellow-200'\n                      : 'bg-red-100 text-red-800 border-red-200'\n                  }`}>\n                    {booking.status === 'paid' && <span className=\"text-green-600 mr-1\">✓</span>}\n                    {(booking.status === 'pending' || booking.status === 'awaiting_payment') && <span className=\"text-yellow-600 mr-1\">⏳</span>}\n                    {booking.status === 'payment_failed' && <span className=\"text-red-600 mr-1\">✗</span>}\n                    {t(`booking.status.${booking.status.toLowerCase()}`)}\n                  </span>\n                  </p>\n\n                  {booking.status === 'paid' && (\n                    <Button\n                      variant=\"outline\"\n                      className=\"mt-4\"\n                      onClick={async () => {\n                        try {\n                          const response = await fetch(`/api/bookings/${booking.id}/receipt`, {\n                            credentials: 'include'\n                          });\n                          \n                          if (!response.ok) {\n                            throw new Error('Receipt not found');\n                          }\n                          \n                          const receipt = await response.json();\n                          \n                          if (receipt && receipt.id) {\n                            const downloadResponse = await fetch(`/api/receipts/${receipt.id}/download`, {\n                              credentials: 'include'\n                            });\n                            \n                            if (!downloadResponse.ok) {\n                              throw new Error('Failed to download receipt');\n                            }\n                            \n                            const blob = await downloadResponse.blob();\n                            const url = window.URL.createObjectURL(blob);\n                            const a = document.createElement('a');\n                            a.href = url;\n                            a.download = `receipt-${receipt.id}.pdf`;\n                            document.body.appendChild(a);\n                            a.click();\n                            window.URL.revokeObjectURL(url);\n                            document.body.removeChild(a);\n                            \n                            toast({\n                              title: t('receipt.downloadSuccess', 'Receipt Downloaded'),\n                              description: t('receipt.downloadSuccessDesc', 'Your receipt has been downloaded successfully.'),\n                            });\n                          } else {\n                            throw new Error('Receipt data is invalid');\n                          }\n                        } catch (error) {\n                          console.error('Error downloading receipt:', error);\n                          toast({\n                            title: t('receipt.error', 'Error'),\n                            description: t('receipt.downloadError', 'Failed to download receipt. Please try again.'),\n                            variant: \"destructive\",\n                          });\n                        }\n                      }}\n                    >\n                      <Download className=\"w-4 h-4 mr-2\" />\n                      {t('booking.downloadReceipt', 'Download Receipt')}\n                    </Button>\n                  )}\n\n                  {booking.status === 'awaiting_payment' && booking.razorpayOrderId && (\n                    <PaymentGateway\n                      bookingId={booking.id}\n                      totalPrice={booking.totalPrice}\n                      razorpayOrderId={booking.razorpayOrderId}\n                      userData={booking.user || {}}\n                      onSuccess={() => setShowRatingDialog(true)}\n                      onError={(error: Error) => {\n                        toast({\n                          title: t('payment.error'),\n                          description: error.message,\n                          variant: \"destructive\",\n                        });\n                      }}\n                    />\n                  )}\n\n                  {booking.status === 'paid' && (\n                    <Button\n                      variant=\"outline\"\n                      className=\"mt-4\"\n                      onClick={() => setShowRatingDialog(true)}\n                    >\n                      <Star className=\"w-4 h-4 mr-2\" />\n                      {t('review.rateBooking')}\n                    </Button>\n                  )}\n                </>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {equipment && (\n        <ReviewForm\n          equipmentId={equipment.id}\n          isOpen={showRatingDialog}\n          onOpenChange={setShowRatingDialog}\n          onSubmitSuccess={handleReviewSuccess}\n        />\n      )}\n    </div>\n  );\n}","size_bytes":10976},"client/src/components/ui/avatar.tsx":{"content":"import * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1405},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\nimport { format } from \"date-fns\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n\nexport function formatDate(date: string | Date): string {\n  const dateObj = typeof date === 'string' ? new Date(date) : date\n  return format(dateObj, 'PPP')  // Format as \"Apr 29, 2021\"\n}\n","size_bytes":389},"client/src/pages/auth-page.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/hooks/use-auth\";\nimport { useForm } from \"react-hook-form\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertUserSchema } from \"@shared/schema\";\nimport { Loader2, Eye, EyeOff } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\nimport { LanguageSwitcher } from \"@/components/language-switcher\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogTrigger } from \"@/components/ui/dialog\";\nimport { z } from \"zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\n\n// Simple schema for login validation\nconst loginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\n// Simple schema for forgot password validation\nconst forgotPasswordSchema = z.object({\n  email: z.string().min(1, \"Email is required\").email(\"Please enter a valid email address\"),\n});\n\n// Registration schema with password confirmation\nconst registrationSchema = insertUserSchema.extend({\n  confirmPassword: z.string().min(1, \"Please confirm your password\"),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\ntype LoginData = z.infer<typeof loginSchema>;\ntype ForgotPasswordData = z.infer<typeof forgotPasswordSchema>;\n\nexport default function AuthPage() {\n  const [_, setLocation] = useLocation();\n  const { user, loginMutation, registerMutation } = useAuth();\n  const { t } = useTranslation();\n  const { toast } = useToast();\n  const [isForgotPasswordOpen, setIsForgotPasswordOpen] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n\n  // Form setup\n  const loginForm = useForm<LoginData>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: { username: \"\", password: \"\" },\n  });\n\n  const registerForm = useForm({\n    resolver: zodResolver(registrationSchema),\n    defaultValues: { username: \"\", password: \"\", confirmPassword: \"\", name: \"\" },\n  });\n\n  const forgotPasswordForm = useForm<ForgotPasswordData>({\n    resolver: zodResolver(forgotPasswordSchema),\n    defaultValues: { email: \"\" },\n  });\n\n  // Redirect if already logged in\n  useEffect(() => {\n    if (user) setLocation(\"/\");\n  }, [user, setLocation]);\n\n  // Handle login submit\n  const handleLogin = async (data: LoginData) => {\n    try {\n      await loginMutation.mutateAsync(data);\n      loginForm.reset();\n    } catch (error) {\n      toast({\n        title: t('common.error', \"Error\"),\n        description: t('auth.loginError', \"Please check your username and password and try again.\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Handle registration submit\n  const handleRegistration = async (data: any) => {\n    try {\n      const { confirmPassword, ...registrationData } = data;\n      await registerMutation.mutateAsync(registrationData);\n      toast({\n        title: t('auth.registrationSuccess', \"Registration Successful\"),\n        description: t('auth.registrationSuccessDesc', \"Your account has been created successfully. You can now log in.\"),\n      });\n      registerForm.reset();\n    } catch (error) {\n      console.error('Registration error:', error);\n      const errorMessage = error instanceof Error ? error.message : \"Registration failed. Please try again.\";\n      toast({\n        title: t('common.error', \"Error\"),\n        description: t('auth.registrationError', errorMessage),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Handle forgot password submit\n  const handleForgotPassword = async (data: ForgotPasswordData) => {\n    try {\n      const response = await fetch('/api/auth/forgot-password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        throw new Error();\n      }\n\n      toast({\n        title: t('auth.resetEmailSent', \"Email Sent\"),\n        description: t('auth.resetEmailSentDesc', \"If an account exists with this email, you will receive instructions to reset your password.\"),\n      });\n      setIsForgotPasswordOpen(false);\n      forgotPasswordForm.reset();\n    } catch (error) {\n      toast({\n        title: t('common.error', \"Error\"),\n        description: t('auth.resetError', \"Unable to send reset instructions. Please try again later.\"),\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen grid md:grid-cols-2\">\n      <div className=\"flex items-center justify-center p-8\">\n        <div className=\"absolute top-4 right-4\">\n          <LanguageSwitcher />\n        </div>\n\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6\">\n            <Tabs defaultValue=\"login\">\n              <TabsList className=\"grid w-full grid-cols-2\">\n                <TabsTrigger value=\"login\">{t('auth.login', 'Login')}</TabsTrigger>\n                <TabsTrigger value=\"register\">{t('auth.register', 'Register')}</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"login\">\n                <Form {...loginForm}>\n                  <form onSubmit={loginForm.handleSubmit(handleLogin)} className=\"space-y-4 mt-4\">\n                    <FormField\n                      control={loginForm.control}\n                      name=\"username\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.username', 'Username')}</FormLabel>\n                          <FormControl>\n                            <Input \n                              placeholder={t('auth.usernamePlaceholder', 'Enter your username')} \n                              autoComplete=\"username\"\n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={loginForm.control}\n                      name=\"password\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.password', 'Password')}</FormLabel>\n                          <FormControl>\n                            <Input \n                              type={showPassword ? \"text\" : \"password\"} \n                              placeholder={t('auth.passwordPlaceholder', 'Enter your password')}\n                              autoComplete=\"current-password\"\n                              {...field} \n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\"\n                      disabled={loginMutation.isPending}\n                    >\n                      {loginMutation.isPending ? (\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      ) : null}\n                      {t('auth.loginButton', 'Sign In')}\n                    </Button>\n\n                    <Dialog open={isForgotPasswordOpen} onOpenChange={setIsForgotPasswordOpen}>\n                      <DialogTrigger asChild>\n                        <Button variant=\"link\" className=\"w-full\">\n                          {t('auth.forgotPassword', 'Forgot Password?')}\n                        </Button>\n                      </DialogTrigger>\n                      <DialogContent>\n                        <DialogHeader>\n                          <DialogTitle>{t('auth.resetPassword', 'Reset Password')}</DialogTitle>\n                          <DialogDescription>\n                            {t('auth.resetPasswordDesc', 'Enter your email address to receive password reset instructions.')}\n                          </DialogDescription>\n                        </DialogHeader>\n                        <Form {...forgotPasswordForm}>\n                          <form onSubmit={forgotPasswordForm.handleSubmit(handleForgotPassword)} className=\"space-y-4\">\n                            <FormField\n                              control={forgotPasswordForm.control}\n                              name=\"email\"\n                              render={({ field }) => (\n                                <FormItem>\n                                  <FormLabel>{t('auth.email', 'Email')}</FormLabel>\n                                  <FormControl>\n                                    <Input\n                                      type=\"email\"\n                                      placeholder=\"your.email@example.com\"\n                                      autoComplete=\"email\"\n                                      {...field}\n                                    />\n                                  </FormControl>\n                                  <FormMessage />\n                                </FormItem>\n                              )}\n                            />\n                            <Button\n                              type=\"submit\"\n                              className=\"w-full\"\n                              disabled={loginMutation.isPending}\n                            >\n                              {loginMutation.isPending ? (\n                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                              ) : null}\n                              {t('auth.sendResetLink', 'Send Reset Link')}\n                            </Button>\n                          </form>\n                        </Form>\n                      </DialogContent>\n                    </Dialog>\n                  </form>\n                </Form>\n              </TabsContent>\n\n              <TabsContent value=\"register\">\n                <Form {...registerForm}>\n                  <form \n                    onSubmit={registerForm.handleSubmit(handleRegistration)}\n                    className=\"space-y-4 mt-4\"\n                  >\n                    <FormField\n                      control={registerForm.control}\n                      name=\"name\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.fullName', 'Full Name')}</FormLabel>\n                          <FormControl>\n                            <Input placeholder={t('auth.fullNamePlaceholder', 'Enter your full name')} {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"username\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.username', 'Username')}</FormLabel>\n                          <FormControl>\n                            <Input placeholder={t('auth.usernamePlaceholder', 'Choose a username')} {...field} />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"password\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.password', 'Password')}</FormLabel>\n                          <FormControl>\n                            <div className=\"relative\">\n                              <Input \n                                type={showPassword ? \"text\" : \"password\"}\n                                placeholder={t('auth.passwordPlaceholder', 'Create a password')}\n                                {...field} \n                              />\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"absolute right-0 top-0 h-full px-3\"\n                                onClick={() => setShowPassword(!showPassword)}\n                              >\n                                {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                              </Button>\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={registerForm.control}\n                      name=\"confirmPassword\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>{t('auth.confirmPassword', 'Confirm Password')}</FormLabel>\n                          <FormControl>\n                            <div className=\"relative\">\n                              <Input \n                                type={showPassword ? \"text\" : \"password\"}\n                                placeholder={t('auth.confirmPasswordPlaceholder', 'Confirm your password')}\n                                {...field} \n                              />\n                              <Button\n                                type=\"button\"\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                className=\"absolute right-0 top-0 h-full px-3\"\n                                onClick={() => setShowPassword(!showPassword)}\n                              >\n                                {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                              </Button>\n                            </div>\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <Button \n                      type=\"submit\" \n                      className=\"w-full\"\n                      disabled={registerMutation.isPending}\n                    >\n                      {registerMutation.isPending ? (\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      ) : null}\n                      {t('auth.registerButton', 'Create Account')}\n                    </Button>\n                  </form>\n                </Form>\n              </TabsContent>\n            </Tabs>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div \n        className=\"hidden md:flex flex-col justify-center p-8 bg-cover bg-center text-white\"\n        style={{\n          backgroundImage: `linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1444858291040-58f756a3bdd6')`,\n        }}\n      >\n        <div className=\"max-w-xl\">\n          <h1 className=\"text-4xl font-bold mb-4\">\n            {t('home.title', 'Agricultural Equipment Rental Platform')}\n          </h1>\n          <p className=\"text-lg opacity-90\">\n            {t('home.description', 'Connect with equipment owners and find the machinery you need for your farming operations.')}\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":15787},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/pages/equipment-add-page.tsx":{"content":"\nimport { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useMutation } from '@tanstack/react-query';\nimport { MainNav } from '@/components/main-nav';\nimport { EquipmentForm } from '@/components/equipment-form';\nimport { useToast } from '@/hooks/use-toast';\nimport { useTranslation } from 'react-i18next';\n\nexport default function EquipmentAddPage() {\n  const navigate = useNavigate();\n  const { toast } = useToast();\n  const { t } = useTranslation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // Create equipment mutation\n  const createEquipment = useMutation({\n    mutationFn: async (formData: FormData) => {\n      setIsSubmitting(true);\n      const response = await fetch('/api/equipment', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Failed to create equipment');\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: t('equipment.createSuccess', 'Equipment Created'),\n        description: t('equipment.createSuccessDesc', 'Your equipment has been created successfully.'),\n      });\n      navigate(`/equipment/${data.equipment.id}`);\n      setIsSubmitting(false);\n    },\n    onError: (error) => {\n      console.error('Error creating equipment:', error);\n      toast({\n        variant: \"destructive\",\n        title: t('common.error', 'Error'),\n        description: error instanceof Error ? error.message : t('equipment.createError', 'Failed to create equipment'),\n      });\n      setIsSubmitting(false);\n    }\n  });\n\n  const handleSubmit = async (formData: FormData) => {\n    await createEquipment.mutateAsync(formData);\n  };\n\n  return (\n    <div>\n      <MainNav />\n      <div className=\"container mx-auto py-8\">\n        <EquipmentForm \n          onSubmit={handleSubmit}\n          isSubmitting={isSubmitting}\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":2022},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/chatbot.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { MessageCircle, Send, X, Loader2, MinimizeIcon, Lightbulb, Phone, Share2 } from \"lucide-react\";\nimport { useTranslation } from \"react-i18next\";\n\ninterface Message {\n  content: string;\n  sender: 'user' | 'bot';\n  timestamp: Date;\n}\n\nexport function Chatbot() {\n  const { t } = useTranslation();\n  const [isOpen, setIsOpen] = useState(false);\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      content: t('chatbot.welcome', \"Hello! How can I help you with farm equipment rental today?\"),\n      sender: 'bot',\n      timestamp: new Date()\n    }\n  ]);\n  const [input, setInput] = useState(\"\");\n  const [isTyping, setIsTyping] = useState(false);\n  const [showSuggestions, setShowSuggestions] = useState(true);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const quickSuggestions = [\n    t('chatbot.suggestions.findEquipment', 'Find equipment for my farm'),\n    t('chatbot.suggestions.bookingProcess', 'How do I book equipment?'),\n    t('chatbot.suggestions.pricing', 'What are the rental prices?'),\n    t('chatbot.suggestions.availability', 'Check equipment availability'),\n    'Contact via WhatsApp',\n    'Share equipment list',\n    // Multi-language examples\n    'मुझे ट्रैक्टर चाहिए', // Hindi: I need a tractor\n    'मला उपकरणे भाड्याने हवी आहेत' // Marathi: I need equipment for rent\n  ];\n\n  // WhatsApp integration function\n  const sendToWhatsApp = (message: string) => {\n    const phoneNumber = \"917385688905\"; // Updated support number\n    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;\n    window.open(whatsappUrl, '_blank');\n  };\n\n  // Share equipment information\n  const shareEquipmentInfo = async (addMessageFn: (content: string, sender: 'user' | 'bot') => void) => {\n    try {\n      const response = await fetch('/api/equipment');\n      const equipment = await response.json();\n      const topEquipment = equipment.slice(0, 5);\n      \n      const shareText = `🚜 Farm Equipment Available for Rent:\\n\\n${topEquipment.map((eq: any) => \n        `• ${eq.name} - ₹${eq.pricePerDay}/day`\n      ).join('\\n')}\\n\\nBook now: ${window.location.origin}`;\n      \n      if (navigator.share) {\n        await navigator.share({\n          title: 'Farm Equipment Rental',\n          text: shareText,\n        });\n        addMessageFn('Equipment list shared successfully!', 'bot');\n      } else {\n        navigator.clipboard.writeText(shareText);\n        addMessageFn('Equipment list copied to clipboard! You can now paste it anywhere to share.', 'bot');\n      }\n    } catch (error) {\n      console.error('Share error:', error);\n      addMessageFn('Sorry, there was an error sharing the equipment list. Please try again.', 'bot');\n    }\n  };\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const fetchGeminiResponse = async (userMessage: string) => {\n    try {\n      console.log('Sending message to chatbot API:', userMessage);\n      const response = await fetch('/api/chatbot', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ message: userMessage }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({ error: 'Network error' }));\n        console.error('Chatbot API error:', errorData);\n        throw new Error(errorData.error || 'Failed to get AI response');\n      }\n\n      const data = await response.json();\n      console.log('Received chatbot response:', data);\n      console.log('Detected language:', data.detectedLanguage);\n      return data.response;\n    } catch (error) {\n      console.error('Error fetching Gemini response:', error);\n      throw error;\n    }\n  };\n\n  const addMessage = (content: string, sender: 'user' | 'bot') => {\n    const message: Message = {\n      content,\n      sender,\n      timestamp: new Date()\n    };\n    setMessages(prev => [...prev, message]);\n  };\n\n  const handleSubmit = async (e?: React.FormEvent, customMessage?: string) => {\n    e?.preventDefault();\n    const messageToSend = customMessage || input;\n    if (!messageToSend.trim()) return;\n\n    // Hide suggestions after first interaction\n    setShowSuggestions(false);\n\n    // Handle special commands\n    if (messageToSend.toLowerCase().includes('whatsapp') || messageToSend === 'Contact via WhatsApp') {\n      addMessage(messageToSend, 'user');\n      setInput(\"\");\n      \n      const whatsappMessage = \"Hello! I need help with farm equipment rental. Can you assist me?\";\n      sendToWhatsApp(whatsappMessage);\n      addMessage(\"I've opened WhatsApp for you to contact our support team directly. You can send them your questions about equipment rental!\", 'bot');\n      return;\n    }\n\n    if (messageToSend === 'Share equipment list') {\n      addMessage(messageToSend, 'user');\n      setInput(\"\");\n      await shareEquipmentInfo(addMessage);\n      return;\n    }\n\n    // Add user message\n    addMessage(messageToSend, 'user');\n    setInput(\"\");\n    setIsTyping(true);\n\n    try {\n      // Get response from Gemini\n      const response = await fetchGeminiResponse(messageToSend);\n      addMessage(response, 'bot');\n    } catch (error) {\n      console.error('Chat error:', error);\n      // Add specific error message to chat\n      let errorText = t('chatbot.error', \"I'm sorry, but I'm having trouble connecting right now. Please try again later or contact our support team for immediate assistance.\");\n      \n      if (error instanceof Error) {\n        if (error.message.includes('Network')) {\n          errorText = \"Network error: Please check your internet connection and try again.\";\n        } else if (error.message.includes('API key')) {\n          errorText = \"Configuration error: The AI service needs to be set up. Please contact support.\";\n        }\n      }\n      \n      const errorMessage: Message = {\n        content: errorText,\n        sender: 'bot',\n        timestamp: new Date()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsTyping(false);\n    }\n  };\n\n  const handleSuggestionClick = (suggestion: string) => {\n    handleSubmit(undefined, suggestion);\n  };\n\n  if (!isOpen) {\n    return (\n      <Button\n        onClick={() => setIsOpen(true)}\n        className=\"fixed bottom-4 right-4 rounded-full w-12 h-12 shadow-lg\"\n      >\n        <MessageCircle className=\"w-6 h-6\" />\n      </Button>\n    );\n  }\n\n  return (\n    <Card className=\"fixed bottom-4 right-4 w-80 h-[500px] shadow-2xl flex flex-col border-2 border-primary/20\">\n      <div className=\"p-4 border-b flex justify-between items-center bg-gradient-to-r from-primary to-primary/90 text-primary-foreground rounded-t-lg\">\n        <div className=\"flex items-center gap-2\">\n          <MessageCircle className=\"h-5 w-5\" />\n          <h3 className=\"font-semibold\">{t('chatbot.title', 'Farm Equipment Assistant')}</h3>\n        </div>\n        <div className=\"flex gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-7 w-7 hover:bg-white/20\"\n            onClick={() => setIsOpen(false)}\n          >\n            <MinimizeIcon className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-7 w-7 hover:bg-white/20\"\n            onClick={() => {\n              setMessages([{\n                content: t('chatbot.welcome', \"Hello! How can I help you with farm equipment rental today?\"),\n                sender: 'bot',\n                timestamp: new Date()\n              }]);\n              setShowSuggestions(true);\n              setIsOpen(false);\n            }}\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <ScrollArea className=\"flex-1 p-4\">\n        <div className=\"space-y-3\">\n          {messages.map((message, index) => (\n            <div\n              key={index}\n              className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}\n            >\n              <div\n                className={`max-w-[85%] rounded-xl p-3 shadow-sm ${\n                  message.sender === 'user'\n                    ? 'bg-primary text-primary-foreground rounded-br-sm'\n                    : 'bg-muted border rounded-bl-sm'\n                }`}\n              >\n                <div className=\"text-sm leading-relaxed whitespace-pre-wrap\">\n                  {message.content}\n                </div>\n                <div className={`text-xs mt-1 opacity-70 ${\n                  message.sender === 'user' ? 'text-primary-foreground/70' : 'text-muted-foreground'\n                }`}>\n                  {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                </div>\n              </div>\n            </div>\n          ))}\n          \n          {/* Quick suggestions - only show initially */}\n          {showSuggestions && messages.length === 1 && (\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <Lightbulb className=\"h-4 w-4\" />\n                <span>{t('chatbot.quickHelp', 'Quick Help')}</span>\n              </div>\n              <div className=\"grid gap-2\">\n                {quickSuggestions.map((suggestion, index) => (\n                  <Button\n                    key={index}\n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"text-left h-auto p-3 justify-start hover:bg-primary/5\"\n                    onClick={() => handleSuggestionClick(suggestion)}\n                  >\n                    <span className=\"text-xs leading-relaxed\">{suggestion}</span>\n                  </Button>\n                ))}\n              </div>\n            </div>\n          )}\n          \n          {isTyping && (\n            <div className=\"flex justify-start\">\n              <div className=\"max-w-[85%] rounded-xl p-3 bg-muted border rounded-bl-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  <span className=\"text-sm text-muted-foreground\">\n                    {t('chatbot.typing', 'Assistant is typing...')}\n                  </span>\n                </div>\n              </div>\n            </div>\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n      </ScrollArea>\n\n      <div className=\"p-4 border-t bg-muted/30\">\n        <form onSubmit={handleSubmit} className=\"space-y-2\">\n          <div className=\"flex gap-2\">\n            <Input\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              placeholder={t('chatbot.inputPlaceholder', 'Type your message...')}\n              className=\"flex-1 rounded-lg\"\n              disabled={isTyping}\n            />\n            <Button type=\"submit\" size=\"icon\" disabled={isTyping || !input.trim()} className=\"rounded-lg\">\n              <Send className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <div className=\"text-xs text-muted-foreground text-center\">\n            {t('chatbot.helpText', 'I can help you with equipment rentals, pricing, availability, and booking assistance.')}\n          </div>\n        </form>\n      </div>\n    </Card>\n  );\n}","size_bytes":11663},"server/fix-receipts.ts":{"content":"\nimport { pool } from './db';\n\nasync function fixReceiptAmounts() {\n  try {\n    console.log('Starting receipt amount fix...');\n    \n    // Get all receipts with their booking information\n    const result = await pool.query(`\n      SELECT r.id, r.amount, b.\"totalPrice\" \n      FROM receipts r\n      JOIN bookings b ON r.\"bookingId\" = b.id\n    `);\n    \n    console.log(`Found ${result.rows.length} receipts to check`);\n    \n    for (const receipt of result.rows) {\n      const correctAmount = receipt.totalPrice; // This is in rupees\n      const currentAmount = receipt.amount;\n      \n      console.log(`Receipt ${receipt.id}: current=${currentAmount}, correct=${correctAmount}`);\n      \n      // If amount appears to be stored in paise (100x larger), fix it\n      if (currentAmount === correctAmount * 100) {\n        // Amount was stored in paise, convert to rupees\n        await pool.query(\n          'UPDATE receipts SET amount = $1 WHERE id = $2',\n          [correctAmount, receipt.id]\n        );\n        console.log(`✓ Fixed receipt ${receipt.id}: ₹${currentAmount} (paise) -> ₹${correctAmount} (rupees)`);\n      } else if (currentAmount === correctAmount * 10) {\n        // Amount was multiplied by 10 somehow\n        await pool.query(\n          'UPDATE receipts SET amount = $1 WHERE id = $2',\n          [correctAmount, receipt.id]\n        );\n        console.log(`✓ Fixed receipt ${receipt.id}: ₹${currentAmount} -> ₹${correctAmount}`);\n      } else if (currentAmount !== correctAmount) {\n        // If amounts don't match for any other reason, use booking amount\n        await pool.query(\n          'UPDATE receipts SET amount = $1 WHERE id = $2',\n          [correctAmount, receipt.id]\n        );\n        console.log(`✓ Updated receipt ${receipt.id}: ₹${currentAmount} -> ₹${correctAmount}`);\n      } else {\n        console.log(`✓ Receipt ${receipt.id} is already correct: ₹${correctAmount}`);\n      }\n    }\n    \n    console.log('\\n✅ Receipt amount fix completed successfully');\n    console.log('Please verify the amounts in the receipt history page.');\n    process.exit(0);\n  } catch (error) {\n    console.error('❌ Error fixing receipt amounts:', error);\n    process.exit(1);\n  }\n}\n\nfixReceiptAmounts();\n","size_bytes":2237}},"version":2}